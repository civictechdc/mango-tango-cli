
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An interactive python terminal UI wrapper for Mango Tree analyzers.">
      
      
        <meta name="author" content="CIB Mango Tree">
      
      
        <link rel="canonical" href="https://cibmangotree.org/reference/testing/">
      
      
        <link rel="prev" href="../storage/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Testing - CIB Mango Tree</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CIB Mango Tree" class="md-header__button md-logo" aria-label="CIB Mango Tree" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CIB Mango Tree
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/civictechdc/mango-tango-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/get-started/overview/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../analyzer_interface/" class="md-tabs__link">
          
  
  
  Reference (CLI)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CIB Mango Tree" class="md-nav__button md-logo" aria-label="CIB Mango Tree" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    CIB Mango Tree
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/civictechdc/mango-tango-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/get-started/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/get-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributor Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/analyzers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementing Analyzers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dashboards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Dashboards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/dashboards/shiny/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shiny
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/dashboards/react/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React (WIP)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Design Philosophy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Design Philosophy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/core-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/edge-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Edge Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/content-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content Domain
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference (CLI)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference (CLI)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzer_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analyzer Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    App
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terminal_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminal Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Importing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;context
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.context.TestInputColumnProvider" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestInputColumnProvider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;run_enhanced_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" run_enhanced_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.demonstrate_flaky_test_detection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demonstrate_flaky_test_detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_basic_performance_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_basic_performance_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_benchmark_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_benchmark_comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_deterministic_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_deterministic_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_enhanced_benchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_property_based_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_property_based_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_variance_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_variance_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;run_performance_tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" run_performance_tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.generate_performance_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;generate_performance_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.get_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.print_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;print_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_full_suite" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_full_suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_memory_specific_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_memory_specific_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_performance_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_performance_benchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_specific_phase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_specific_phase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_validation_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_validation_tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_chunking_optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_chunking_optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestAdaptiveChunkSizing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_adaptive_chunk_scaling_by_dataset_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_scaling_by_dataset_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_base_chunk_increases_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_base_chunk_increases_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_calculate_optimal_chunk_size_memory_factors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_calculate_optimal_chunk_size_memory_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_chunk_size_bounds_enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_bounds_enforcement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestErrorHandlingAndEdgeCases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_chunk_size_calculation_edge_cases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_calculation_edge_cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_fallback_mechanisms_under_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_mechanisms_under_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_memory_manager_initialization_errors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_initialization_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_zero_memory_system_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_zero_memory_system_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestFallbackOptimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_base_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_base_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_threshold_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_threshold_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_memory_aware_fallback_thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_aware_fallback_thresholds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIntegrationValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_memory_manager_integration_with_ngram_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_integration_with_ngram_analyzer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_real_system_performance_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_real_system_performance_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_system_specific_performance_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_system_specific_performance_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryAutoDetection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_tiers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_tiers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_vs_manual_override" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_vs_manual_override
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_memory_detection_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_detection_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_chunk_size_factors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_updated_chunk_size_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_memory_pressure_thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_updated_memory_pressure_thresholds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_chunk_size_performance_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_performance_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_io_operation_reduction_estimation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_io_operation_reduction_estimation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_memory_efficiency_improvements" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_efficiency_improvements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_progress_reporting_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_progress_reporting_efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRegressionPrevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_memory_manager_api_unchanged" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_existing_memory_manager_api_unchanged
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_tests_still_pass" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_existing_tests_still_pass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSecondaryAnalyzerUpdates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_chunk_limits_updated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_chunk_limits_updated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_maximum_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_maximum_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_minimum_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_minimum_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSystemConfigurationValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_auto_detection_edge_cases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_edge_cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_backward_compatibility_preserved" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_backward_compatibility_preserved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_pressure_detection_accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_pressure_detection_accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_usage_stays_within_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_stays_within_bounds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_enhanced_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_enhanced_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestBenchmarkIntegration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_benchmark_configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_with_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_benchmark_with_setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestEnhancedPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.setup_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.teardown_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;teardown_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_efficiency_invariant" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_efficiency_invariant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_medium" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_medium
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_small" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_small
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_variance_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_variance_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_size_scaling_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_scaling_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_io_operation_counting_deterministic" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_io_operation_counting_deterministic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_efficiency_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_efficiency_bounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_usage_scaling_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_scaling_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_performance_regression_detection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_regression_detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_integration_validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_integration_validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestChunkingOptimizationIntegration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_adaptive_chunk_calculation_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_calculation_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_backward_compatibility_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_backward_compatibility_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_chunking_optimization_phase_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunking_optimization_phase_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_error_handling_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_error_handling_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_bounds_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_bounds_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_manager_auto_detection_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_auto_detection_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_performance_improvements_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_improvements_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_system_specific_optimization_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_system_specific_optimization_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRealWorldScenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_high_memory_system_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_high_memory_system_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_large_dataset_fallback_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_dataset_fallback_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_memory_constrained_system_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_constrained_system_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_typical_social_media_dataset_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_typical_social_media_dataset_scenario
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_performance_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_performance_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.setup_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.teardown_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;teardown_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_comprehensive_performance_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_comprehensive_performance_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_fallback_threshold_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_threshold_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_large_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_medium_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_medium_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_adaptive_chunk_sizing_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_adaptive_chunk_sizing_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_usage_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_small_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_small_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_vectorized_ngram_generation_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_vectorized_ngram_generation_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestStressTests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests.test_large_chunk_memory_stability" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_chunk_memory_stability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests.test_many_small_chunks_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_many_small_chunks_efficiency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testers
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;test_primary_analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_primary_analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(interface)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(main)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(input)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;test_secondary_analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_secondary_analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(interface)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(main)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(primary_params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;primary_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(primary_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;primary_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(dependency_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dependency_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(expected_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;expected_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;context
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.context.TestInputColumnProvider" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestInputColumnProvider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;run_enhanced_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" run_enhanced_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.demonstrate_flaky_test_detection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demonstrate_flaky_test_detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_basic_performance_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_basic_performance_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_benchmark_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_benchmark_comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_deterministic_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_deterministic_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_enhanced_benchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_property_based_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_property_based_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_enhanced_benchmarks.run_variance_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_variance_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;run_performance_tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" run_performance_tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.generate_performance_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;generate_performance_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.get_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.print_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;print_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_full_suite" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_full_suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_memory_specific_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_memory_specific_tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_performance_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_performance_benchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_specific_phase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_specific_phase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.run_performance_tests.run_validation_tests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_validation_tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_chunking_optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_chunking_optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestAdaptiveChunkSizing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_adaptive_chunk_scaling_by_dataset_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_scaling_by_dataset_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_base_chunk_increases_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_base_chunk_increases_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_calculate_optimal_chunk_size_memory_factors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_calculate_optimal_chunk_size_memory_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_chunk_size_bounds_enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_bounds_enforcement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestErrorHandlingAndEdgeCases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_chunk_size_calculation_edge_cases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_calculation_edge_cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_fallback_mechanisms_under_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_mechanisms_under_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_memory_manager_initialization_errors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_initialization_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_zero_memory_system_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_zero_memory_system_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestFallbackOptimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_base_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_base_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_threshold_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_threshold_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestFallbackOptimization.test_memory_aware_fallback_thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_aware_fallback_thresholds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIntegrationValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_memory_manager_integration_with_ngram_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_integration_with_ngram_analyzer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_real_system_performance_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_real_system_performance_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestIntegrationValidation.test_system_specific_performance_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_system_specific_performance_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryAutoDetection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_tiers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_tiers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_vs_manual_override" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_vs_manual_override
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_memory_detection_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_detection_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_chunk_size_factors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_updated_chunk_size_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_memory_pressure_thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_updated_memory_pressure_thresholds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_chunk_size_performance_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_performance_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_io_operation_reduction_estimation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_io_operation_reduction_estimation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_memory_efficiency_improvements" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_efficiency_improvements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_progress_reporting_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_progress_reporting_efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRegressionPrevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_memory_manager_api_unchanged" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_existing_memory_manager_api_unchanged
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_tests_still_pass" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_existing_tests_still_pass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSecondaryAnalyzerUpdates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_chunk_limits_updated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_chunk_limits_updated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_maximum_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_maximum_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_minimum_chunk_increase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_stats_minimum_chunk_increase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSystemConfigurationValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_auto_detection_edge_cases" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_auto_detection_edge_cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_backward_compatibility_preserved" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_backward_compatibility_preserved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_pressure_detection_accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_pressure_detection_accuracy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_usage_stays_within_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_stays_within_bounds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_enhanced_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_enhanced_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestBenchmarkIntegration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_benchmark_configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_with_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_benchmark_with_setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestEnhancedPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.setup_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.teardown_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;teardown_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_efficiency_invariant" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_efficiency_invariant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_medium" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_medium
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_small" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_benchmark_small
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_variance_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_processing_variance_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_size_scaling_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunk_size_scaling_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_io_operation_counting_deterministic" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_io_operation_counting_deterministic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_efficiency_bounds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_efficiency_bounds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_usage_scaling_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_scaling_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_performance_regression_detection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_regression_detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_integration_validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_integration_validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestChunkingOptimizationIntegration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_adaptive_chunk_calculation_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_calculation_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_backward_compatibility_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_backward_compatibility_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_chunking_optimization_phase_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chunking_optimization_phase_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_error_handling_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_error_handling_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_bounds_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_bounds_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_manager_auto_detection_integration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_auto_detection_integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_performance_improvements_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_improvements_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_system_specific_optimization_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_system_specific_optimization_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRealWorldScenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_high_memory_system_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_high_memory_system_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_large_dataset_fallback_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_dataset_fallback_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_memory_constrained_system_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_constrained_system_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_integration_validation.TestRealWorldScenarios.test_typical_social_media_dataset_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_typical_social_media_dataset_scenario
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_performance_benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_performance_benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestPerformanceBenchmarks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.setup_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.teardown_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;teardown_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_comprehensive_performance_validation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_comprehensive_performance_validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_fallback_threshold_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_fallback_threshold_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_large_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_medium_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_medium_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_adaptive_chunk_sizing_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_adaptive_chunk_sizing_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_usage_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_usage_efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_small_dataset_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_small_dataset_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_vectorized_ngram_generation_performance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_vectorized_ngram_generation_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestStressTests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests.test_large_chunk_memory_stability" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_large_chunk_memory_stability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.performance.test_performance_benchmarks.TestStressTests.test_many_small_chunks_efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_many_small_chunks_efficiency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testers
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;test_primary_analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_primary_analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(interface)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(main)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(input)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_primary_analyzer(outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;test_secondary_analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_secondary_analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(interface)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(main)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(primary_params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;primary_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(primary_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;primary_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(dependency_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dependency_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing.testers.test_secondary_analyzer(expected_outputs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;expected_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Testing</h1>

<div class="doc doc-object doc-module">



<h2 id="testing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>testing</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="testing.context" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>context</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="testing.context.TestInputColumnProvider" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestInputColumnProvider</code>


</h4>


    <div class="doc doc-contents ">


        <p>Simple test version of InputColumnProvider.</p>







              <details class="quote">
                <summary>Source code in <code>testing/context.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestInputColumnProvider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple test version of InputColumnProvider.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">semantic</span><span class="p">:</span> <span class="n">SeriesSemantic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_column_name</span> <span class="o">=</span> <span class="n">user_column_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic</span> <span class="o">=</span> <span class="n">semantic</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="testing.performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>performance</code>


</h3>

    <div class="doc doc-contents ">

        <p>Performance Testing Suite for Chunking Optimization</p>
<p>This package contains comprehensive tests for validating the performance improvements
introduced in the N-gram analyzer chunking optimization (Phases 1-4).</p>
<p>Test Modules:
- test_chunking_optimization.py: Core functionality and system configuration tests
- test_performance_benchmarks.py: Real performance measurements and stress tests</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>pytest tests/performance/ -v                    # Run all performance tests
pytest tests/performance/ -v -k "not benchmark" # Skip expensive benchmark tests
pytest tests/performance/ -v --tb=short         # Concise output
pytest tests/performance/ -v -s                 # Show print output from benchmarks</p>
</details>








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="testing.performance.run_enhanced_benchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>run_enhanced_benchmarks</code>


</h4>

    <div class="doc doc-contents ">

        <p>Enhanced Performance Test Runner
Demonstrates the new robust testing approach using pytest-benchmark and resource-based metrics.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.demonstrate_flaky_test_detection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demonstrate_flaky_test_detection</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Demonstrate detection of flaky tests by running multiple times.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">demonstrate_flaky_test_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate detection of flaky tests by running multiple times.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Demonstrating test reliability by running tests multiple times...&quot;</span><span class="p">)</span>

    <span class="c1"># Run deterministic tests multiple times - should always pass</span>
    <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_runs</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_runs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Run </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_runs</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_efficiency_invariant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Override default marker filtering</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">success_rate</span> <span class="o">=</span> <span class="n">success_count</span> <span class="o">/</span> <span class="n">total_runs</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;📊 Deterministic test success rate: </span><span class="si">{</span><span class="n">success_rate</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (</span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_runs</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">success_rate</span> <span class="o">&gt;=</span> <span class="mi">95</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Tests are reliable (&gt;95</span><span class="si">% s</span><span class="s2">uccess rate)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Tests are flaky (&lt;95</span><span class="si">% s</span><span class="s2">uccess rate)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.main" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Main test runner function.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main test runner function.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Enhanced Performance Test Runner&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--basic&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run basic performance tests&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--benchmarks&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run pytest-benchmark tests&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--deterministic&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run deterministic tests&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--property&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run property-based tests&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--variance&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run variance analysis&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--comparison&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run benchmark comparison&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--reliability&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Test reliability demonstration&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--all&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run all test categories&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">args</span><span class="o">.</span><span class="n">basic</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">benchmarks</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">property</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">variance</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">comparison</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">reliability</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">all</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">):</span>
        <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Default to running all tests</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚀 Enhanced Performance Testing Suite&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">basic</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Basic Performance Tests&quot;</span><span class="p">,</span> <span class="n">run_basic_performance_tests</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">deterministic</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Deterministic Tests&quot;</span><span class="p">,</span> <span class="n">run_deterministic_tests</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">property</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Property-Based Tests&quot;</span><span class="p">,</span> <span class="n">run_property_based_tests</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">variance</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Variance Analysis&quot;</span><span class="p">,</span> <span class="n">run_variance_analysis</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">benchmarks</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Enhanced Benchmarks&quot;</span><span class="p">,</span> <span class="n">run_enhanced_benchmarks</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">comparison</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Benchmark Comparison&quot;</span><span class="p">,</span> <span class="n">run_benchmark_comparison</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">reliability</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Reliability Demonstration&quot;</span><span class="p">,</span> <span class="n">demonstrate_flaky_test_detection</span><span class="p">())</span>
        <span class="p">)</span>

    <span class="c1"># Summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📋 TEST SUMMARY&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="n">total_tests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">passed_tests</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">passed</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">passed</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">passed</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✅ PASSED&quot;</span> <span class="k">if</span> <span class="n">passed</span> <span class="k">else</span> <span class="s2">&quot;❌ FAILED&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Overall: </span><span class="si">{</span><span class="n">passed_tests</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_tests</span><span class="si">}</span><span class="s2"> test categories passed&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">passed_tests</span> <span class="o">==</span> <span class="n">total_tests</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🎉 All enhanced performance tests are working correctly!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">💡 Key Benefits Demonstrated:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Eliminated flaky time-based failures&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Statistical rigor with pytest-benchmark&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Deterministic resource-based metrics&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Property-based testing for edge cases&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Variance analysis for reliability validation&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Some test categories failed - see details above&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_basic_performance_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_basic_performance_tests</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run basic performance tests with adjusted thresholds.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_basic_performance_tests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run basic performance tests with adjusted thresholds.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔍 Running basic performance tests with realistic thresholds...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_performance_benchmarks.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;performance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Basic performance tests passed!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Basic performance tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_benchmark_comparison" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_benchmark_comparison</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run benchmark comparison with results saving.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_benchmark_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run benchmark comparison with results saving.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🏆 Running benchmark comparison tests...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_processing_benchmark_small&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_processing_benchmark_medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Override default marker filtering</span>
        <span class="s2">&quot;--benchmark-enable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--benchmark-autosave&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--benchmark-verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Benchmark comparison tests passed!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💾 Benchmark results saved for future comparison&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Benchmark comparison tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_deterministic_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_deterministic_tests</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run deterministic resource-based tests.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_deterministic_tests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run deterministic resource-based tests.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚡ Running deterministic I/O and memory tests...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_efficiency_invariant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_memory_efficiency_bounds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_io_operation_counting_deterministic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Override default marker filtering</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Deterministic tests passed!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Deterministic tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_enhanced_benchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_enhanced_benchmarks</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run enhanced pytest-benchmark tests.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_enhanced_benchmarks</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run enhanced pytest-benchmark tests.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Running enhanced pytest-benchmark tests...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;benchmark&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--benchmark-enable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--benchmark-verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Enhanced benchmark tests passed!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Enhanced benchmark tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_property_based_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_property_based_tests</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run property-based scaling tests.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_property_based_tests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run property-based scaling tests.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧪 Running property-based chunk scaling tests...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_size_scaling_properties&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Override default marker filtering</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Property-based tests passed!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Property-based tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_enhanced_benchmarks.run_variance_analysis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_variance_analysis</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run variance analysis tests.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_variance_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run variance analysis tests.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📈 Running variance analysis tests...&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;testing/performance/test_enhanced_benchmarks.py::TestEnhancedPerformanceBenchmarks::test_chunk_processing_variance_analysis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Override default marker filtering</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Variance analysis tests passed!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Variance analysis tests failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="testing.performance.run_performance_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>run_performance_tests</code>


</h4>

    <div class="doc doc-contents ">

        <p>Performance Test Runner for Chunking Optimization</p>
<p>Provides convenient ways to run performance tests with appropriate configurations
and generate performance reports.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.generate_performance_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">generate_performance_report</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generate a performance test report.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_performance_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a performance test report.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Generating Performance Report ===&quot;</span><span class="p">)</span>

    <span class="n">system_info</span> <span class="o">=</span> <span class="n">get_system_info</span><span class="p">()</span>

    <span class="c1"># Run tests with detailed output</span>
    <span class="n">report_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;performance_test_report.txt&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;testing/performance/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--durations=20&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;--html=performance_report.html&quot;</span><span class="p">,</span>  <span class="c1"># If pytest-html is available</span>
        <span class="s2">&quot;--self-contained-html&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running tests and generating report...&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Create text report</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Performance Test Report</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Date: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Test Time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> seconds</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;System Information:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">system_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Test Results:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall Result: </span><span class="si">{</span><span class="s1">&#39;PASSED&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;FAILED&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">See performance_report.html for detailed results (if available).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report saved to: </span><span class="si">{</span><span class="n">report_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;performance_report.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTML report saved to: performance_report.html&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.get_system_info" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">get_system_info</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get system information for test context.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_system_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get system information for test context.&quot;&quot;&quot;</span>
    <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;total_memory_gb&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;available_memory_gb&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;cpu_count&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span>
        <span class="s2">&quot;cpu_freq&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_freq</span><span class="p">()</span><span class="o">.</span><span class="n">max</span> <span class="k">if</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_freq</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.main" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Main CLI interface.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main CLI interface.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Run performance tests for chunking optimization&quot;</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Examples:</span>
<span class="s2">  python run_performance_tests.py --validate     # Quick validation tests</span>
<span class="s2">  python run_performance_tests.py --benchmark    # Performance benchmarks  </span>
<span class="s2">  python run_performance_tests.py --full         # Complete test suite</span>
<span class="s2">  python run_performance_tests.py --phase 2      # Phase 2 tests only</span>
<span class="s2">  python run_performance_tests.py --memory       # Tests for current system</span>
<span class="s2">  python run_performance_tests.py --report       # Generate performance report</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--validate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run core validation tests (fast)&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--benchmark&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run performance benchmark tests&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--full&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run complete performance test suite&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--phase&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run tests for specific optimization phase&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--memory&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run tests appropriate for current system memory&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--report&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate comprehensive performance report&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--info&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show system information and exit&quot;</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Show system info if requested or for any test run</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
        <span class="n">print_system_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">benchmark</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">full</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="n">print_system_info</span><span class="p">()</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">run_validation_tests</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">benchmark</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">run_performance_benchmarks</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">full</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">run_full_suite</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">phase</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">run_specific_phase</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">run_memory_specific_tests</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">&amp;=</span> <span class="n">generate_performance_report</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tests interrupted by user.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">130</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error running tests: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ All tests completed successfully!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Some tests failed. Check output above for details.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.print_system_info" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">print_system_info</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Print system information.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">print_system_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print system information.&quot;&quot;&quot;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">get_system_info</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== System Information ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total RAM: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;total_memory_gb&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available RAM: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;available_memory_gb&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CPU Cores: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;cpu_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cpu_freq&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CPU Frequency: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;cpu_freq&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> MHz&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Python Version: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;python_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.run_full_suite" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_full_suite</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run the complete performance test suite.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_full_suite</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the complete performance test suite.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Running Full Performance Test Suite ===&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;testing/performance/&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--durations=15&quot;</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.run_memory_specific_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_memory_specific_tests</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run tests specific to current system's memory configuration.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_memory_specific_tests</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run tests specific to current system&#39;s memory configuration.&quot;&quot;&quot;</span>
    <span class="n">system_info</span> <span class="o">=</span> <span class="n">get_system_info</span><span class="p">()</span>
    <span class="n">memory_gb</span> <span class="o">=</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;total_memory_gb&quot;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Running Tests for </span><span class="si">{</span><span class="n">memory_gb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">GB System ===&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High-memory system detected. Running comprehensive tests.&quot;</span><span class="p">)</span>
        <span class="n">test_filter</span> <span class="o">=</span> <span class="s2">&quot;not stress&quot;</span>  <span class="c1"># Skip stress tests unless explicitly requested</span>
    <span class="k">elif</span> <span class="n">memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard-memory system detected. Running standard tests.&quot;</span><span class="p">)</span>
        <span class="n">test_filter</span> <span class="o">=</span> <span class="s2">&quot;not stress and not large_dataset&quot;</span>
    <span class="k">elif</span> <span class="n">memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lower-memory system detected. Running basic tests.&quot;</span><span class="p">)</span>
        <span class="n">test_filter</span> <span class="o">=</span> <span class="s2">&quot;not stress and not large_dataset and not comprehensive&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Constrained-memory system detected. Running minimal tests.&quot;</span><span class="p">)</span>
        <span class="n">test_filter</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;not stress and not large_dataset and not comprehensive and not benchmark&quot;</span>
        <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;testing/performance/&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span> <span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="n">test_filter</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.run_performance_benchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_performance_benchmarks</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run performance benchmark tests.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_performance_benchmarks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run performance benchmark tests.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Running Performance Benchmarks ===&quot;</span><span class="p">)</span>

    <span class="n">system_info</span> <span class="o">=</span> <span class="n">get_system_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;total_memory_gb&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: System has less than 8GB RAM. Some benchmarks may be skipped.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;testing/performance/test_performance_benchmarks.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>  <span class="c1"># Show output from benchmarks</span>
        <span class="s2">&quot;--durations=10&quot;</span><span class="p">,</span>  <span class="c1"># Show slowest 10 tests</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.run_specific_phase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_specific_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run tests for a specific optimization phase.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_specific_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run tests for a specific optimization phase.&quot;&quot;&quot;</span>
    <span class="n">phase_keywords</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;memory_detection or auto_detection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;adaptive_chunk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="s2">&quot;fallback&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="s2">&quot;secondary_analyzer or ngram_stats&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5&quot;</span><span class="p">:</span> <span class="s2">&quot;validation or benchmark&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">phase_keywords</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid phase: </span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s2">. Must be 1-5.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Running Phase </span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s2"> Tests ===&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;testing/performance/&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span> <span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="n">phase_keywords</span><span class="p">[</span><span class="n">phase</span><span class="p">]]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="testing.performance.run_performance_tests.run_validation_tests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">run_validation_tests</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run core validation tests (fast).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/run_performance_tests.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_validation_tests</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run core validation tests (fast).&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Running Core Validation Tests ===&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;testing/performance/test_chunking_optimization.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-k&quot;</span><span class="p">,</span>
        <span class="s2">&quot;not benchmark and not stress and not comprehensive&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="testing.performance.test_chunking_optimization" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_chunking_optimization</code>


</h4>

    <div class="doc doc-contents ">

        <p>Performance Test Suite for Chunking Optimization
Phase 5: Testing &amp; Validation for N-gram Analyzer Chunking Optimization</p>
<p>This test suite validates the performance improvements and system-specific scaling
introduced in Phases 1-4 of the chunking optimization specification.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestAdaptiveChunkSizing</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test adaptive chunk size calculation for different system configurations.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestAdaptiveChunkSizing</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test adaptive chunk size calculation for different system configurations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size_memory_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory factor calculation for different system sizes.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">analyzers.ngrams.ngrams_base.main</span> <span class="kn">import</span> <span class="n">main</span>

        <span class="c1"># Mock memory manager for different system sizes</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test 8GB system (factor = 1.0)</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Use the calculate_optimal_chunk_size function from the ngrams_base module</span>
            <span class="c1"># We need to access it through the main function&#39;s internal definition</span>
            <span class="c1"># For testing, we&#39;ll create a similar function</span>
            <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">memory_manager</span><span class="p">:</span>
                    <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
                    <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
                    <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
                    <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

            <span class="c1"># Test different system sizes</span>
            <span class="c1"># 8GB system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">chunk_size_8gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size_8gb</span> <span class="o">==</span> <span class="mi">150_000</span>  <span class="c1"># 150K * 1.0</span>

            <span class="c1"># 16GB system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">chunk_size_16gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size_16gb</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

            <span class="c1"># 32GB system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">chunk_size_32gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size_32gb</span> <span class="o">==</span> <span class="mi">300_000</span>  <span class="c1"># 150K * 2.0</span>

            <span class="c1"># 4GB system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">chunk_size_4gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size_4gb</span> <span class="o">==</span> <span class="mi">75_000</span>  <span class="c1"># 150K * 0.5</span>

    <span class="k">def</span> <span class="nf">test_adaptive_chunk_scaling_by_dataset_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that chunk sizes scale appropriately with dataset size.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c1"># Simulate 16GB system</span>

            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Small dataset - largest base chunks</span>
        <span class="n">small_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">small_chunk</span> <span class="o">==</span> <span class="mi">300_000</span>  <span class="c1"># 200K * 1.5</span>

        <span class="c1"># Medium dataset - medium base chunks</span>
        <span class="n">medium_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">medium_chunk</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

        <span class="c1"># Large dataset - smaller base chunks</span>
        <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">3_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">large_chunk</span> <span class="o">==</span> <span class="mi">150_000</span>  <span class="c1"># 100K * 1.5</span>

        <span class="c1"># Very large dataset - smallest base chunks</span>
        <span class="n">xlarge_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xlarge_chunk</span> <span class="o">==</span> <span class="mi">112_500</span>  <span class="c1"># 75K * 1.5</span>

    <span class="k">def</span> <span class="nf">test_chunk_size_bounds_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that chunk sizes respect minimum and maximum bounds.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.04</span>  <span class="c1"># Very small factor to test minimum (0.04 * 200_000 = 8_000 -&gt; min enforced to 10_000)</span>

            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Should enforce minimum of 10,000</span>
        <span class="n">small_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">small_chunk</span> <span class="o">==</span> <span class="mi">10_000</span>

        <span class="c1"># Test maximum enforcement with very high memory factor</span>
        <span class="k">def</span> <span class="nf">test_calculate_max_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># Very high factor to test maximum</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Would be 2M</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="n">max_chunk</span> <span class="o">=</span> <span class="n">test_calculate_max_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">max_chunk</span> <span class="o">==</span> <span class="mi">500_000</span>  <span class="c1"># Should be capped at maximum</span>

    <span class="k">def</span> <span class="nf">test_base_chunk_increases_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that base chunk sizes have increased from 50K to 150K-200K.&quot;&quot;&quot;</span>

        <span class="c1"># This validates the Phase 2 implementation</span>
        <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Standard system</span>

            <span class="c1"># These are the new base sizes (Phase 2)</span>
            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 200K</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 150K</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 100K+</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Verify chunk sizes are significantly larger than old 50K base</span>
        <span class="n">small_dataset_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">small_dataset_chunk</span> <span class="o">&gt;=</span> <span class="mi">150_000</span>  <span class="c1"># At least 3x larger than old 50K</span>

        <span class="n">medium_dataset_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">medium_dataset_chunk</span> <span class="o">&gt;=</span> <span class="mi">150_000</span>  <span class="c1"># At least 3x larger than old 50K</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_adaptive_chunk_scaling_by_dataset_size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_adaptive_chunk_scaling_by_dataset_size</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that chunk sizes scale appropriately with dataset size.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_adaptive_chunk_scaling_by_dataset_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that chunk sizes scale appropriately with dataset size.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c1"># Simulate 16GB system</span>

        <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

    <span class="c1"># Small dataset - largest base chunks</span>
    <span class="n">small_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">small_chunk</span> <span class="o">==</span> <span class="mi">300_000</span>  <span class="c1"># 200K * 1.5</span>

    <span class="c1"># Medium dataset - medium base chunks</span>
    <span class="n">medium_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">medium_chunk</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

    <span class="c1"># Large dataset - smaller base chunks</span>
    <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">3_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">large_chunk</span> <span class="o">==</span> <span class="mi">150_000</span>  <span class="c1"># 100K * 1.5</span>

    <span class="c1"># Very large dataset - smallest base chunks</span>
    <span class="n">xlarge_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">xlarge_chunk</span> <span class="o">==</span> <span class="mi">112_500</span>  <span class="c1"># 75K * 1.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_base_chunk_increases_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_base_chunk_increases_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that base chunk sizes have increased from 50K to 150K-200K.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_base_chunk_increases_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that base chunk sizes have increased from 50K to 150K-200K.&quot;&quot;&quot;</span>

    <span class="c1"># This validates the Phase 2 implementation</span>
    <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Standard system</span>

        <span class="c1"># These are the new base sizes (Phase 2)</span>
        <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 200K</span>
        <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 150K</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Was 50K, now 100K+</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

    <span class="c1"># Verify chunk sizes are significantly larger than old 50K base</span>
    <span class="n">small_dataset_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">small_dataset_chunk</span> <span class="o">&gt;=</span> <span class="mi">150_000</span>  <span class="c1"># At least 3x larger than old 50K</span>

    <span class="n">medium_dataset_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
        <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">medium_dataset_chunk</span> <span class="o">&gt;=</span> <span class="mi">150_000</span>  <span class="c1"># At least 3x larger than old 50K</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_calculate_optimal_chunk_size_memory_factors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_calculate_optimal_chunk_size_memory_factors</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test memory factor calculation for different system sizes.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size_memory_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory factor calculation for different system sizes.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">analyzers.ngrams.ngrams_base.main</span> <span class="kn">import</span> <span class="n">main</span>

    <span class="c1"># Mock memory manager for different system sizes</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test 8GB system (factor = 1.0)</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Use the calculate_optimal_chunk_size function from the ngrams_base module</span>
        <span class="c1"># We need to access it through the main function&#39;s internal definition</span>
        <span class="c1"># For testing, we&#39;ll create a similar function</span>
        <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">memory_manager</span><span class="p">:</span>
                <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
                <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="c1"># Test different system sizes</span>
        <span class="c1"># 8GB system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">chunk_size_8gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size_8gb</span> <span class="o">==</span> <span class="mi">150_000</span>  <span class="c1"># 150K * 1.0</span>

        <span class="c1"># 16GB system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">chunk_size_16gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size_16gb</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

        <span class="c1"># 32GB system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">chunk_size_32gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size_32gb</span> <span class="o">==</span> <span class="mi">300_000</span>  <span class="c1"># 150K * 2.0</span>

        <span class="c1"># 4GB system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">chunk_size_4gb</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">memory_manager</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size_4gb</span> <span class="o">==</span> <span class="mi">75_000</span>  <span class="c1"># 150K * 0.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestAdaptiveChunkSizing.test_chunk_size_bounds_enforcement" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_size_bounds_enforcement</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that chunk sizes respect minimum and maximum bounds.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_size_bounds_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that chunk sizes respect minimum and maximum bounds.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.04</span>  <span class="c1"># Very small factor to test minimum (0.04 * 200_000 = 8_000 -&gt; min enforced to 10_000)</span>

        <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

    <span class="c1"># Should enforce minimum of 10,000</span>
    <span class="n">small_chunk</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">small_chunk</span> <span class="o">==</span> <span class="mi">10_000</span>

    <span class="c1"># Test maximum enforcement with very high memory factor</span>
    <span class="k">def</span> <span class="nf">test_calculate_max_chunk_size</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># Very high factor to test maximum</span>
        <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Would be 2M</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="n">max_chunk</span> <span class="o">=</span> <span class="n">test_calculate_max_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">max_chunk</span> <span class="o">==</span> <span class="mi">500_000</span>  <span class="c1"># Should be capped at maximum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestErrorHandlingAndEdgeCases</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test error handling and edge cases.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestErrorHandlingAndEdgeCases</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test error handling and edge cases.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_zero_memory_system_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of systems with very little memory.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Simulate system with very little memory</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># 512MB</span>

            <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>

            <span class="c1"># Should still provide some allocation</span>
            <span class="k">assert</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mf">1.0</span>  <span class="c1"># Should be less than 1GB</span>

            <span class="c1"># Should use conservative 20% allocation</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># 512MB * 20% = ~0.1GB</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span>

    <span class="k">def</span> <span class="nf">test_memory_manager_initialization_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory manager handles initialization errors gracefully.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Simulate psutil error</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Memory detection failed&quot;</span><span class="p">)</span>

            <span class="c1"># Should fall back to reasonable default</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
                <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_chunk_size_calculation_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test chunk size calculation with edge case inputs.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">memory_manager</span> <span class="k">else</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="c1"># Test with zero dataset size</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;=</span> <span class="mi">10_000</span>  <span class="c1"># Should enforce minimum</span>

        <span class="c1"># Test with very large dataset</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000_000</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span>  <span class="c1"># Should enforce maximum</span>

        <span class="c1"># Test with exactly boundary values</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test_fallback_mechanisms_under_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that fallback mechanisms work under genuine memory pressure.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Very limited</span>

        <span class="c1"># Mock the process memory info to simulate critical pressure</span>
        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
            <span class="c1"># Simulate critical memory usage (95% of max)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>

            <span class="c1"># Should drastically reduce chunk size under critical pressure</span>
            <span class="n">base_size</span> <span class="o">=</span> <span class="mi">100_000</span>
            <span class="n">adaptive_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Should be significantly reduced</span>
            <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&lt;</span> <span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="c1"># Should still be above minimum</span>
            <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_chunk_size_calculation_edge_cases" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_size_calculation_edge_cases</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test chunk size calculation with edge case inputs.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_size_calculation_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test chunk size calculation with edge case inputs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_calculate_optimal_chunk_size</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">memory_manager</span> <span class="k">else</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">5_000_000</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">75_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="c1"># Test with zero dataset size</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;=</span> <span class="mi">10_000</span>  <span class="c1"># Should enforce minimum</span>

    <span class="c1"># Test with very large dataset</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">100_000_000</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span>  <span class="c1"># Should enforce maximum</span>

    <span class="c1"># Test with exactly boundary values</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">test_calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_fallback_mechanisms_under_pressure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_fallback_mechanisms_under_pressure</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that fallback mechanisms work under genuine memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_fallback_mechanisms_under_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that fallback mechanisms work under genuine memory pressure.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Very limited</span>

    <span class="c1"># Mock the process memory info to simulate critical pressure</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
        <span class="c1"># Simulate critical memory usage (95% of max)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>

        <span class="c1"># Should drastically reduce chunk size under critical pressure</span>
        <span class="n">base_size</span> <span class="o">=</span> <span class="mi">100_000</span>
        <span class="n">adaptive_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should be significantly reduced</span>
        <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&lt;</span> <span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.5</span>

        <span class="c1"># Should still be above minimum</span>
        <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_memory_manager_initialization_errors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_manager_initialization_errors</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test memory manager handles initialization errors gracefully.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_manager_initialization_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory manager handles initialization errors gracefully.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Simulate psutil error</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Memory detection failed&quot;</span><span class="p">)</span>

        <span class="c1"># Should fall back to reasonable default</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="n">MemoryManager</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestErrorHandlingAndEdgeCases.test_zero_memory_system_handling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_zero_memory_system_handling</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test handling of systems with very little memory.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_zero_memory_system_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test handling of systems with very little memory.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Simulate system with very little memory</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># 512MB</span>

        <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>

        <span class="c1"># Should still provide some allocation</span>
        <span class="k">assert</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mf">1.0</span>  <span class="c1"># Should be less than 1GB</span>

        <span class="c1"># Should use conservative 20% allocation</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># 512MB * 20% = ~0.1GB</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestFallbackOptimization" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestFallbackOptimization</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test fallback processor optimizations.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestFallbackOptimization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test fallback processor optimizations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_fallback_base_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that fallback base chunks increased from 25K to 100K.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">100_000</span>  <span class="c1"># New base</span>

        <span class="c1"># The fallback processors should now use 100K as base instead of 25K</span>
        <span class="c1"># This is verified by checking the base value passed to calculate_adaptive_chunk_size</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span>

        <span class="c1"># Call the function that would use the base chunk size</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should return the new larger base size</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">100_000</span>

    <span class="k">def</span> <span class="nf">test_memory_aware_fallback_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory-aware fallback thresholds for different system sizes.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test 32GB system - should have 3M row threshold</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Simulate the threshold calculation logic from Phase 3</span>
            <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

            <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">3_000_000</span>

            <span class="c1"># Test 16GB system - should have 1.5M row threshold</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

            <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">1_500_000</span>

            <span class="c1"># Test 8GB system - should keep 500K row threshold</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

            <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">500_000</span>

    <span class="k">def</span> <span class="nf">test_fallback_threshold_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that fallback thresholds scale appropriately (500K → 1.5M → 3M).&quot;&quot;&quot;</span>
        <span class="c1"># Validate the 3x and 6x increases for different system tiers</span>
        <span class="n">old_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="c1"># 16GB system gets 3x increase</span>
        <span class="n">threshold_16gb</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">assert</span> <span class="n">threshold_16gb</span> <span class="o">/</span> <span class="n">old_threshold</span> <span class="o">==</span> <span class="mf">3.0</span>

        <span class="c1"># 32GB system gets 6x increase</span>
        <span class="n">threshold_32gb</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">assert</span> <span class="n">threshold_32gb</span> <span class="o">/</span> <span class="n">old_threshold</span> <span class="o">==</span> <span class="mf">6.0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_base_chunk_increase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_fallback_base_chunk_increase</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that fallback base chunks increased from 25K to 100K.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_fallback_base_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that fallback base chunks increased from 25K to 100K.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">100_000</span>  <span class="c1"># New base</span>

    <span class="c1"># The fallback processors should now use 100K as base instead of 25K</span>
    <span class="c1"># This is verified by checking the base value passed to calculate_adaptive_chunk_size</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span>

    <span class="c1"># Call the function that would use the base chunk size</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Should return the new larger base size</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">100_000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestFallbackOptimization.test_fallback_threshold_scaling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_fallback_threshold_scaling</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that fallback thresholds scale appropriately (500K → 1.5M → 3M).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_fallback_threshold_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that fallback thresholds scale appropriately (500K → 1.5M → 3M).&quot;&quot;&quot;</span>
    <span class="c1"># Validate the 3x and 6x increases for different system tiers</span>
    <span class="n">old_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

    <span class="c1"># 16GB system gets 3x increase</span>
    <span class="n">threshold_16gb</span> <span class="o">=</span> <span class="mi">1_500_000</span>
    <span class="k">assert</span> <span class="n">threshold_16gb</span> <span class="o">/</span> <span class="n">old_threshold</span> <span class="o">==</span> <span class="mf">3.0</span>

    <span class="c1"># 32GB system gets 6x increase</span>
    <span class="n">threshold_32gb</span> <span class="o">=</span> <span class="mi">3_000_000</span>
    <span class="k">assert</span> <span class="n">threshold_32gb</span> <span class="o">/</span> <span class="n">old_threshold</span> <span class="o">==</span> <span class="mf">6.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestFallbackOptimization.test_memory_aware_fallback_thresholds" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_aware_fallback_thresholds</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test memory-aware fallback thresholds for different system sizes.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_aware_fallback_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory-aware fallback thresholds for different system sizes.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test 32GB system - should have 3M row threshold</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Simulate the threshold calculation logic from Phase 3</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">3_000_000</span>

        <span class="c1"># Test 16GB system - should have 1.5M row threshold</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">1_500_000</span>

        <span class="c1"># Test 8GB system - should keep 500K row threshold</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="k">assert</span> <span class="n">threshold</span> <span class="o">==</span> <span class="mi">500_000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestIntegrationValidation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestIntegrationValidation</code>


</h5>


    <div class="doc doc-contents ">


        <p>Integration tests validating end-to-end improvements.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestIntegrationValidation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests validating end-to-end improvements.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_manager_integration_with_ngram_analyzer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory manager integrates properly with n-gram analyzer.&quot;&quot;&quot;</span>
        <span class="c1"># This would test the actual integration, but we&#39;ll mock it to avoid</span>
        <span class="c1"># running the full analyzer in tests</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Simulate the integration points</span>
        <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory_manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>

        <span class="c1"># Test that the memory manager can be passed to analyzer functions</span>
        <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
        <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should return a reasonable chunk size</span>
        <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># Allow for some scaling up</span>

    <span class="k">def</span> <span class="nf">test_system_specific_performance_characteristics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that different system configurations get appropriate performance.&quot;&quot;&quot;</span>
        <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>  <span class="c1"># 4GB system, 20% allocation</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 8GB system, 25% allocation</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span>  <span class="c1"># 16GB system, 30% allocation</span>
            <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">),</span>  <span class="c1"># 32GB system, 40% allocation</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">total_gb</span><span class="p">,</span> <span class="n">expected_limit</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

                <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

                <span class="c1"># Should allocate appropriate amount</span>
                <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

                <span class="c1"># Higher memory systems should get better performance</span>
                <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;=</span> <span class="mf">4.0</span>

                    <span class="c1"># Should have more lenient pressure thresholds</span>
                    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.70</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span>
        <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Requires at least 8GB RAM for meaningful performance test&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_real_system_performance_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance improvements on real system (when possible).&quot;&quot;&quot;</span>
        <span class="c1"># Only run on systems with sufficient memory</span>
        <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Auto-detection should work correctly</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&lt;=</span> <span class="n">system_memory_gb</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># Reasonable upper bound</span>

        <span class="c1"># Should provide better performance than old hardcoded 4GB limit</span>
        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mf">4.0</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;=</span> <span class="mf">2.0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestIntegrationValidation.test_memory_manager_integration_with_ngram_analyzer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_manager_integration_with_ngram_analyzer</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory manager integrates properly with n-gram analyzer.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_manager_integration_with_ngram_analyzer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory manager integrates properly with n-gram analyzer.&quot;&quot;&quot;</span>
    <span class="c1"># This would test the actual integration, but we&#39;ll mock it to avoid</span>
    <span class="c1"># running the full analyzer in tests</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Simulate the integration points</span>
    <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory_manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>

    <span class="c1"># Test that the memory manager can be passed to analyzer functions</span>
    <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
    <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Should return a reasonable chunk size</span>
    <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># Allow for some scaling up</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestIntegrationValidation.test_real_system_performance_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_real_system_performance_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance improvements on real system (when possible).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span>
    <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Requires at least 8GB RAM for meaningful performance test&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_real_system_performance_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance improvements on real system (when possible).&quot;&quot;&quot;</span>
    <span class="c1"># Only run on systems with sufficient memory</span>
    <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Auto-detection should work correctly</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&lt;=</span> <span class="n">system_memory_gb</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># Reasonable upper bound</span>

    <span class="c1"># Should provide better performance than old hardcoded 4GB limit</span>
    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="mf">4.0</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;=</span> <span class="mf">2.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestIntegrationValidation.test_system_specific_performance_characteristics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_system_specific_performance_characteristics</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that different system configurations get appropriate performance.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_system_specific_performance_characteristics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that different system configurations get appropriate performance.&quot;&quot;&quot;</span>
    <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>  <span class="c1"># 4GB system, 20% allocation</span>
        <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 8GB system, 25% allocation</span>
        <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span>  <span class="c1"># 16GB system, 30% allocation</span>
        <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">),</span>  <span class="c1"># 32GB system, 40% allocation</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">total_gb</span><span class="p">,</span> <span class="n">expected_limit</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should allocate appropriate amount</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Higher memory systems should get better performance</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;=</span> <span class="mf">4.0</span>

                <span class="c1"># Should have more lenient pressure thresholds</span>
                <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.70</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestMemoryAutoDetection</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test smart memory detection functionality.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestMemoryAutoDetection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test smart memory detection functionality.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_auto_detection_tiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory detection tiers work correctly.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test 8GB system (25% allocation)</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 8GB * 0.25 = 2GB</span>

            <span class="c1"># Test 16GB system (30% allocation)</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 16GB * 0.30 = 4.8GB</span>

            <span class="c1"># Test 32GB system (40% allocation)</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 32GB * 0.40 = 12.8GB</span>

            <span class="c1"># Test 4GB system (20% allocation - constrained)</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 4GB * 0.20 = 0.8GB</span>

    <span class="k">def</span> <span class="nf">test_auto_detection_vs_manual_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that manual override works and auto-detection is bypassed.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="c1"># Auto-detection should give 4.8GB</span>
            <span class="n">auto_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">auto_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Manual override should use exact value</span>
            <span class="n">manual_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">8.0</span>

    <span class="k">def</span> <span class="nf">test_memory_detection_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory detection logs appropriate information.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;app.utils.get_logger&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_logger</span><span class="p">:</span>
                <span class="n">mock_log</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
                <span class="n">mock_logger</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_log</span>

                <span class="n">MemoryManager</span><span class="p">()</span>

                <span class="c1"># Should log initialization details</span>
                <span class="n">mock_log</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
                <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_log</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">call_args</span>
                <span class="k">assert</span> <span class="s2">&quot;Memory manager initialized&quot;</span> <span class="ow">in</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">extra_data</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span>
                <span class="k">assert</span> <span class="s2">&quot;system_total_gb&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
                <span class="k">assert</span> <span class="s2">&quot;detected_limit_gb&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
                <span class="k">assert</span> <span class="s2">&quot;allocation_percent&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
                <span class="k">assert</span> <span class="n">extra_data</span><span class="p">[</span><span class="s2">&quot;detection_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>

    <span class="k">def</span> <span class="nf">test_updated_memory_pressure_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that updated pressure thresholds are more lenient.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Test new more lenient thresholds</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.70</span>  <span class="c1"># Was 0.60</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.80</span>  <span class="c1"># Was 0.75</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.90</span>  <span class="c1"># Was 0.85</span>

    <span class="k">def</span> <span class="nf">test_updated_chunk_size_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that chunk size reductions are less aggressive.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Test less aggressive chunk size reduction factors</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.8</span>  <span class="c1"># Was 0.7</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.6</span>  <span class="c1"># Was 0.4</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.4</span>
        <span class="p">)</span>  <span class="c1"># Was 0.2</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_tiers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_auto_detection_tiers</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test memory detection tiers work correctly.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_auto_detection_tiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory detection tiers work correctly.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test 8GB system (25% allocation)</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 8GB * 0.25 = 2GB</span>

        <span class="c1"># Test 16GB system (30% allocation)</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 16GB * 0.30 = 4.8GB</span>

        <span class="c1"># Test 32GB system (40% allocation)</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 32GB * 0.40 = 12.8GB</span>

        <span class="c1"># Test 4GB system (20% allocation - constrained)</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># 4GB * 0.20 = 0.8GB</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_auto_detection_vs_manual_override" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_auto_detection_vs_manual_override</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that manual override works and auto-detection is bypassed.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_auto_detection_vs_manual_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that manual override works and auto-detection is bypassed.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="c1"># Auto-detection should give 4.8GB</span>
        <span class="n">auto_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">auto_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Manual override should use exact value</span>
        <span class="n">manual_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">8.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_memory_detection_logging" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_detection_logging</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory detection logs appropriate information.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_detection_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory detection logs appropriate information.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;app.utils.get_logger&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_logger</span><span class="p">:</span>
            <span class="n">mock_log</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">mock_logger</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_log</span>

            <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should log initialization details</span>
            <span class="n">mock_log</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_log</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">call_args</span>
            <span class="k">assert</span> <span class="s2">&quot;Memory manager initialized&quot;</span> <span class="ow">in</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">extra_data</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="s2">&quot;system_total_gb&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
            <span class="k">assert</span> <span class="s2">&quot;detected_limit_gb&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
            <span class="k">assert</span> <span class="s2">&quot;allocation_percent&quot;</span> <span class="ow">in</span> <span class="n">extra_data</span>
            <span class="k">assert</span> <span class="n">extra_data</span><span class="p">[</span><span class="s2">&quot;detection_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_chunk_size_factors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_updated_chunk_size_factors</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that chunk size reductions are less aggressive.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_updated_chunk_size_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that chunk size reductions are less aggressive.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Test less aggressive chunk size reduction factors</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.8</span>  <span class="c1"># Was 0.7</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.6</span>  <span class="c1"># Was 0.4</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.4</span>
    <span class="p">)</span>  <span class="c1"># Was 0.2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestMemoryAutoDetection.test_updated_memory_pressure_thresholds" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_updated_memory_pressure_thresholds</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that updated pressure thresholds are more lenient.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_updated_memory_pressure_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that updated pressure thresholds are more lenient.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Test new more lenient thresholds</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.70</span>  <span class="c1"># Was 0.60</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.80</span>  <span class="c1"># Was 0.75</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.90</span>  <span class="c1"># Was 0.85</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestPerformanceBenchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestPerformanceBenchmarks</code>


</h5>


    <div class="doc doc-contents ">


        <p>Performance benchmarking tests.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestPerformanceBenchmarks</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performance benchmarking tests.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_chunk_size_performance_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that larger chunk sizes provide better performance characteristics.&quot;&quot;&quot;</span>
        <span class="c1"># Create test datasets of different sizes</span>
        <span class="n">small_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
        <span class="n">medium_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>
        <span class="n">large_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>

        <span class="c1"># Test with different chunk sizes</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Old base size</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base size</span>

        <span class="c1"># For small datasets, chunk size should be optimized for data size</span>
        <span class="n">small_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">small_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">small_optimal</span> <span class="o">&lt;=</span> <span class="n">new_chunk_size</span>

        <span class="c1"># For medium datasets, should use larger chunks</span>
        <span class="n">medium_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">medium_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">medium_optimal</span> <span class="o">&gt;</span> <span class="n">old_chunk_size</span>

        <span class="c1"># For large datasets, should still be reasonable</span>
        <span class="n">large_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">large_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">large_optimal</span> <span class="o">&gt;=</span> <span class="n">old_chunk_size</span>

    <span class="k">def</span> <span class="nf">test_memory_efficiency_improvements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory efficiency has improved with new chunking.&quot;&quot;&quot;</span>
        <span class="c1"># Test memory manager with different configurations</span>
        <span class="n">old_memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>  <span class="c1"># Old hardcoded limit</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">new_memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>  <span class="c1"># Auto-detected limit</span>

            <span class="c1"># New manager should have higher limit on 16GB system</span>
            <span class="k">assert</span> <span class="n">new_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="n">old_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span>

            <span class="c1"># Should be approximately 4.8GB for 16GB system</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">new_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

    <span class="k">def</span> <span class="nf">test_io_operation_reduction_estimation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test estimation of I/O operation reduction.&quot;&quot;&quot;</span>
        <span class="c1"># Simulate old vs new chunking for a 2M row dataset</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">2_000_000</span>

        <span class="c1"># Old chunking: 50K base chunks</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
        <span class="n">old_num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset_size</span> <span class="o">+</span> <span class="n">old_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">old_chunk_size</span>

        <span class="c1"># New chunking: 150K base chunks (3x larger)</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>
        <span class="n">new_num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset_size</span> <span class="o">+</span> <span class="n">new_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

        <span class="c1"># Should have significantly fewer I/O operations</span>
        <span class="n">io_reduction_factor</span> <span class="o">=</span> <span class="n">old_num_chunks</span> <span class="o">/</span> <span class="n">new_num_chunks</span>
        <span class="k">assert</span> <span class="n">io_reduction_factor</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>  <span class="c1"># At least 2.5x fewer operations</span>
        <span class="k">assert</span> <span class="n">io_reduction_factor</span> <span class="o">&lt;=</span> <span class="mf">4.0</span>  <span class="c1"># Reasonable upper bound</span>

    <span class="k">def</span> <span class="nf">test_progress_reporting_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that progress reporting overhead is reduced with larger chunks.&quot;&quot;&quot;</span>
        <span class="c1"># Larger chunks mean fewer progress updates, reducing overhead</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">1_000_000</span>

        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>

        <span class="n">old_progress_updates</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">//</span> <span class="n">old_chunk_size</span>
        <span class="n">new_progress_updates</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

        <span class="c1"># Should have fewer progress updates</span>
        <span class="k">assert</span> <span class="n">new_progress_updates</span> <span class="o">&lt;</span> <span class="n">old_progress_updates</span>

        <span class="c1"># Should be approximately 3x fewer updates</span>
        <span class="n">reduction_ratio</span> <span class="o">=</span> <span class="n">old_progress_updates</span> <span class="o">/</span> <span class="n">new_progress_updates</span>
        <span class="k">assert</span> <span class="mf">2.5</span> <span class="o">&lt;=</span> <span class="n">reduction_ratio</span> <span class="o">&lt;=</span> <span class="mf">3.5</span>

    <span class="k">def</span> <span class="nf">_create_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a test dataset of specified size.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
                <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;test message </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> with content&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2023-01-01T00:00:00Z&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_chunk_size_performance_scaling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_size_performance_scaling</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that larger chunk sizes provide better performance characteristics.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_size_performance_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that larger chunk sizes provide better performance characteristics.&quot;&quot;&quot;</span>
    <span class="c1"># Create test datasets of different sizes</span>
    <span class="n">small_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
    <span class="n">medium_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>
    <span class="n">large_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>

    <span class="c1"># Test with different chunk sizes</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Old base size</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base size</span>

    <span class="c1"># For small datasets, chunk size should be optimized for data size</span>
    <span class="n">small_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">small_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">small_optimal</span> <span class="o">&lt;=</span> <span class="n">new_chunk_size</span>

    <span class="c1"># For medium datasets, should use larger chunks</span>
    <span class="n">medium_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">medium_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">medium_optimal</span> <span class="o">&gt;</span> <span class="n">old_chunk_size</span>

    <span class="c1"># For large datasets, should still be reasonable</span>
    <span class="n">large_optimal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">large_data</span><span class="p">),</span> <span class="n">new_chunk_size</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">large_optimal</span> <span class="o">&gt;=</span> <span class="n">old_chunk_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_io_operation_reduction_estimation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_io_operation_reduction_estimation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test estimation of I/O operation reduction.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_io_operation_reduction_estimation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test estimation of I/O operation reduction.&quot;&quot;&quot;</span>
    <span class="c1"># Simulate old vs new chunking for a 2M row dataset</span>
    <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">2_000_000</span>

    <span class="c1"># Old chunking: 50K base chunks</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
    <span class="n">old_num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset_size</span> <span class="o">+</span> <span class="n">old_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">old_chunk_size</span>

    <span class="c1"># New chunking: 150K base chunks (3x larger)</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>
    <span class="n">new_num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset_size</span> <span class="o">+</span> <span class="n">new_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

    <span class="c1"># Should have significantly fewer I/O operations</span>
    <span class="n">io_reduction_factor</span> <span class="o">=</span> <span class="n">old_num_chunks</span> <span class="o">/</span> <span class="n">new_num_chunks</span>
    <span class="k">assert</span> <span class="n">io_reduction_factor</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>  <span class="c1"># At least 2.5x fewer operations</span>
    <span class="k">assert</span> <span class="n">io_reduction_factor</span> <span class="o">&lt;=</span> <span class="mf">4.0</span>  <span class="c1"># Reasonable upper bound</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_memory_efficiency_improvements" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_efficiency_improvements</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory efficiency has improved with new chunking.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_efficiency_improvements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory efficiency has improved with new chunking.&quot;&quot;&quot;</span>
    <span class="c1"># Test memory manager with different configurations</span>
    <span class="n">old_memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>  <span class="c1"># Old hardcoded limit</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">new_memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>  <span class="c1"># Auto-detected limit</span>

        <span class="c1"># New manager should have higher limit on 16GB system</span>
        <span class="k">assert</span> <span class="n">new_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">&gt;</span> <span class="n">old_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span>

        <span class="c1"># Should be approximately 4.8GB for 16GB system</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">new_memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestPerformanceBenchmarks.test_progress_reporting_efficiency" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_progress_reporting_efficiency</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that progress reporting overhead is reduced with larger chunks.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_progress_reporting_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that progress reporting overhead is reduced with larger chunks.&quot;&quot;&quot;</span>
    <span class="c1"># Larger chunks mean fewer progress updates, reducing overhead</span>
    <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">1_000_000</span>

    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>

    <span class="n">old_progress_updates</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">//</span> <span class="n">old_chunk_size</span>
    <span class="n">new_progress_updates</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

    <span class="c1"># Should have fewer progress updates</span>
    <span class="k">assert</span> <span class="n">new_progress_updates</span> <span class="o">&lt;</span> <span class="n">old_progress_updates</span>

    <span class="c1"># Should be approximately 3x fewer updates</span>
    <span class="n">reduction_ratio</span> <span class="o">=</span> <span class="n">old_progress_updates</span> <span class="o">/</span> <span class="n">new_progress_updates</span>
    <span class="k">assert</span> <span class="mf">2.5</span> <span class="o">&lt;=</span> <span class="n">reduction_ratio</span> <span class="o">&lt;=</span> <span class="mf">3.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestRegressionPrevention" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestRegressionPrevention</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test that existing functionality is not broken.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestRegressionPrevention</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that existing functionality is not broken.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_existing_memory_manager_api_unchanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that existing MemoryManager API continues to work.&quot;&quot;&quot;</span>
        <span class="c1"># Test all existing methods still work</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="c1"># Core functionality</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_current_memory_usage&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_pressure_level&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;should_trigger_gc&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;enhanced_gc_cleanup&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_trend&quot;</span><span class="p">)</span>

        <span class="c1"># All methods should be callable</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="n">pressure</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">MemoryPressureLevel</span><span class="p">)</span>

        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test_existing_tests_still_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that optimization doesn&#39;t break existing functionality.&quot;&quot;&quot;</span>
        <span class="c1"># Test that basic memory management still works</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Memory usage detection</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;rss_bytes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vms_bytes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vms_mb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rss_gb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;system_available_gb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;system_used_percent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">stats</span>

        <span class="c1"># Adaptive chunk sizing with different operations</span>
        <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tokenization&quot;</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="c1"># Allow for operation-specific scaling (unique_extraction uses 1.2x factor)</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mf">1.2</span>  <span class="c1"># Allow for scaling up</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">10000</span>  <span class="c1"># Should not exceed base for most operations</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_memory_manager_api_unchanged" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_existing_memory_manager_api_unchanged</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that existing MemoryManager API continues to work.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_existing_memory_manager_api_unchanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that existing MemoryManager API continues to work.&quot;&quot;&quot;</span>
    <span class="c1"># Test all existing methods still work</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Core functionality</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_current_memory_usage&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_pressure_level&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;should_trigger_gc&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;enhanced_gc_cleanup&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_trend&quot;</span><span class="p">)</span>

    <span class="c1"># All methods should be callable</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="n">pressure</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">MemoryPressureLevel</span><span class="p">)</span>

    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestRegressionPrevention.test_existing_tests_still_pass" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_existing_tests_still_pass</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Ensure that optimization doesn't break existing functionality.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_existing_tests_still_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure that optimization doesn&#39;t break existing functionality.&quot;&quot;&quot;</span>
    <span class="c1"># Test that basic memory management still works</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Memory usage detection</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;rss_bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vms_bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vms_mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rss_gb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_available_gb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_used_percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">stats</span>

    <span class="c1"># Adaptive chunk sizing with different operations</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tokenization&quot;</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># Allow for operation-specific scaling (unique_extraction uses 1.2x factor)</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mf">1.2</span>  <span class="c1"># Allow for scaling up</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">10000</span>  <span class="c1"># Should not exceed base for most operations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestSecondaryAnalyzerUpdates</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test secondary analyzer chunk size updates.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestSecondaryAnalyzerUpdates</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test secondary analyzer chunk size updates.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_ngram_stats_chunk_limits_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that N-gram stats chunk limits increased significantly.&quot;&quot;&quot;</span>

        <span class="c1"># Simulate the new chunk calculation from Phase 4</span>
        <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="c1"># New formula: max(5_000, min(50_000, 500_000 // max(1, message_ngram_count // ngram_count)))</span>
            <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size_old</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="c1"># Old formula: max(1, min(10_000, 100_000 // max(1, message_ngram_count // ngram_count)))</span>
            <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">100_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

        <span class="c1"># Test with various realistic data sizes</span>
        <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">),</span>  <span class="c1"># Small dataset</span>
            <span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">),</span>  <span class="c1"># Medium dataset</span>
            <span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">),</span>  <span class="c1"># Large dataset</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
            <span class="n">new_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
                <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span>
            <span class="p">)</span>
            <span class="n">old_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size_old</span><span class="p">(</span>
                <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span>
            <span class="p">)</span>

            <span class="c1"># New chunks should be significantly larger</span>
            <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&gt;=</span> <span class="n">old_chunk</span>

            <span class="c1"># Minimum should be 5,000 instead of 1</span>
            <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&gt;=</span> <span class="mi">5_000</span>

            <span class="c1"># Maximum should be 50,000 instead of 10,000</span>
            <span class="k">if</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># Would hit maximum</span>
                <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&lt;=</span> <span class="mi">50_000</span>

    <span class="k">def</span> <span class="nf">test_ngram_stats_minimum_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that minimum chunk size increased from 1 to 5,000.&quot;&quot;&quot;</span>

        <span class="c1"># Test edge case where calculation would give very small result</span>
        <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

        <span class="c1"># Large message_ngram_count relative to ngram_count should hit minimum</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">5_000</span>  <span class="c1"># Should be minimum, not 1</span>

    <span class="k">def</span> <span class="nf">test_ngram_stats_maximum_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that maximum chunk size increased from 10,000 to 50,000.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

        <span class="c1"># Small message_ngram_count relative to ngram_count should hit maximum</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">50_000</span>  <span class="c1"># Should be new maximum, not 10,000</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_chunk_limits_updated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_ngram_stats_chunk_limits_updated</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that N-gram stats chunk limits increased significantly.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_ngram_stats_chunk_limits_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that N-gram stats chunk limits increased significantly.&quot;&quot;&quot;</span>

    <span class="c1"># Simulate the new chunk calculation from Phase 4</span>
    <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
        <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># New formula: max(5_000, min(50_000, 500_000 // max(1, message_ngram_count // ngram_count)))</span>
        <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size_old</span><span class="p">(</span>
        <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># Old formula: max(1, min(10_000, 100_000 // max(1, message_ngram_count // ngram_count)))</span>
        <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">100_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

    <span class="c1"># Test with various realistic data sizes</span>
    <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">),</span>  <span class="c1"># Small dataset</span>
        <span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">),</span>  <span class="c1"># Medium dataset</span>
        <span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">),</span>  <span class="c1"># Large dataset</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
        <span class="n">new_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span>
        <span class="p">)</span>
        <span class="n">old_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size_old</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">,</span> <span class="n">ngram_count</span>
        <span class="p">)</span>

        <span class="c1"># New chunks should be significantly larger</span>
        <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&gt;=</span> <span class="n">old_chunk</span>

        <span class="c1"># Minimum should be 5,000 instead of 1</span>
        <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&gt;=</span> <span class="mi">5_000</span>

        <span class="c1"># Maximum should be 50,000 instead of 10,000</span>
        <span class="k">if</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># Would hit maximum</span>
            <span class="k">assert</span> <span class="n">new_chunk</span> <span class="o">&lt;=</span> <span class="mi">50_000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_maximum_chunk_increase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_ngram_stats_maximum_chunk_increase</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that maximum chunk size increased from 10,000 to 50,000.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_ngram_stats_maximum_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that maximum chunk size increased from 10,000 to 50,000.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
        <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

    <span class="c1"># Small message_ngram_count relative to ngram_count should hit maximum</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">50_000</span>  <span class="c1"># Should be new maximum, not 10,000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSecondaryAnalyzerUpdates.test_ngram_stats_minimum_chunk_increase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_ngram_stats_minimum_chunk_increase</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that minimum chunk size increased from 1 to 5,000.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_ngram_stats_minimum_chunk_increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that minimum chunk size increased from 1 to 5,000.&quot;&quot;&quot;</span>

    <span class="c1"># Test edge case where calculation would give very small result</span>
    <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk_size</span><span class="p">(</span>
        <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

    <span class="c1"># Large message_ngram_count relative to ngram_count should hit minimum</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk_size</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">5_000</span>  <span class="c1"># Should be minimum, not 1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_chunking_optimization.TestSystemConfigurationValidation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestSystemConfigurationValidation</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test system configuration detection and validation.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestSystemConfigurationValidation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test system configuration detection and validation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_usage_stays_within_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory usage stays within auto-detected limits.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test 16GB system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should allocate 30% of 16GB = 4.8GB</span>
            <span class="n">expected_limit</span> <span class="o">=</span> <span class="mf">4.8</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Memory usage should not exceed the limit during processing</span>
            <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

            <span class="c1"># Simulate some memory usage</span>
            <span class="n">large_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
            <span class="n">current_memory</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

            <span class="c1"># Should still be within reasonable bounds</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">current_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.2</span>
            <span class="p">)</span>  <span class="c1"># 20% tolerance</span>

    <span class="k">def</span> <span class="nf">test_memory_pressure_detection_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory pressure detection works accurately with new thresholds.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
            <span class="c1"># Test LOW pressure (below 70%)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

            <span class="c1"># Test MEDIUM pressure (70-80%)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>

            <span class="c1"># Test HIGH pressure (80-90%)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.85</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>

            <span class="c1"># Test CRITICAL pressure (&gt;90%)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>

    <span class="k">def</span> <span class="nf">test_auto_detection_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test auto-detection handles edge cases properly.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test exactly at boundaries</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 8GB</span>
            <span class="n">limit_8gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_8gb</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 25%</span>

            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 16GB</span>
            <span class="n">limit_16gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_16gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 30%</span>

            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 32GB</span>
            <span class="n">limit_32gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_32gb</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 40%</span>

            <span class="c1"># Test very small system</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 2GB</span>
            <span class="n">limit_2gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_2gb</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 20%</span>

    <span class="k">def</span> <span class="nf">test_backward_compatibility_preserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that manual override still works exactly as before.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="c1"># Manual override should bypass auto-detection completely</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">2.0</span>

            <span class="c1"># Should work with any value, even unreasonable ones</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">100.0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_auto_detection_edge_cases" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_auto_detection_edge_cases</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test auto-detection handles edge cases properly.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_auto_detection_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test auto-detection handles edge cases properly.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test exactly at boundaries</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 8GB</span>
        <span class="n">limit_8gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_8gb</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 25%</span>

        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 16GB</span>
        <span class="n">limit_16gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_16gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 30%</span>

        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># Exactly 32GB</span>
        <span class="n">limit_32gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_32gb</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 40%</span>

        <span class="c1"># Test very small system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 2GB</span>
        <span class="n">limit_2gb</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limit_2gb</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>  <span class="c1"># Should be 20%</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_backward_compatibility_preserved" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_backward_compatibility_preserved</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that manual override still works exactly as before.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_backward_compatibility_preserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that manual override still works exactly as before.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="c1"># Manual override should bypass auto-detection completely</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">2.0</span>

        <span class="c1"># Should work with any value, even unreasonable ones</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">100.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_pressure_detection_accuracy" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_pressure_detection_accuracy</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory pressure detection works accurately with new thresholds.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_pressure_detection_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory pressure detection works accurately with new thresholds.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
        <span class="c1"># Test LOW pressure (below 70%)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

        <span class="c1"># Test MEDIUM pressure (70-80%)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>

        <span class="c1"># Test HIGH pressure (80-90%)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.85</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>

        <span class="c1"># Test CRITICAL pressure (&gt;90%)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_chunking_optimization.TestSystemConfigurationValidation.test_memory_usage_stays_within_bounds" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_usage_stays_within_bounds</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory usage stays within auto-detected limits.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_chunking_optimization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_usage_stays_within_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory usage stays within auto-detected limits.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test 16GB system</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Should allocate 30% of 16GB = 4.8GB</span>
        <span class="n">expected_limit</span> <span class="o">=</span> <span class="mf">4.8</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Memory usage should not exceed the limit during processing</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Simulate some memory usage</span>
        <span class="n">large_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
        <span class="n">current_memory</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Should still be within reasonable bounds</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">current_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.2</span>
        <span class="p">)</span>  <span class="c1"># 20% tolerance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="testing.performance.test_enhanced_benchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_enhanced_benchmarks</code>


</h4>

    <div class="doc doc-contents ">

        <p>Enhanced Performance Benchmarking Tests using pytest-benchmark
Implements robust, statistics-driven benchmarks with resource-based metrics.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestBenchmarkIntegration</code>


</h5>


    <div class="doc doc-contents ">


        <p>Tests for benchmark configuration and integration.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">benchmark</span>
<span class="k">class</span> <span class="nc">TestBenchmarkIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for benchmark configuration and integration.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_benchmark_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that benchmark configuration works correctly.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">simple_operation</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">simple_operation</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_benchmark_with_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test benchmark with setup/teardown operations.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">pedantic</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">25000</span>  <span class="c1"># Half should be even</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_configuration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_benchmark_configuration</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that benchmark configuration works correctly.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_benchmark_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that benchmark configuration works correctly.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">simple_operation</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">simple_operation</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestBenchmarkIntegration.test_benchmark_with_setup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_benchmark_with_setup</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test benchmark with setup/teardown operations.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_benchmark_with_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test benchmark with setup/teardown operations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">pedantic</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">25000</span>  <span class="c1"># Half should be even</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestEnhancedPerformanceBenchmarks</code>


</h5>


    <div class="doc doc-contents ">


        <p>Enhanced performance benchmarking suite using pytest-benchmark.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">benchmark</span>
<span class="k">class</span> <span class="nc">TestEnhancedPerformanceBenchmarks</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced performance benchmarking suite using pytest-benchmark.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up test environment before each test.&quot;&quot;&quot;</span>
        <span class="c1"># Force garbage collection to start with clean state</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Get baseline memory usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

    <span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up after each test.&quot;&quot;&quot;</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_realistic_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_messages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a realistic test dataset with variable message lengths.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="c1"># Common words for realistic n-gram generation</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;the&quot;</span><span class="p">,</span>
            <span class="s2">&quot;and&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is&quot;</span><span class="p">,</span>
            <span class="s2">&quot;in&quot;</span><span class="p">,</span>
            <span class="s2">&quot;to&quot;</span><span class="p">,</span>
            <span class="s2">&quot;of&quot;</span><span class="p">,</span>
            <span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="s2">&quot;for&quot;</span><span class="p">,</span>
            <span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="s2">&quot;with&quot;</span><span class="p">,</span>
            <span class="s2">&quot;as&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by&quot;</span><span class="p">,</span>
            <span class="s2">&quot;be&quot;</span><span class="p">,</span>
            <span class="s2">&quot;at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;this&quot;</span><span class="p">,</span>
            <span class="s2">&quot;that&quot;</span><span class="p">,</span>
            <span class="s2">&quot;from&quot;</span><span class="p">,</span>
            <span class="s2">&quot;they&quot;</span><span class="p">,</span>
            <span class="s2">&quot;we&quot;</span><span class="p">,</span>
            <span class="s2">&quot;you&quot;</span><span class="p">,</span>
            <span class="s2">&quot;have&quot;</span><span class="p">,</span>
            <span class="s2">&quot;has&quot;</span><span class="p">,</span>
            <span class="s2">&quot;had&quot;</span><span class="p">,</span>
            <span class="s2">&quot;will&quot;</span><span class="p">,</span>
            <span class="s2">&quot;would&quot;</span><span class="p">,</span>
            <span class="s2">&quot;could&quot;</span><span class="p">,</span>
            <span class="s2">&quot;should&quot;</span><span class="p">,</span>
            <span class="s2">&quot;can&quot;</span><span class="p">,</span>
            <span class="s2">&quot;may&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;analysis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;social&quot;</span><span class="p">,</span>
            <span class="s2">&quot;media&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comment&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hashtag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trend&quot;</span><span class="p">,</span>
            <span class="s2">&quot;viral&quot;</span><span class="p">,</span>
            <span class="s2">&quot;engagement&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reach&quot;</span><span class="p">,</span>
            <span class="s2">&quot;impression&quot;</span><span class="p">,</span>
            <span class="s2">&quot;click&quot;</span><span class="p">,</span>
            <span class="s2">&quot;like&quot;</span><span class="p">,</span>
            <span class="s2">&quot;share&quot;</span><span class="p">,</span>
            <span class="s2">&quot;retweet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;follow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;followers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;following&quot;</span><span class="p">,</span>
            <span class="s2">&quot;account&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_messages</span><span class="p">):</span>
            <span class="c1"># Variable message length (10-40 tokens)</span>
            <span class="n">num_tokens</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="n">avg_tokens_per_message</span> <span class="o">+</span> <span class="mi">20</span>
            <span class="p">)</span>

            <span class="c1"># Generate message with realistic word distribution</span>
            <span class="n">message_words</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tokens</span><span class="p">):</span>
                <span class="c1"># Higher probability for common words</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># Very common words</span>
                <span class="k">elif</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>  <span class="c1"># Common words</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>  <span class="c1"># All words</span>

                <span class="n">message_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message_words</span><span class="p">),</span>
                    <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">num_messages</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># 10% unique users</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;2023-01-</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">T</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00:00Z&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_chunks_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate old chunk processing approach.&quot;&quot;&quot;</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate processing work (tokenization, basic operations)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;author_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">num_chunks</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Simulate memory cleanup every few chunks</span>
            <span class="k">if</span> <span class="n">num_chunks</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">num_chunks</span>

    <span class="k">def</span> <span class="nf">_process_chunks_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate new optimized chunk processing approach.&quot;&quot;&quot;</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate processing work (tokenization, basic operations)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;author_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">num_chunks</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Optimized memory cleanup - less frequent</span>
            <span class="k">if</span> <span class="n">num_chunks</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">num_chunks</span>

    <span class="c1"># Phase 2: pytest-benchmark Integration</span>

    <span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_small</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Benchmark chunk processing performance on small datasets.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Benchmark the new optimized approach</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">200_000</span><span class="p">)</span>

        <span class="c1"># The benchmark fixture handles statistical analysis automatically</span>
        <span class="c1"># We can still do basic validation</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Should process at least one chunk&quot;</span>

    <span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_medium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Benchmark chunk processing performance on medium datasets.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1"># Benchmark the new optimized approach</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Should process at least one chunk&quot;</span>

    <span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare old vs new chunk processing approaches using pytest-benchmark.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">300_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="c1"># This test demonstrates how to use benchmark.pedantic for more control</span>
        <span class="c1"># We&#39;ll implement this as a property-based test instead</span>

    <span class="c1"># Phase 3: Resource-Based Metrics (Deterministic)</span>

    <span class="k">def</span> <span class="nf">test_chunk_efficiency_invariant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that larger chunks always result in fewer I/O operations.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># ~20 chunks</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># ~7 chunks</span>

        <span class="n">old_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
        <span class="n">new_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>

        <span class="c1"># These assertions will ALWAYS pass regardless of system performance</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">new_chunks</span> <span class="o">&lt;</span> <span class="n">old_chunks</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New chunks (</span><span class="si">{</span><span class="n">new_chunks</span><span class="si">}</span><span class="s2">) should be fewer than old chunks (</span><span class="si">{</span><span class="n">old_chunks</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="n">expected_reduction</span> <span class="o">=</span> <span class="n">old_chunks</span> <span class="o">/</span> <span class="n">new_chunks</span> <span class="k">if</span> <span class="n">new_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">old_chunks</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">expected_reduction</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2.5x I/O reduction, got </span><span class="si">{</span><span class="n">expected_reduction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_efficiency_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate memory usage stays within acceptable limits.&quot;&quot;&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>

        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1"># Process with new chunk size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

        <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">memory_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

        <span class="c1"># Reasonable memory bounds based on dataset size</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="mi">500</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage increased by </span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB, should be &lt; 500MB&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;dataset_size&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">,</span> <span class="mi">1_000_000</span><span class="p">])</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;chunk_factor&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_chunk_size_scaling_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_factor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that chunk size scaling behaves predictably.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span>
        <span class="p">)</span>

        <span class="n">small_chunk</span> <span class="o">=</span> <span class="mi">50_000</span>
        <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">small_chunk</span> <span class="o">*</span> <span class="n">chunk_factor</span>

        <span class="n">small_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">small_chunk</span><span class="p">)</span>
        <span class="n">large_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">large_chunk</span><span class="p">)</span>

        <span class="c1"># Mathematical relationship should always hold</span>
        <span class="n">expected_reduction</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chunk_factor</span><span class="p">,</span> <span class="n">dataset_size</span> <span class="o">/</span> <span class="n">small_chunk</span><span class="p">)</span>
        <span class="n">actual_reduction</span> <span class="o">=</span> <span class="n">small_ops</span> <span class="o">/</span> <span class="n">large_ops</span> <span class="k">if</span> <span class="n">large_ops</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">small_ops</span>

        <span class="c1"># Allow 20% tolerance for edge cases</span>
        <span class="k">assert</span> <span class="n">actual_reduction</span> <span class="o">&gt;=</span> <span class="n">expected_reduction</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x reduction, got </span><span class="si">{</span><span class="n">actual_reduction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(dataset_size=</span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2">, chunk_factor=</span><span class="si">{</span><span class="n">chunk_factor</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_io_operation_counting_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test I/O operation counting produces deterministic results.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">750_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Multiple runs should produce identical chunk counts</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">125_000</span>

        <span class="n">run1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">run2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">run3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">run1</span> <span class="o">==</span> <span class="n">run2</span> <span class="o">==</span> <span class="n">run3</span><span class="p">,</span> <span class="s2">&quot;Chunk counting should be deterministic&quot;</span>

        <span class="c1"># Verify mathematical correctness</span>
        <span class="n">expected_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">+</span> <span class="n">chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">chunk_size</span>
        <span class="k">assert</span> <span class="n">run1</span> <span class="o">==</span> <span class="n">expected_chunks</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_chunks</span><span class="si">}</span><span class="s2"> chunks, got </span><span class="si">{</span><span class="n">run1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_usage_scaling_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory usage scaling properties with different dataset sizes.&quot;&quot;&quot;</span>
        <span class="n">dataset_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">200_000</span><span class="p">,</span> <span class="mi">400_000</span><span class="p">]</span>
        <span class="n">memory_usages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>  <span class="c1"># Clean slate</span>
            <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

            <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
            <span class="n">memory_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>
            <span class="n">memory_usages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_increase</span><span class="p">)</span>

            <span class="c1"># Clean up</span>
            <span class="k">del</span> <span class="n">dataset</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Memory usage should scale reasonably with dataset size</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_usages</span><span class="p">)):</span>
            <span class="n">size_ratio</span> <span class="o">=</span> <span class="n">dataset_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataset_sizes</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">memory_ratio</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">else</span> <span class="mi">1</span>
            <span class="p">)</span>

            <span class="c1"># Memory should not scale worse than linearly with dataset size</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">memory_ratio</span> <span class="o">&lt;=</span> <span class="n">size_ratio</span> <span class="o">*</span> <span class="mf">1.5</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory scaling too aggressive: </span><span class="si">{</span><span class="n">memory_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x for </span><span class="si">{</span><span class="n">size_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x data increase&quot;</span>

    <span class="c1"># Phase 4: Enhanced Infrastructure Tests</span>

    <span class="k">def</span> <span class="nf">test_chunk_processing_variance_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze variance in chunk processing to validate benchmark reliability.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">100_000</span>

        <span class="c1"># Measure multiple runs</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>

        <span class="c1"># Calculate coefficient of variation (CV)</span>
        <span class="n">mean_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">mean_time</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">std_dev</span> <span class="o">=</span> <span class="n">variance</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">std_dev</span> <span class="o">/</span> <span class="n">mean_time</span> <span class="k">if</span> <span class="n">mean_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Coefficient of variation should be reasonable (&lt; 30%)</span>
        <span class="k">assert</span> <span class="n">cv</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;High variance in processing times: CV = </span><span class="si">{</span><span class="n">cv</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># All runs should produce the same number of chunks</span>
        <span class="n">chunk_counts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
            <span class="n">chunk_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_counts</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Chunk counts should be deterministic&quot;</span>

    <span class="k">def</span> <span class="nf">test_performance_regression_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test framework for detecting performance regressions.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">400_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

        <span class="c1"># Baseline performance (optimized)</span>
        <span class="n">baseline_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_operation</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Simulated regression (using old, slower approach)</span>
        <span class="n">regression_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_operation</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_old</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Should detect significant regression</span>
        <span class="n">regression_ratio</span> <span class="o">=</span> <span class="n">regression_time</span> <span class="o">/</span> <span class="n">baseline_time</span> <span class="k">if</span> <span class="n">baseline_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="c1"># This would fail if we had a real regression &gt; 50%</span>
        <span class="c1"># In test, we expect the old approach to be slower</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">regression_ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span>
        <span class="p">),</span> <span class="s2">&quot;Should detect performance difference between approaches&quot;</span>

    <span class="c1"># Helper Methods</span>

    <span class="k">def</span> <span class="nf">_count_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count I/O operations (chunks) for deterministic testing.&quot;&quot;&quot;</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dataset_size</span> <span class="o">+</span> <span class="n">chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">chunk_size</span>

    <span class="k">def</span> <span class="nf">_time_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time an operation with proper setup/cleanup.&quot;&quot;&quot;</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">operation</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.setup_method" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">setup_method</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Set up test environment before each test.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up test environment before each test.&quot;&quot;&quot;</span>
    <span class="c1"># Force garbage collection to start with clean state</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Get baseline memory usage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.teardown_method" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">teardown_method</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Clean up after each test.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up after each test.&quot;&quot;&quot;</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_efficiency_invariant" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_efficiency_invariant</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that larger chunks always result in fewer I/O operations.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_efficiency_invariant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that larger chunks always result in fewer I/O operations.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># ~20 chunks</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># ~7 chunks</span>

    <span class="n">old_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
    <span class="n">new_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>

    <span class="c1"># These assertions will ALWAYS pass regardless of system performance</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">new_chunks</span> <span class="o">&lt;</span> <span class="n">old_chunks</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New chunks (</span><span class="si">{</span><span class="n">new_chunks</span><span class="si">}</span><span class="s2">) should be fewer than old chunks (</span><span class="si">{</span><span class="n">old_chunks</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">expected_reduction</span> <span class="o">=</span> <span class="n">old_chunks</span> <span class="o">/</span> <span class="n">new_chunks</span> <span class="k">if</span> <span class="n">new_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">old_chunks</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">expected_reduction</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2.5x I/O reduction, got </span><span class="si">{</span><span class="n">expected_reduction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_comparison" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_processing_benchmark_comparison</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Compare old vs new chunk processing approaches using pytest-benchmark.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare old vs new chunk processing approaches using pytest-benchmark.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">300_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_medium" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_processing_benchmark_medium</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Benchmark chunk processing performance on medium datasets.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_medium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark chunk processing performance on medium datasets.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># Benchmark the new optimized approach</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Should process at least one chunk&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_benchmark_small" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_processing_benchmark_small</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Benchmark chunk processing performance on small datasets.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_processing_benchmark_small</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark chunk processing performance on small datasets.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Benchmark the new optimized approach</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="mi">200_000</span><span class="p">)</span>

    <span class="c1"># The benchmark fixture handles statistical analysis automatically</span>
    <span class="c1"># We can still do basic validation</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Should process at least one chunk&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_processing_variance_analysis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_processing_variance_analysis</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Analyze variance in chunk processing to validate benchmark reliability.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunk_processing_variance_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze variance in chunk processing to validate benchmark reliability.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">100_000</span>

    <span class="c1"># Measure multiple runs</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>

    <span class="c1"># Calculate coefficient of variation (CV)</span>
    <span class="n">mean_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">mean_time</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">std_dev</span> <span class="o">=</span> <span class="n">variance</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">std_dev</span> <span class="o">/</span> <span class="n">mean_time</span> <span class="k">if</span> <span class="n">mean_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Coefficient of variation should be reasonable (&lt; 30%)</span>
    <span class="k">assert</span> <span class="n">cv</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;High variance in processing times: CV = </span><span class="si">{</span><span class="n">cv</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># All runs should produce the same number of chunks</span>
    <span class="n">chunk_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">chunk_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_counts</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Chunk counts should be deterministic&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_chunk_size_scaling_properties" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunk_size_scaling_properties</span><span class="p">(</span><span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_factor</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that chunk size scaling behaves predictably.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;dataset_size&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">,</span> <span class="mi">1_000_000</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;chunk_factor&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_chunk_size_scaling_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that chunk size scaling behaves predictably.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">16</span>
    <span class="p">)</span>

    <span class="n">small_chunk</span> <span class="o">=</span> <span class="mi">50_000</span>
    <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">small_chunk</span> <span class="o">*</span> <span class="n">chunk_factor</span>

    <span class="n">small_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">small_chunk</span><span class="p">)</span>
    <span class="n">large_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">large_chunk</span><span class="p">)</span>

    <span class="c1"># Mathematical relationship should always hold</span>
    <span class="n">expected_reduction</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chunk_factor</span><span class="p">,</span> <span class="n">dataset_size</span> <span class="o">/</span> <span class="n">small_chunk</span><span class="p">)</span>
    <span class="n">actual_reduction</span> <span class="o">=</span> <span class="n">small_ops</span> <span class="o">/</span> <span class="n">large_ops</span> <span class="k">if</span> <span class="n">large_ops</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">small_ops</span>

    <span class="c1"># Allow 20% tolerance for edge cases</span>
    <span class="k">assert</span> <span class="n">actual_reduction</span> <span class="o">&gt;=</span> <span class="n">expected_reduction</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x reduction, got </span><span class="si">{</span><span class="n">actual_reduction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(dataset_size=</span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2">, chunk_factor=</span><span class="si">{</span><span class="n">chunk_factor</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_io_operation_counting_deterministic" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_io_operation_counting_deterministic</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test I/O operation counting produces deterministic results.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_io_operation_counting_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test I/O operation counting produces deterministic results.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">750_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Multiple runs should produce identical chunk counts</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">125_000</span>

    <span class="n">run1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">run2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">run3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_operations</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">run1</span> <span class="o">==</span> <span class="n">run2</span> <span class="o">==</span> <span class="n">run3</span><span class="p">,</span> <span class="s2">&quot;Chunk counting should be deterministic&quot;</span>

    <span class="c1"># Verify mathematical correctness</span>
    <span class="n">expected_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">+</span> <span class="n">chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">chunk_size</span>
    <span class="k">assert</span> <span class="n">run1</span> <span class="o">==</span> <span class="n">expected_chunks</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_chunks</span><span class="si">}</span><span class="s2"> chunks, got </span><span class="si">{</span><span class="n">run1</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_efficiency_bounds" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_efficiency_bounds</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Validate memory usage stays within acceptable limits.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_efficiency_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate memory usage stays within acceptable limits.&quot;&quot;&quot;</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>

    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># Process with new chunk size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

    <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">memory_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

    <span class="c1"># Reasonable memory bounds based on dataset size</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage increased by </span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB, should be &lt; 500MB&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_memory_usage_scaling_properties" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_usage_scaling_properties</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test memory usage scaling properties with different dataset sizes.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_usage_scaling_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory usage scaling properties with different dataset sizes.&quot;&quot;&quot;</span>
    <span class="n">dataset_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">200_000</span><span class="p">,</span> <span class="mi">400_000</span><span class="p">]</span>
    <span class="n">memory_usages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="p">:</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>  <span class="c1"># Clean slate</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>

        <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">memory_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>
        <span class="n">memory_usages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_increase</span><span class="p">)</span>

        <span class="c1"># Clean up</span>
        <span class="k">del</span> <span class="n">dataset</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Memory usage should scale reasonably with dataset size</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_usages</span><span class="p">)):</span>
        <span class="n">size_ratio</span> <span class="o">=</span> <span class="n">dataset_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataset_sizes</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">memory_ratio</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">memory_usages</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># Memory should not scale worse than linearly with dataset size</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">memory_ratio</span> <span class="o">&lt;=</span> <span class="n">size_ratio</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory scaling too aggressive: </span><span class="si">{</span><span class="n">memory_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x for </span><span class="si">{</span><span class="n">size_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x data increase&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_enhanced_benchmarks.TestEnhancedPerformanceBenchmarks.test_performance_regression_detection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_performance_regression_detection</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test framework for detecting performance regressions.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_enhanced_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_performance_regression_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test framework for detecting performance regressions.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">400_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="c1"># Baseline performance (optimized)</span>
    <span class="n">baseline_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_operation</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_new</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">150_000</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Simulated regression (using old, slower approach)</span>
    <span class="n">regression_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_operation</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunks_old</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Should detect significant regression</span>
    <span class="n">regression_ratio</span> <span class="o">=</span> <span class="n">regression_time</span> <span class="o">/</span> <span class="n">baseline_time</span> <span class="k">if</span> <span class="n">baseline_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="c1"># This would fail if we had a real regression &gt; 50%</span>
    <span class="c1"># In test, we expect the old approach to be slower</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">regression_ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span>
    <span class="p">),</span> <span class="s2">&quot;Should detect performance difference between approaches&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="testing.performance.test_integration_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_integration_validation</code>


</h4>

    <div class="doc doc-contents ">

        <p>Integration Validation Tests for Chunking Optimization</p>
<p>Tests that validate the complete chunking optimization implementation works
end-to-end and meets the performance targets specified in the optimization spec.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestChunkingOptimizationIntegration</code>


</h5>


    <div class="doc doc-contents ">


        <p>Integration tests for complete chunking optimization.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestChunkingOptimizationIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests for complete chunking optimization.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_manager_auto_detection_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that MemoryManager auto-detection works end-to-end.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test 16GB system detection</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="c1"># Should auto-detect 4.8GB (30% of 16GB)</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Should log the auto-detection</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">==</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="k">def</span> <span class="nf">test_adaptive_chunk_calculation_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that adaptive chunk calculation integrates with memory detection.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Test different system configurations</span>
            <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 8GB system, 1.0x factor</span>
                <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 16GB system, 1.5x factor</span>
                <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 32GB system, 2.0x factor</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">total_memory</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_memory</span>

                <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

                <span class="c1"># Test chunk size calculation with the memory manager</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
                <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                    <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Should be within reasonable bounds</span>
                <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">adaptive_chunk</span> <span class="o">&gt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mf">0.3</span>
                <span class="p">)</span>  <span class="c1"># Allow for pressure reduction</span>

                <span class="c1"># For low pressure, should be at or below base chunk</span>
                <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
                    <span class="c1"># Simulate low memory usage (50% of max) for LOW pressure</span>
                    <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>

                    <span class="n">low_pressure_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                        <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
                    <span class="p">)</span>

                    <span class="c1"># Should use operation-specific adjustment</span>
                    <span class="c1"># N-gram generation typically gets reduced chunk size</span>
                    <span class="k">assert</span> <span class="n">low_pressure_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span>

    <span class="k">def</span> <span class="nf">test_chunking_optimization_phase_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that all optimization phases work together correctly.&quot;&quot;&quot;</span>
        <span class="c1"># Test the complete integration of all phases</span>

        <span class="c1"># Phase 1: Memory auto-detection</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should detect 16GB system and allocate 4.8GB</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Phase 2: Adaptive chunking should use memory manager</span>
            <span class="c1"># Simulate the calculate_optimal_chunk_size function from ngrams_base</span>
            <span class="k">def</span> <span class="nf">calculate_optimal_chunk_size</span><span class="p">(</span>
                <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">memory_manager</span><span class="p">:</span>
                    <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
                    <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
                    <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
                    <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

            <span class="c1"># Test medium dataset on 16GB system</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">manager</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

            <span class="c1"># Phase 3: Fallback thresholds should be memory-aware</span>
            <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

            <span class="c1"># 16GB system should get 1.5M threshold</span>
            <span class="k">assert</span> <span class="n">fallback_threshold</span> <span class="o">==</span> <span class="mi">1_500_000</span>

            <span class="c1"># Phase 4: Secondary analyzer chunks should be larger</span>
            <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk</span><span class="p">(</span>
                <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

            <span class="c1"># Should use new larger bounds</span>
            <span class="n">stats_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">stats_chunk</span> <span class="o">&gt;=</span> <span class="mi">5_000</span>  <span class="c1"># New minimum</span>
            <span class="k">assert</span> <span class="n">stats_chunk</span> <span class="o">&lt;=</span> <span class="mi">50_000</span>  <span class="c1"># New maximum</span>

    <span class="k">def</span> <span class="nf">test_performance_improvements_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that performance improvements are measurable.&quot;&quot;&quot;</span>
        <span class="c1"># Create test datasets to measure performance differences</span>
        <span class="n">small_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">50_000</span><span class="p">)</span>
        <span class="n">medium_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">)</span>

        <span class="c1"># Test old vs new chunk processing using medium dataset for meaningful comparison</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base</span>

        <span class="c1"># Measure old approach</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">old_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_processing</span><span class="p">(</span><span class="n">medium_dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
        <span class="n">old_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Measure new approach</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">new_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_processing</span><span class="p">(</span><span class="n">medium_dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Should have fewer chunks (better I/O efficiency)</span>
        <span class="k">assert</span> <span class="n">new_chunks</span> <span class="o">&lt;</span> <span class="n">old_chunks</span>

        <span class="c1"># Should be faster (allowing for test variability)</span>
        <span class="k">if</span> <span class="n">new_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">improvement</span> <span class="o">=</span> <span class="n">old_time</span> <span class="o">/</span> <span class="n">new_time</span>
            <span class="k">assert</span> <span class="n">improvement</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>  <span class="c1"># At least no regression</span>

        <span class="c1"># Test chunk count reduction</span>
        <span class="n">expected_reduction</span> <span class="o">=</span> <span class="n">old_chunk_size</span> <span class="o">/</span> <span class="n">new_chunk_size</span>
        <span class="k">if</span> <span class="n">expected_reduction</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">actual_reduction</span> <span class="o">=</span> <span class="n">old_chunks</span> <span class="o">/</span> <span class="n">new_chunks</span> <span class="k">if</span> <span class="n">new_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="n">actual_reduction</span> <span class="o">&gt;=</span> <span class="n">expected_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>  <span class="c1"># Allow 20% tolerance</span>

    <span class="k">def</span> <span class="nf">test_memory_bounds_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory usage stays within auto-detected bounds.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Get initial memory usage</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="n">initial_rss_gb</span> <span class="o">=</span> <span class="n">initial_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span>

        <span class="c1"># Should be well below the limit initially</span>
        <span class="k">assert</span> <span class="n">initial_rss_gb</span> <span class="o">&lt;</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span>

        <span class="c1"># Simulate memory usage with adaptive chunk sizing</span>
        <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tokenization&quot;</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">]:</span>
            <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_chunk</span><span class="p">,</span> <span class="n">operation</span>
            <span class="p">)</span>

            <span class="c1"># Should be positive and reasonable</span>
            <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="p">)</span>  <span class="c1"># Allow some scaling up for certain operations</span>

        <span class="c1"># Memory should still be reasonable</span>
        <span class="n">current_memory</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="n">current_rss_gb</span> <span class="o">=</span> <span class="n">current_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span>

        <span class="c1"># Should not have exceeded reasonable bounds</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">current_rss_gb</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="p">)</span>  <span class="c1"># 50% tolerance for test overhead</span>

    <span class="k">def</span> <span class="nf">test_backward_compatibility_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that backward compatibility is preserved.&quot;&quot;&quot;</span>
        <span class="c1"># Manual override should still work exactly as before</span>
        <span class="n">manual_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">2.0</span>

        <span class="c1"># All existing API methods should still work</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;get_current_memory_usage&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_pressure_level&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;enhanced_gc_cleanup&quot;</span><span class="p">)</span>

        <span class="c1"># Methods should return expected types</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="n">pressure</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>  <span class="c1"># Should be an enum</span>

        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test_system_specific_optimization_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that optimizations are appropriate for different system types.&quot;&quot;&quot;</span>
        <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># 4GB: 20% allocation, 0.5x chunks</span>
            <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 8GB: 25% allocation, 1.0x chunks</span>
            <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 16GB: 30% allocation, 1.5x chunks</span>
            <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 32GB: 40% allocation, 2.0x chunks</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">total_memory</span><span class="p">,</span> <span class="n">system_type</span><span class="p">,</span> <span class="n">expected_limit</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_memory</span>

                <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

                <span class="c1"># Should detect appropriate memory limit</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">system_type</span><span class="si">}</span><span class="s2"> system should allocate </span><span class="si">{</span><span class="n">expected_limit</span><span class="si">}</span><span class="s2">GB&quot;</span>

                <span class="c1"># Should use appropriate chunk scaling</span>
                <span class="n">total_gb</span> <span class="o">=</span> <span class="n">total_memory</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
                <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                    <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                    <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

                <span class="k">assert</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">chunk_factor</span> <span class="o">-</span> <span class="n">expected_factor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">system_type</span><span class="si">}</span><span class="s2"> system should use </span><span class="si">{</span><span class="n">expected_factor</span><span class="si">}</span><span class="s2">x chunk factor&quot;</span>

    <span class="k">def</span> <span class="nf">test_error_handling_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that error handling works correctly in integration scenarios.&quot;&quot;&quot;</span>
        <span class="c1"># Test with very low memory limit</span>
        <span class="n">constrained_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># 100MB</span>

        <span class="c1"># Should still provide reasonable chunk sizes</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;=</span> <span class="mi">1000</span>  <span class="c1"># Should enforce some minimum</span>

        <span class="c1"># Test with extreme memory pressure</span>
        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">constrained_manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
            <span class="c1"># Simulate critical memory usage (95% of max)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="mf">0.95</span> <span class="o">*</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">max_memory_bytes</span>
            <span class="p">)</span>

            <span class="n">critical_chunk</span> <span class="o">=</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Should drastically reduce chunk size but still be usable</span>
            <span class="k">assert</span> <span class="n">critical_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">critical_chunk</span> <span class="o">&lt;</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># Should be significantly reduced</span>

    <span class="k">def</span> <span class="nf">_create_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a test dataset for benchmarking.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;test message </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> with some content&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2023-01-01T00:00:00Z&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_simulate_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate chunk processing and return number of chunks.&quot;&quot;&quot;</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate some processing work</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len_chars</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">num_chunks</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">num_chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_adaptive_chunk_calculation_integration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_adaptive_chunk_calculation_integration</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that adaptive chunk calculation integrates with memory detection.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_adaptive_chunk_calculation_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that adaptive chunk calculation integrates with memory detection.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test different system configurations</span>
        <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 8GB system, 1.0x factor</span>
            <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 16GB system, 1.5x factor</span>
            <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 32GB system, 2.0x factor</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">total_memory</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_memory</span>

            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Test chunk size calculation with the memory manager</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
            <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Should be within reasonable bounds</span>
            <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">adaptive_chunk</span> <span class="o">&gt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mf">0.3</span>
            <span class="p">)</span>  <span class="c1"># Allow for pressure reduction</span>

            <span class="c1"># For low pressure, should be at or below base chunk</span>
            <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
                <span class="c1"># Simulate low memory usage (50% of max) for LOW pressure</span>
                <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>

                <span class="n">low_pressure_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                    <span class="n">base_chunk</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Should use operation-specific adjustment</span>
                <span class="c1"># N-gram generation typically gets reduced chunk size</span>
                <span class="k">assert</span> <span class="n">low_pressure_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_backward_compatibility_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_backward_compatibility_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that backward compatibility is preserved.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_backward_compatibility_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that backward compatibility is preserved.&quot;&quot;&quot;</span>
    <span class="c1"># Manual override should still work exactly as before</span>
    <span class="n">manual_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">==</span> <span class="mf">2.0</span>

    <span class="c1"># All existing API methods should still work</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;get_current_memory_usage&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;get_memory_pressure_level&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;calculate_adaptive_chunk_size&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">manual_manager</span><span class="p">,</span> <span class="s2">&quot;enhanced_gc_cleanup&quot;</span><span class="p">)</span>

    <span class="c1"># Methods should return expected types</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="n">pressure</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>  <span class="c1"># Should be an enum</span>

    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">manual_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_chunking_optimization_phase_integration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chunking_optimization_phase_integration</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that all optimization phases work together correctly.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chunking_optimization_phase_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that all optimization phases work together correctly.&quot;&quot;&quot;</span>
    <span class="c1"># Test the complete integration of all phases</span>

    <span class="c1"># Phase 1: Memory auto-detection</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Should detect 16GB system and allocate 4.8GB</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Phase 2: Adaptive chunking should use memory manager</span>
        <span class="c1"># Simulate the calculate_optimal_chunk_size function from ngrams_base</span>
        <span class="k">def</span> <span class="nf">calculate_optimal_chunk_size</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">memory_manager</span><span class="p">:</span>
                <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
                <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
                <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">500_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="mi">2_000_000</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="c1"># Test medium dataset on 16GB system</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">calculate_optimal_chunk_size</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">manager</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">225_000</span>  <span class="c1"># 150K * 1.5</span>

        <span class="c1"># Phase 3: Fallback thresholds should be memory-aware</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fallback_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="c1"># 16GB system should get 1.5M threshold</span>
        <span class="k">assert</span> <span class="n">fallback_threshold</span> <span class="o">==</span> <span class="mi">1_500_000</span>

        <span class="c1"># Phase 4: Secondary analyzer chunks should be larger</span>
        <span class="k">def</span> <span class="nf">calculate_ngram_stats_chunk</span><span class="p">(</span>
            <span class="n">message_ngram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ngram_count</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">base_calc</span> <span class="o">=</span> <span class="mi">500_000</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">message_ngram_count</span> <span class="o">//</span> <span class="n">ngram_count</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="n">base_calc</span><span class="p">))</span>

        <span class="c1"># Should use new larger bounds</span>
        <span class="n">stats_chunk</span> <span class="o">=</span> <span class="n">calculate_ngram_stats_chunk</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">stats_chunk</span> <span class="o">&gt;=</span> <span class="mi">5_000</span>  <span class="c1"># New minimum</span>
        <span class="k">assert</span> <span class="n">stats_chunk</span> <span class="o">&lt;=</span> <span class="mi">50_000</span>  <span class="c1"># New maximum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_error_handling_integration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_error_handling_integration</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that error handling works correctly in integration scenarios.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_error_handling_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that error handling works correctly in integration scenarios.&quot;&quot;&quot;</span>
    <span class="c1"># Test with very low memory limit</span>
    <span class="n">constrained_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># 100MB</span>

    <span class="c1"># Should still provide reasonable chunk sizes</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">&gt;=</span> <span class="mi">1000</span>  <span class="c1"># Should enforce some minimum</span>

    <span class="c1"># Test with extreme memory pressure</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">constrained_manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
        <span class="c1"># Simulate critical memory usage (95% of max)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="mf">0.95</span> <span class="o">*</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">max_memory_bytes</span>
        <span class="p">)</span>

        <span class="n">critical_chunk</span> <span class="o">=</span> <span class="n">constrained_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should drastically reduce chunk size but still be usable</span>
        <span class="k">assert</span> <span class="n">critical_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">critical_chunk</span> <span class="o">&lt;</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># Should be significantly reduced</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_bounds_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_bounds_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory usage stays within auto-detected bounds.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_bounds_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory usage stays within auto-detected bounds.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Get initial memory usage</span>
    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="n">initial_rss_gb</span> <span class="o">=</span> <span class="n">initial_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span>

    <span class="c1"># Should be well below the limit initially</span>
    <span class="k">assert</span> <span class="n">initial_rss_gb</span> <span class="o">&lt;</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span>

    <span class="c1"># Simulate memory usage with adaptive chunk sizing</span>
    <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">100_000</span>
    <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tokenization&quot;</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">]:</span>
        <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_chunk</span><span class="p">,</span> <span class="n">operation</span>
        <span class="p">)</span>

        <span class="c1"># Should be positive and reasonable</span>
        <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">)</span>  <span class="c1"># Allow some scaling up for certain operations</span>

    <span class="c1"># Memory should still be reasonable</span>
    <span class="n">current_memory</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="n">current_rss_gb</span> <span class="o">=</span> <span class="n">current_memory</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span>

    <span class="c1"># Should not have exceeded reasonable bounds</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">current_rss_gb</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.5</span>
    <span class="p">)</span>  <span class="c1"># 50% tolerance for test overhead</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_memory_manager_auto_detection_integration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_manager_auto_detection_integration</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that MemoryManager auto-detection works end-to-end.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_manager_auto_detection_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that MemoryManager auto-detection works end-to-end.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="c1"># Test 16GB system detection</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="c1"># Should auto-detect 4.8GB (30% of 16GB)</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">4.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Should log the auto-detection</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">==</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_performance_improvements_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_performance_improvements_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that performance improvements are measurable.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_performance_improvements_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that performance improvements are measurable.&quot;&quot;&quot;</span>
    <span class="c1"># Create test datasets to measure performance differences</span>
    <span class="n">small_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">50_000</span><span class="p">)</span>
    <span class="n">medium_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">)</span>

    <span class="c1"># Test old vs new chunk processing using medium dataset for meaningful comparison</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base</span>

    <span class="c1"># Measure old approach</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">old_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_processing</span><span class="p">(</span><span class="n">medium_dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
    <span class="n">old_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Measure new approach</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">new_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_processing</span><span class="p">(</span><span class="n">medium_dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>
    <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Should have fewer chunks (better I/O efficiency)</span>
    <span class="k">assert</span> <span class="n">new_chunks</span> <span class="o">&lt;</span> <span class="n">old_chunks</span>

    <span class="c1"># Should be faster (allowing for test variability)</span>
    <span class="k">if</span> <span class="n">new_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">improvement</span> <span class="o">=</span> <span class="n">old_time</span> <span class="o">/</span> <span class="n">new_time</span>
        <span class="k">assert</span> <span class="n">improvement</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>  <span class="c1"># At least no regression</span>

    <span class="c1"># Test chunk count reduction</span>
    <span class="n">expected_reduction</span> <span class="o">=</span> <span class="n">old_chunk_size</span> <span class="o">/</span> <span class="n">new_chunk_size</span>
    <span class="k">if</span> <span class="n">expected_reduction</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">actual_reduction</span> <span class="o">=</span> <span class="n">old_chunks</span> <span class="o">/</span> <span class="n">new_chunks</span> <span class="k">if</span> <span class="n">new_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">actual_reduction</span> <span class="o">&gt;=</span> <span class="n">expected_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>  <span class="c1"># Allow 20% tolerance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestChunkingOptimizationIntegration.test_system_specific_optimization_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_system_specific_optimization_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that optimizations are appropriate for different system types.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_system_specific_optimization_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that optimizations are appropriate for different system types.&quot;&quot;&quot;</span>
    <span class="n">test_systems</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># 4GB: 20% allocation, 0.5x chunks</span>
        <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 8GB: 25% allocation, 1.0x chunks</span>
        <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 16GB: 30% allocation, 1.5x chunks</span>
        <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 32GB: 40% allocation, 2.0x chunks</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">total_memory</span><span class="p">,</span> <span class="n">system_type</span><span class="p">,</span> <span class="n">expected_limit</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_systems</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total_memory</span>

            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should detect appropriate memory limit</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="n">expected_limit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">system_type</span><span class="si">}</span><span class="s2"> system should allocate </span><span class="si">{</span><span class="n">expected_limit</span><span class="si">}</span><span class="s2">GB&quot;</span>

            <span class="c1"># Should use appropriate chunk scaling</span>
            <span class="n">total_gb</span> <span class="o">=</span> <span class="n">total_memory</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
            <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chunk_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">chunk_factor</span> <span class="o">-</span> <span class="n">expected_factor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">system_type</span><span class="si">}</span><span class="s2"> system should use </span><span class="si">{</span><span class="n">expected_factor</span><span class="si">}</span><span class="s2">x chunk factor&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_integration_validation.TestRealWorldScenarios" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestRealWorldScenarios</code>


</h5>


    <div class="doc doc-contents ">


        <p>Test real-world scenarios with chunking optimization.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestRealWorldScenarios</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test real-world scenarios with chunking optimization.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_typical_social_media_dataset_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test with a dataset that simulates typical social media analysis.&quot;&quot;&quot;</span>
        <span class="c1"># Create realistic dataset</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_social_media_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>

        <span class="c1"># Test with auto-detected memory manager</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Simulate n-gram analysis workflow</span>
        <span class="n">base_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Old default</span>

        <span class="c1"># Calculate adaptive chunk size</span>
        <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_chunk_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should be reasonable for the dataset</span>
        <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk_size</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># Reasonable scaling</span>

        <span class="c1"># Test processing with adaptive chunk size</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">chunks_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_ngram_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">adaptive_chunk</span><span class="p">)</span>
        <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Should complete in reasonable time</span>
        <span class="k">assert</span> <span class="n">processing_time</span> <span class="o">&lt;</span> <span class="mi">30</span>  <span class="c1"># Should be fast for test dataset</span>
        <span class="k">assert</span> <span class="n">chunks_processed</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="c1"># Memory usage should be reasonable</span>
        <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">memory_stats</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.2</span>  <span class="c1"># 20% tolerance</span>

    <span class="k">def</span> <span class="nf">test_large_dataset_fallback_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test fallback behavior with large datasets.&quot;&quot;&quot;</span>
        <span class="c1"># Test the fallback threshold logic</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Determine fallback threshold based on system memory</span>
        <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="c1"># Test datasets around the threshold</span>
        <span class="n">test_sizes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">expected_threshold</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Below threshold</span>
            <span class="n">expected_threshold</span><span class="p">,</span>  <span class="c1"># At threshold</span>
            <span class="n">expected_threshold</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Above threshold</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">dataset_size</span> <span class="ow">in</span> <span class="n">test_sizes</span><span class="p">:</span>
            <span class="n">uses_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">expected_threshold</span>

            <span class="c1"># Fallback behavior should be consistent</span>
            <span class="k">if</span> <span class="n">uses_fallback</span><span class="p">:</span>
                <span class="c1"># Should use more conservative chunking</span>
                <span class="k">pass</span>  <span class="c1"># Fallback logic is complex, just verify it doesn&#39;t crash</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Should use regular optimized chunking</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_memory_constrained_system_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test behavior on memory-constrained systems.&quot;&quot;&quot;</span>
        <span class="c1"># Simulate a 4GB system</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should allocate only 20% (0.8GB) on constrained system</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Should use conservative chunk sizes</span>
            <span class="n">conservative_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Should be reduced due to system constraints</span>
            <span class="k">assert</span> <span class="n">conservative_chunk</span> <span class="o">&lt;=</span> <span class="mi">100_000</span>

            <span class="c1"># Should still be usable</span>
            <span class="k">assert</span> <span class="n">conservative_chunk</span> <span class="o">&gt;=</span> <span class="mi">1000</span>

    <span class="k">def</span> <span class="nf">test_high_memory_system_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test behavior on high-memory systems.&quot;&quot;&quot;</span>
        <span class="c1"># Simulate a 32GB system</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

            <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Should allocate 40% (12.8GB) on high-memory system</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

            <span class="c1"># Should use larger chunk sizes</span>
            <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>

            <span class="c1"># Should be able to scale up for some operations</span>
            <span class="k">assert</span> <span class="n">large_chunk</span> <span class="o">&gt;=</span> <span class="mi">50_000</span>  <span class="c1"># Should be reasonable sized</span>

    <span class="k">def</span> <span class="nf">_create_social_media_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a realistic social media dataset.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="c1"># Sample social media content patterns</span>
        <span class="n">content_templates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Just finished watching </span><span class="si">{movie}</span><span class="s2">! Amazing </span><span class="si">{adjective}</span><span class="s2">!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Can&#39;t believe </span><span class="si">{celebrity}</span><span class="s2"> said that about </span><span class="si">{topic}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Weather is </span><span class="si">{weather_adj}</span><span class="s2"> today in </span><span class="si">{city}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Check out this </span><span class="si">{adjective}</span><span class="s2"> </span><span class="si">{noun}</span><span class="s2"> I found!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Happy </span><span class="si">{day}</span><span class="s2"> everyone! Hope you have a </span><span class="si">{adjective}</span><span class="s2"> day!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Anyone else think </span><span class="si">{opinion}</span><span class="s2">? Just me? #thoughts&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">substitutions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;movie&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Avatar&quot;</span><span class="p">,</span> <span class="s2">&quot;Inception&quot;</span><span class="p">,</span> <span class="s2">&quot;The Matrix&quot;</span><span class="p">,</span> <span class="s2">&quot;Frozen&quot;</span><span class="p">,</span> <span class="s2">&quot;Avengers&quot;</span><span class="p">],</span>
            <span class="s2">&quot;adjective&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;amazing&quot;</span><span class="p">,</span> <span class="s2">&quot;terrible&quot;</span><span class="p">,</span> <span class="s2">&quot;incredible&quot;</span><span class="p">,</span> <span class="s2">&quot;boring&quot;</span><span class="p">,</span> <span class="s2">&quot;fantastic&quot;</span><span class="p">],</span>
            <span class="s2">&quot;celebrity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@celebrity1&quot;</span><span class="p">,</span> <span class="s2">&quot;@celebrity2&quot;</span><span class="p">,</span> <span class="s2">&quot;@celebrity3&quot;</span><span class="p">],</span>
            <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;climate change&quot;</span><span class="p">,</span> <span class="s2">&quot;politics&quot;</span><span class="p">,</span> <span class="s2">&quot;technology&quot;</span><span class="p">,</span> <span class="s2">&quot;sports&quot;</span><span class="p">],</span>
            <span class="s2">&quot;weather_adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sunny&quot;</span><span class="p">,</span> <span class="s2">&quot;rainy&quot;</span><span class="p">,</span> <span class="s2">&quot;cloudy&quot;</span><span class="p">,</span> <span class="s2">&quot;snowy&quot;</span><span class="p">,</span> <span class="s2">&quot;windy&quot;</span><span class="p">],</span>
            <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;NYC&quot;</span><span class="p">,</span> <span class="s2">&quot;LA&quot;</span><span class="p">,</span> <span class="s2">&quot;Chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;Miami&quot;</span><span class="p">,</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">],</span>
            <span class="s2">&quot;noun&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gadget&quot;</span><span class="p">,</span> <span class="s2">&quot;recipe&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;song&quot;</span><span class="p">,</span> <span class="s2">&quot;photo&quot;</span><span class="p">],</span>
            <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Monday&quot;</span><span class="p">,</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Thursday&quot;</span><span class="p">,</span> <span class="s2">&quot;Friday&quot;</span><span class="p">],</span>
            <span class="s2">&quot;opinion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pineapple belongs on pizza&quot;</span><span class="p">,</span> <span class="s2">&quot;cats are better than dogs&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">content_templates</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">template</span>

            <span class="c1"># Apply substitutions</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">substitutions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># 10% unique users</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;2023-</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">T</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00:00Z&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_simulate_ngram_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate n-gram processing with chunking.&quot;&quot;&quot;</span>
        <span class="n">chunks_processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate tokenization and n-gram generation</span>
            <span class="n">processed_chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;author_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># Simulate n-gram generation (just count tokens for simplicity)</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">chunks_processed</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">chunks_processed</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestRealWorldScenarios.test_high_memory_system_scenario" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_high_memory_system_scenario</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test behavior on high-memory systems.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_high_memory_system_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test behavior on high-memory systems.&quot;&quot;&quot;</span>
    <span class="c1"># Simulate a 32GB system</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Should allocate 40% (12.8GB) on high-memory system</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">12.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Should use larger chunk sizes</span>
        <span class="n">large_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>

        <span class="c1"># Should be able to scale up for some operations</span>
        <span class="k">assert</span> <span class="n">large_chunk</span> <span class="o">&gt;=</span> <span class="mi">50_000</span>  <span class="c1"># Should be reasonable sized</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestRealWorldScenarios.test_large_dataset_fallback_scenario" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_large_dataset_fallback_scenario</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test fallback behavior with large datasets.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_large_dataset_fallback_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test fallback behavior with large datasets.&quot;&quot;&quot;</span>
    <span class="c1"># Test the fallback threshold logic</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Determine fallback threshold based on system memory</span>
    <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expected_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

    <span class="c1"># Test datasets around the threshold</span>
    <span class="n">test_sizes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">expected_threshold</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Below threshold</span>
        <span class="n">expected_threshold</span><span class="p">,</span>  <span class="c1"># At threshold</span>
        <span class="n">expected_threshold</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Above threshold</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">dataset_size</span> <span class="ow">in</span> <span class="n">test_sizes</span><span class="p">:</span>
        <span class="n">uses_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">expected_threshold</span>

        <span class="c1"># Fallback behavior should be consistent</span>
        <span class="k">if</span> <span class="n">uses_fallback</span><span class="p">:</span>
            <span class="c1"># Should use more conservative chunking</span>
            <span class="k">pass</span>  <span class="c1"># Fallback logic is complex, just verify it doesn&#39;t crash</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Should use regular optimized chunking</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestRealWorldScenarios.test_memory_constrained_system_scenario" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_constrained_system_scenario</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test behavior on memory-constrained systems.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_constrained_system_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test behavior on memory-constrained systems.&quot;&quot;&quot;</span>
    <span class="c1"># Simulate a 4GB system</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
        <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Should allocate only 20% (0.8GB) on constrained system</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

        <span class="c1"># Should use conservative chunk sizes</span>
        <span class="n">conservative_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="mi">100_000</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Should be reduced due to system constraints</span>
        <span class="k">assert</span> <span class="n">conservative_chunk</span> <span class="o">&lt;=</span> <span class="mi">100_000</span>

        <span class="c1"># Should still be usable</span>
        <span class="k">assert</span> <span class="n">conservative_chunk</span> <span class="o">&gt;=</span> <span class="mi">1000</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_integration_validation.TestRealWorldScenarios.test_typical_social_media_dataset_scenario" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_typical_social_media_dataset_scenario</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test with a dataset that simulates typical social media analysis.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_integration_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_typical_social_media_dataset_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with a dataset that simulates typical social media analysis.&quot;&quot;&quot;</span>
    <span class="c1"># Create realistic dataset</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_social_media_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>

    <span class="c1"># Test with auto-detected memory manager</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Simulate n-gram analysis workflow</span>
    <span class="n">base_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Old default</span>

    <span class="c1"># Calculate adaptive chunk size</span>
    <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="n">base_chunk_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Should be reasonable for the dataset</span>
    <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">adaptive_chunk</span> <span class="o">&lt;=</span> <span class="n">base_chunk_size</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># Reasonable scaling</span>

    <span class="c1"># Test processing with adaptive chunk size</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">chunks_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_ngram_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">adaptive_chunk</span><span class="p">)</span>
    <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Should complete in reasonable time</span>
    <span class="k">assert</span> <span class="n">processing_time</span> <span class="o">&lt;</span> <span class="mi">30</span>  <span class="c1"># Should be fast for test dataset</span>
    <span class="k">assert</span> <span class="n">chunks_processed</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="c1"># Memory usage should be reasonable</span>
    <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">memory_stats</span><span class="p">[</span><span class="s2">&quot;rss_gb&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mf">1.2</span>  <span class="c1"># 20% tolerance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="testing.performance.test_performance_benchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_performance_benchmarks</code>


</h4>

    <div class="doc doc-contents ">

        <p>Performance Benchmarking Tests for Chunking Optimization
Measures actual performance improvements and validates 2-4x performance gains.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestPerformanceBenchmarks</code>


</h5>


    <div class="doc doc-contents ">


        <p>Comprehensive performance benchmarking suite.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">class</span> <span class="nc">TestPerformanceBenchmarks</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive performance benchmarking suite.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up test environment before each test.&quot;&quot;&quot;</span>
        <span class="c1"># Force garbage collection to start with clean state</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Get baseline memory usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

    <span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up after each test.&quot;&quot;&quot;</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_realistic_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_messages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a realistic test dataset with variable message lengths.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="c1"># Common words for realistic n-gram generation</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;the&quot;</span><span class="p">,</span>
            <span class="s2">&quot;and&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is&quot;</span><span class="p">,</span>
            <span class="s2">&quot;in&quot;</span><span class="p">,</span>
            <span class="s2">&quot;to&quot;</span><span class="p">,</span>
            <span class="s2">&quot;of&quot;</span><span class="p">,</span>
            <span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="s2">&quot;for&quot;</span><span class="p">,</span>
            <span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="s2">&quot;with&quot;</span><span class="p">,</span>
            <span class="s2">&quot;as&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by&quot;</span><span class="p">,</span>
            <span class="s2">&quot;be&quot;</span><span class="p">,</span>
            <span class="s2">&quot;at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;this&quot;</span><span class="p">,</span>
            <span class="s2">&quot;that&quot;</span><span class="p">,</span>
            <span class="s2">&quot;from&quot;</span><span class="p">,</span>
            <span class="s2">&quot;they&quot;</span><span class="p">,</span>
            <span class="s2">&quot;we&quot;</span><span class="p">,</span>
            <span class="s2">&quot;you&quot;</span><span class="p">,</span>
            <span class="s2">&quot;have&quot;</span><span class="p">,</span>
            <span class="s2">&quot;has&quot;</span><span class="p">,</span>
            <span class="s2">&quot;had&quot;</span><span class="p">,</span>
            <span class="s2">&quot;will&quot;</span><span class="p">,</span>
            <span class="s2">&quot;would&quot;</span><span class="p">,</span>
            <span class="s2">&quot;could&quot;</span><span class="p">,</span>
            <span class="s2">&quot;should&quot;</span><span class="p">,</span>
            <span class="s2">&quot;can&quot;</span><span class="p">,</span>
            <span class="s2">&quot;may&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;analysis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;social&quot;</span><span class="p">,</span>
            <span class="s2">&quot;media&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comment&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hashtag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trend&quot;</span><span class="p">,</span>
            <span class="s2">&quot;viral&quot;</span><span class="p">,</span>
            <span class="s2">&quot;engagement&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reach&quot;</span><span class="p">,</span>
            <span class="s2">&quot;impression&quot;</span><span class="p">,</span>
            <span class="s2">&quot;click&quot;</span><span class="p">,</span>
            <span class="s2">&quot;like&quot;</span><span class="p">,</span>
            <span class="s2">&quot;share&quot;</span><span class="p">,</span>
            <span class="s2">&quot;retweet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;follow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;followers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;following&quot;</span><span class="p">,</span>
            <span class="s2">&quot;account&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_messages</span><span class="p">):</span>
            <span class="c1"># Variable message length (10-40 tokens)</span>
            <span class="n">num_tokens</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="n">avg_tokens_per_message</span> <span class="o">+</span> <span class="mi">20</span>
            <span class="p">)</span>

            <span class="c1"># Generate message with realistic word distribution</span>
            <span class="n">message_words</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tokens</span><span class="p">):</span>
                <span class="c1"># Higher probability for common words</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># Very common words</span>
                <span class="k">elif</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>  <span class="c1"># Common words</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>  <span class="c1"># All words</span>

                <span class="n">message_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message_words</span><span class="p">),</span>
                    <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">num_messages</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># 10% unique users</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;2023-01-</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">T</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00:00Z&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_benchmark_chunk_processing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Benchmark chunk processing with different chunk sizes.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Benchmark old chunk size</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">old_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
        <span class="n">old_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;old_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_time</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;old_chunks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_chunks</span>

        <span class="c1"># Clear memory between tests</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Benchmark new chunk size</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">new_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;new_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_time</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;new_chunks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_chunks</span>

        <span class="c1"># Calculate improvements</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_time</span> <span class="o">/</span> <span class="n">new_time</span> <span class="k">if</span> <span class="n">new_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_chunks</span> <span class="o">/</span> <span class="n">new_chunks</span> <span class="k">if</span> <span class="n">new_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_simulate_chunk_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate chunk processing and return number of chunks processed.&quot;&quot;&quot;</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate processing work (tokenization, basic operations)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;author_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">num_chunks</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Simulate memory cleanup every few chunks</span>
            <span class="k">if</span> <span class="n">num_chunks</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">num_chunks</span>

    <span class="k">def</span> <span class="nf">test_small_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance improvements on small datasets (100K messages).&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Old vs new chunk sizes for small datasets</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">200_000</span>  <span class="c1"># New base for small datasets</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
        <span class="p">)</span>

        <span class="c1"># Should have fewer chunks with new size</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.0</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Should be faster (allowing for test variability)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.02</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.02x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Memory usage should be reasonable</span>
        <span class="n">current_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">memory_increase</span> <span class="o">=</span> <span class="n">current_memory</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="mi">500</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage increased by </span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB, should be &lt; 500MB&quot;</span>

    <span class="k">def</span> <span class="nf">test_medium_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance improvements on medium datasets (500K messages).&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1"># Old vs new chunk sizes for medium datasets</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base for medium datasets</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
        <span class="p">)</span>

        <span class="c1"># Should have significant I/O reduction</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2.5x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Should be noticeably faster</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.3</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.3x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Validate chunk counts make sense</span>
        <span class="n">expected_old_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500_000</span> <span class="o">+</span> <span class="n">old_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">old_chunk_size</span>
        <span class="n">expected_new_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500_000</span> <span class="o">+</span> <span class="n">new_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;old_chunks&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expected_old_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;new_chunks&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expected_new_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">test_large_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance improvements on large datasets (1M messages).&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Test with different chunk sizes based on system memory</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Adaptive based on system</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
        <span class="p">)</span>

        <span class="c1"># Should have substantial improvements</span>
        <span class="n">expected_io_reduction</span> <span class="o">=</span> <span class="n">new_chunk_size</span> <span class="o">/</span> <span class="n">old_chunk_size</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_io_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_io_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Time improvement should be significant for large datasets</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.15</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.15x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_adaptive_chunk_sizing_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory-adaptive chunk sizing provides better performance.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">300_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Test with different memory configurations</span>
        <span class="n">test_configs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 4GB limit, 1.0x factor (old config)</span>
            <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 8GB limit, 1.5x factor (16GB system)</span>
            <span class="p">(</span><span class="mf">12.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 12GB limit, 2.0x factor (32GB system)</span>
        <span class="p">]</span>

        <span class="n">performance_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_configs</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
                <span class="c1"># Set up system memory to match expected factor</span>
                <span class="k">if</span> <span class="n">expected_factor</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 8GB system</span>
                <span class="k">elif</span> <span class="n">expected_factor</span> <span class="o">==</span> <span class="mf">1.5</span><span class="p">:</span>
                    <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 16GB system</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 32GB system</span>

                <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

                <span class="c1"># Calculate chunk size with adaptive scaling</span>
                <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">150_000</span>
                <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_chunk</span> <span class="o">*</span> <span class="n">expected_factor</span><span class="p">)</span>
                <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">adaptive_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

                <span class="c1"># Benchmark this configuration</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">adaptive_chunk</span><span class="p">)</span>
                <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

                <span class="n">performance_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;memory_limit&quot;</span><span class="p">:</span> <span class="n">memory_limit</span><span class="p">,</span>
                        <span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="n">expected_factor</span><span class="p">,</span>
                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk</span><span class="p">,</span>
                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">elapsed</span><span class="p">,</span>
                        <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Higher memory configurations should be faster</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">performance_results</span><span class="p">)):</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">performance_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">performance_results</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Should have larger chunks</span>
            <span class="k">assert</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">previous</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>

            <span class="c1"># Should have fewer chunks (better I/O efficiency)</span>
            <span class="k">assert</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;chunks&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">previous</span><span class="p">[</span><span class="s2">&quot;chunks&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_vectorized_ngram_generation_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance of vectorized n-gram generation with larger chunks.&quot;&quot;&quot;</span>
        <span class="c1"># Create dataset with pre-tokenized data</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">50_000</span>
        <span class="n">tokens_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataset_size</span><span class="p">):</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;word_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
            <span class="p">]</span>  <span class="c1"># Variable length 5-14 tokens</span>
            <span class="n">tokens_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="n">tokens</span><span class="p">})</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tokens_data</span><span class="p">)</span>

        <span class="c1"># Test old vs new chunk sizes</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">10_000</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">30_000</span>

        <span class="c1"># Benchmark old chunk size</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">old_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_vectorized_ngram_generation</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">min_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>
        <span class="n">old_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Benchmark new chunk size</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">new_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_vectorized_ngram_generation</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">,</span> <span class="n">min_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Should produce same results</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_result</span><span class="p">),</span> <span class="s2">&quot;Results should be identical&quot;</span>

        <span class="c1"># Should be faster with larger chunks</span>
        <span class="n">time_improvement</span> <span class="o">=</span> <span class="n">old_time</span> <span class="o">/</span> <span class="n">new_time</span> <span class="k">if</span> <span class="n">new_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">time_improvement</span> <span class="o">&gt;=</span> <span class="mf">0.95</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 0.95x improvement, got </span><span class="si">{</span><span class="n">time_improvement</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="k">def</span> <span class="nf">_benchmark_vectorized_ngram_generation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Benchmark vectorized n-gram generation with specified chunk size.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate vectorized n-gram generation</span>
            <span class="n">chunk_result</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)])</span>
                <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="c1"># Simulate n-gram generation</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">tokens</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_ngrams_for_tokens</span><span class="p">(</span>
                                <span class="n">tokens</span><span class="p">,</span> <span class="n">min_n</span><span class="p">,</span> <span class="n">max_n</span>
                            <span class="p">),</span>
                            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ngrams&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;ngrams&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ngrams&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_not_null</span><span class="p">())</span>
                <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">),</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ngrams&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;ngram_text&quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_result</span><span class="p">)</span>

        <span class="c1"># Combine all results</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">,</span> <span class="s2">&quot;ngram_text&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">String</span><span class="p">}</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_ngrams_for_tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">min_n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate n-grams from a list of tokens.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_n</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ngrams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_n</span><span class="p">,</span> <span class="n">max_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ngram</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">])</span>
                <span class="n">ngrams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ngram</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ngrams</span>

    <span class="k">def</span> <span class="nf">test_fallback_threshold_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance improvements with updated fallback thresholds.&quot;&quot;&quot;</span>
        <span class="c1"># Test datasets of different sizes around fallback thresholds</span>
        <span class="n">test_sizes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mi">400_000</span><span class="p">,</span>  <span class="c1"># Below old threshold (500K)</span>
            <span class="mi">800_000</span><span class="p">,</span>  <span class="c1"># Above old threshold, below new 16GB threshold (1.5M)</span>
            <span class="mi">1_200_000</span><span class="p">,</span>  <span class="c1"># Above old threshold, below new 16GB threshold</span>
            <span class="mi">2_000_000</span><span class="p">,</span>  <span class="c1"># Above new 16GB threshold</span>
        <span class="p">]</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="c1"># Determine expected threshold based on system memory</span>
        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="n">old_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

        <span class="k">for</span> <span class="n">dataset_size</span> <span class="ow">in</span> <span class="n">test_sizes</span><span class="p">:</span>
            <span class="c1"># Check which processing method would be used</span>
            <span class="n">uses_old_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">old_threshold</span>
            <span class="n">uses_new_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">new_threshold</span>

            <span class="c1"># With new thresholds, more datasets should avoid fallback processing</span>
            <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="n">new_threshold</span> <span class="ow">and</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">old_threshold</span><span class="p">:</span>
                <span class="c1"># This dataset would have used fallback with old threshold</span>
                <span class="c1"># but uses regular processing with new threshold</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">uses_new_fallback</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Dataset size </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2"> should not use fallback with new threshold </span><span class="si">{</span><span class="n">new_threshold</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">uses_old_fallback</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Dataset size </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2"> would have used fallback with old threshold </span><span class="si">{</span><span class="n">old_threshold</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_usage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory usage is more efficient with new chunking.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Test memory usage with different chunk sizes</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">25_000</span>  <span class="c1"># Old fallback chunk size</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">100_000</span>  <span class="c1"># New fallback chunk size</span>

        <span class="c1"># Measure memory usage with old chunk size</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
        <span class="n">old_peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">old_memory_usage</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Measure memory usage with new chunk size</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>
        <span class="n">new_peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">new_memory_usage</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

        <span class="c1"># Memory usage should be reasonable for both</span>
        <span class="c1"># Larger chunks may use more memory but should be more efficient</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">new_memory_usage</span> <span class="o">&lt;</span> <span class="n">old_memory_usage</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New memory usage (</span><span class="si">{</span><span class="n">new_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB) should not be more than 5x old usage (</span><span class="si">{</span><span class="n">old_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB)&quot;</span>

        <span class="c1"># Both should use reasonable amounts of memory</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">old_memory_usage</span> <span class="o">&lt;</span> <span class="mi">1000</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Old chunking should use &lt; 1GB, used </span><span class="si">{</span><span class="n">old_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">new_memory_usage</span> <span class="o">&lt;</span> <span class="mi">1000</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New chunking should use &lt; 1GB, used </span><span class="si">{</span><span class="n">new_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span>
        <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Requires at least 8GB RAM for comprehensive performance testing&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_comprehensive_performance_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Comprehensive performance validation on systems with adequate memory.&quot;&quot;&quot;</span>
        <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="c1"># Test with appropriately sized dataset</span>
        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">1_000_000</span>
            <span class="n">expected_min_improvement</span> <span class="o">=</span> <span class="mf">1.25</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">500_000</span>
            <span class="n">expected_min_improvement</span> <span class="o">=</span> <span class="mf">1.25</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span>
            <span class="n">dataset_size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">)</span>

        <span class="c1"># Compare old conservative approach vs new adaptive approach</span>
        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>

        <span class="c1"># Calculate new chunk size based on system</span>
        <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
        <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_chunk_size</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
        <span class="p">)</span>

        <span class="c1"># Should meet performance improvement targets</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_min_improvement</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least </span><span class="si">{</span><span class="n">expected_min_improvement</span><span class="si">}</span><span class="s2">x improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Should have substantial I/O reduction</span>
        <span class="n">expected_io_reduction</span> <span class="o">=</span> <span class="n">new_chunk_size</span> <span class="o">/</span> <span class="n">old_chunk_size</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_io_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_io_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

        <span class="c1"># Log results for documentation</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance Results for </span><span class="si">{</span><span class="n">system_memory_gb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">GB system:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dataset size: </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> messages&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Old chunk size: </span><span class="si">{</span><span class="n">old_chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  New chunk size: </span><span class="si">{</span><span class="n">new_chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time improvement: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  I/O reduction: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory factor: </span><span class="si">{</span><span class="n">memory_factor</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.setup_method" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">setup_method</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Set up test environment before each test.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up test environment before each test.&quot;&quot;&quot;</span>
    <span class="c1"># Force garbage collection to start with clean state</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Get baseline memory usage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.teardown_method" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">teardown_method</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Clean up after each test.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up after each test.&quot;&quot;&quot;</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_comprehensive_performance_validation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_comprehensive_performance_validation</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Comprehensive performance validation on systems with adequate memory.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span>
    <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Requires at least 8GB RAM for comprehensive performance testing&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_comprehensive_performance_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive performance validation on systems with adequate memory.&quot;&quot;&quot;</span>
    <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="c1"># Test with appropriately sized dataset</span>
    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">1_000_000</span>
        <span class="n">expected_min_improvement</span> <span class="o">=</span> <span class="mf">1.25</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">500_000</span>
        <span class="n">expected_min_improvement</span> <span class="o">=</span> <span class="mf">1.25</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span>
        <span class="n">dataset_size</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span>
    <span class="p">)</span>

    <span class="c1"># Compare old conservative approach vs new adaptive approach</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>

    <span class="c1"># Calculate new chunk size based on system</span>
    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_chunk_size</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
    <span class="p">)</span>

    <span class="c1"># Should meet performance improvement targets</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_min_improvement</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least </span><span class="si">{</span><span class="n">expected_min_improvement</span><span class="si">}</span><span class="s2">x improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Should have substantial I/O reduction</span>
    <span class="n">expected_io_reduction</span> <span class="o">=</span> <span class="n">new_chunk_size</span> <span class="o">/</span> <span class="n">old_chunk_size</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_io_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_io_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Log results for documentation</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance Results for </span><span class="si">{</span><span class="n">system_memory_gb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">GB system:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dataset size: </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> messages&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Old chunk size: </span><span class="si">{</span><span class="n">old_chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  New chunk size: </span><span class="si">{</span><span class="n">new_chunk_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time improvement: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  I/O reduction: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory factor: </span><span class="si">{</span><span class="n">memory_factor</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_fallback_threshold_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_fallback_threshold_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance improvements with updated fallback thresholds.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_fallback_threshold_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance improvements with updated fallback thresholds.&quot;&quot;&quot;</span>
    <span class="c1"># Test datasets of different sizes around fallback thresholds</span>
    <span class="n">test_sizes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">400_000</span><span class="p">,</span>  <span class="c1"># Below old threshold (500K)</span>
        <span class="mi">800_000</span><span class="p">,</span>  <span class="c1"># Above old threshold, below new 16GB threshold (1.5M)</span>
        <span class="mi">1_200_000</span><span class="p">,</span>  <span class="c1"># Above old threshold, below new 16GB threshold</span>
        <span class="mi">2_000_000</span><span class="p">,</span>  <span class="c1"># Above new 16GB threshold</span>
    <span class="p">]</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="c1"># Determine expected threshold based on system memory</span>
    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">3_000_000</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">1_500_000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

    <span class="n">old_threshold</span> <span class="o">=</span> <span class="mi">500_000</span>

    <span class="k">for</span> <span class="n">dataset_size</span> <span class="ow">in</span> <span class="n">test_sizes</span><span class="p">:</span>
        <span class="c1"># Check which processing method would be used</span>
        <span class="n">uses_old_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">old_threshold</span>
        <span class="n">uses_new_fallback</span> <span class="o">=</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">new_threshold</span>

        <span class="c1"># With new thresholds, more datasets should avoid fallback processing</span>
        <span class="k">if</span> <span class="n">dataset_size</span> <span class="o">&lt;=</span> <span class="n">new_threshold</span> <span class="ow">and</span> <span class="n">dataset_size</span> <span class="o">&gt;</span> <span class="n">old_threshold</span><span class="p">:</span>
            <span class="c1"># This dataset would have used fallback with old threshold</span>
            <span class="c1"># but uses regular processing with new threshold</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">uses_new_fallback</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Dataset size </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2"> should not use fallback with new threshold </span><span class="si">{</span><span class="n">new_threshold</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">uses_old_fallback</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Dataset size </span><span class="si">{</span><span class="n">dataset_size</span><span class="si">}</span><span class="s2"> would have used fallback with old threshold </span><span class="si">{</span><span class="n">old_threshold</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_large_dataset_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_large_dataset_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance improvements on large datasets (1M messages).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_large_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance improvements on large datasets (1M messages).&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># Test with different chunk sizes based on system memory</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">system_memory_gb</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="k">if</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">elif</span> <span class="n">system_memory_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">memory_factor</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">150_000</span> <span class="o">*</span> <span class="n">memory_factor</span><span class="p">)</span>  <span class="c1"># Adaptive based on system</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
    <span class="p">)</span>

    <span class="c1"># Should have substantial improvements</span>
    <span class="n">expected_io_reduction</span> <span class="o">=</span> <span class="n">new_chunk_size</span> <span class="o">/</span> <span class="n">old_chunk_size</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">expected_io_reduction</span> <span class="o">*</span> <span class="mf">0.8</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected ~</span><span class="si">{</span><span class="n">expected_io_reduction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Time improvement should be significant for large datasets</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.15</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.15x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_medium_dataset_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_medium_dataset_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance improvements on medium datasets (500K messages).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_medium_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance improvements on medium datasets (500K messages).&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># Old vs new chunk sizes for medium datasets</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">150_000</span>  <span class="c1"># New base for medium datasets</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
    <span class="p">)</span>

    <span class="c1"># Should have significant I/O reduction</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.5</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2.5x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Should be noticeably faster</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.3</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.3x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Validate chunk counts make sense</span>
    <span class="n">expected_old_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500_000</span> <span class="o">+</span> <span class="n">old_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">old_chunk_size</span>
    <span class="n">expected_new_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500_000</span> <span class="o">+</span> <span class="n">new_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_chunk_size</span>

    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;old_chunks&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expected_old_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;new_chunks&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expected_new_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_adaptive_chunk_sizing_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_adaptive_chunk_sizing_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory-adaptive chunk sizing provides better performance.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_adaptive_chunk_sizing_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory-adaptive chunk sizing provides better performance.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">300_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Test with different memory configurations</span>
    <span class="n">test_configs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># 4GB limit, 1.0x factor (old config)</span>
        <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># 8GB limit, 1.5x factor (16GB system)</span>
        <span class="p">(</span><span class="mf">12.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># 12GB limit, 2.0x factor (32GB system)</span>
    <span class="p">]</span>

    <span class="n">performance_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">expected_factor</span> <span class="ow">in</span> <span class="n">test_configs</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;psutil.virtual_memory&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_vm</span><span class="p">:</span>
            <span class="c1"># Set up system memory to match expected factor</span>
            <span class="k">if</span> <span class="n">expected_factor</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 8GB system</span>
            <span class="k">elif</span> <span class="n">expected_factor</span> <span class="o">==</span> <span class="mf">1.5</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 16GB system</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mock_vm</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>  <span class="c1"># 32GB system</span>

            <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

            <span class="c1"># Calculate chunk size with adaptive scaling</span>
            <span class="n">base_chunk</span> <span class="o">=</span> <span class="mi">150_000</span>
            <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_chunk</span> <span class="o">*</span> <span class="n">expected_factor</span><span class="p">)</span>
            <span class="n">adaptive_chunk</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">adaptive_chunk</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

            <span class="c1"># Benchmark this configuration</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">adaptive_chunk</span><span class="p">)</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="n">performance_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;memory_limit&quot;</span><span class="p">:</span> <span class="n">memory_limit</span><span class="p">,</span>
                    <span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="n">expected_factor</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk</span><span class="p">,</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">elapsed</span><span class="p">,</span>
                    <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Higher memory configurations should be faster</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">performance_results</span><span class="p">)):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">performance_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">performance_results</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Should have larger chunks</span>
        <span class="k">assert</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">previous</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>

        <span class="c1"># Should have fewer chunks (better I/O efficiency)</span>
        <span class="k">assert</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;chunks&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">previous</span><span class="p">[</span><span class="s2">&quot;chunks&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_memory_usage_efficiency" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_usage_efficiency</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that memory usage is more efficient with new chunking.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_usage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory usage is more efficient with new chunking.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Test memory usage with different chunk sizes</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">25_000</span>  <span class="c1"># Old fallback chunk size</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">100_000</span>  <span class="c1"># New fallback chunk size</span>

    <span class="c1"># Measure memory usage with old chunk size</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">)</span>
    <span class="n">old_peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">old_memory_usage</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Measure memory usage with new chunk size</span>
    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">)</span>
    <span class="n">new_peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">new_memory_usage</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># MB</span>

    <span class="c1"># Memory usage should be reasonable for both</span>
    <span class="c1"># Larger chunks may use more memory but should be more efficient</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">new_memory_usage</span> <span class="o">&lt;</span> <span class="n">old_memory_usage</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New memory usage (</span><span class="si">{</span><span class="n">new_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB) should not be more than 5x old usage (</span><span class="si">{</span><span class="n">old_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB)&quot;</span>

    <span class="c1"># Both should use reasonable amounts of memory</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">old_memory_usage</span> <span class="o">&lt;</span> <span class="mi">1000</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Old chunking should use &lt; 1GB, used </span><span class="si">{</span><span class="n">old_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">new_memory_usage</span> <span class="o">&lt;</span> <span class="mi">1000</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;New chunking should use &lt; 1GB, used </span><span class="si">{</span><span class="n">new_memory_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_small_dataset_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_small_dataset_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance improvements on small datasets (100K messages).</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_small_dataset_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance improvements on small datasets (100K messages).&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_realistic_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">avg_tokens_per_message</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Old vs new chunk sizes for small datasets</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">50_000</span>  <span class="c1"># Original base</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">200_000</span>  <span class="c1"># New base for small datasets</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_chunk_processing</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">new_chunk_size</span>
    <span class="p">)</span>

    <span class="c1"># Should have fewer chunks with new size</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;io_reduction&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.0</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 2x I/O reduction, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;io_reduction&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Should be faster (allowing for test variability)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_improvement&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">1.02</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 1.02x time improvement, got </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_improvement&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>

    <span class="c1"># Memory usage should be reasonable</span>
    <span class="n">current_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">memory_increase</span> <span class="o">=</span> <span class="n">current_memory</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_memory</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage increased by </span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB, should be &lt; 500MB&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestPerformanceBenchmarks.test_vectorized_ngram_generation_performance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_vectorized_ngram_generation_performance</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test performance of vectorized n-gram generation with larger chunks.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_vectorized_ngram_generation_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test performance of vectorized n-gram generation with larger chunks.&quot;&quot;&quot;</span>
    <span class="c1"># Create dataset with pre-tokenized data</span>
    <span class="n">dataset_size</span> <span class="o">=</span> <span class="mi">50_000</span>
    <span class="n">tokens_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataset_size</span><span class="p">):</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;word_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">]</span>  <span class="c1"># Variable length 5-14 tokens</span>
        <span class="n">tokens_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="n">tokens</span><span class="p">})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tokens_data</span><span class="p">)</span>

    <span class="c1"># Test old vs new chunk sizes</span>
    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="mi">10_000</span>
    <span class="n">new_chunk_size</span> <span class="o">=</span> <span class="mi">30_000</span>

    <span class="c1"># Benchmark old chunk size</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">old_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_vectorized_ngram_generation</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">old_chunk_size</span><span class="p">,</span> <span class="n">min_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">old_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Benchmark new chunk size</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">new_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark_vectorized_ngram_generation</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">new_chunk_size</span><span class="p">,</span> <span class="n">min_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Should produce same results</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_result</span><span class="p">),</span> <span class="s2">&quot;Results should be identical&quot;</span>

    <span class="c1"># Should be faster with larger chunks</span>
    <span class="n">time_improvement</span> <span class="o">=</span> <span class="n">old_time</span> <span class="o">/</span> <span class="n">new_time</span> <span class="k">if</span> <span class="n">new_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">time_improvement</span> <span class="o">&gt;=</span> <span class="mf">0.95</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected at least 0.95x improvement, got </span><span class="si">{</span><span class="n">time_improvement</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="testing.performance.test_performance_benchmarks.TestStressTests" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestStressTests</code>


</h5>


    <div class="doc doc-contents ">


        <p>Stress tests for extreme conditions.</p>







              <details class="quote">
                <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">class</span> <span class="nc">TestStressTests</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stress tests for extreme conditions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_large_chunk_memory_stability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that large chunks don&#39;t cause memory issues.&quot;&quot;&quot;</span>
        <span class="c1"># Test with largest possible chunk size</span>
        <span class="n">large_chunk_size</span> <span class="o">=</span> <span class="mi">500_000</span>  <span class="c1"># Maximum allowed</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>  <span class="c1"># Smaller than chunk</span>

        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Process with large chunk</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">large_chunk_size</span><span class="p">)</span>
        <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">memory_increase</span> <span class="o">=</span> <span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span>

        <span class="c1"># Should complete successfully</span>
        <span class="k">assert</span> <span class="n">processing_time</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="c1"># Memory usage should be reasonable</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage (</span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB) should be within 80% of limit&quot;</span>

    <span class="k">def</span> <span class="nf">test_many_small_chunks_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test efficiency with many small chunks.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>
        <span class="n">small_chunk_size</span> <span class="o">=</span> <span class="mi">10_000</span>  <span class="c1"># Many small chunks</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">small_chunk_size</span><span class="p">)</span>
        <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Should complete in reasonable time</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">processing_time</span> <span class="o">&lt;</span> <span class="mi">60</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Processing took </span><span class="si">{</span><span class="n">processing_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s, should be &lt; 60s&quot;</span>

        <span class="c1"># Should have expected number of chunks</span>
        <span class="n">expected_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">+</span> <span class="n">small_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">small_chunk_size</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num_chunks</span> <span class="o">-</span> <span class="n">expected_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_create_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a simple test dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;msg_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;test message </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> content&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;author_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)],</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2023-01-01T00:00:00Z&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_simulate_chunk_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate chunk processing and return number of chunks.&quot;&quot;&quot;</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataset_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span>

            <span class="c1"># Simulate basic processing</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len_chars</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;text_length&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;message_id&quot;</span><span class="p">),</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;author_id&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">num_chunks</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Periodic cleanup</span>
            <span class="k">if</span> <span class="n">num_chunks</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">num_chunks</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestStressTests.test_large_chunk_memory_stability" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_large_chunk_memory_stability</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test that large chunks don't cause memory issues.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_large_chunk_memory_stability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that large chunks don&#39;t cause memory issues.&quot;&quot;&quot;</span>
    <span class="c1"># Test with largest possible chunk size</span>
    <span class="n">large_chunk_size</span> <span class="o">=</span> <span class="mi">500_000</span>  <span class="c1"># Maximum allowed</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>  <span class="c1"># Smaller than chunk</span>

    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Process with large chunk</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">large_chunk_size</span><span class="p">)</span>
    <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">memory_increase</span> <span class="o">=</span> <span class="n">peak_memory</span> <span class="o">-</span> <span class="n">initial_memory</span>

    <span class="c1"># Should complete successfully</span>
    <span class="k">assert</span> <span class="n">processing_time</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="c1"># Memory usage should be reasonable</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">memory_increase</span> <span class="o">&lt;</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mf">0.8</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Memory usage (</span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB) should be within 80% of limit&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="testing.performance.test_performance_benchmarks.TestStressTests.test_many_small_chunks_efficiency" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_many_small_chunks_efficiency</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Test efficiency with many small chunks.</p>


            <details class="quote">
              <summary>Source code in <code>testing/performance/test_performance_benchmarks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_many_small_chunks_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test efficiency with many small chunks.&quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_test_dataset</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span>
    <span class="n">small_chunk_size</span> <span class="o">=</span> <span class="mi">10_000</span>  <span class="c1"># Many small chunks</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">num_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_chunk_processing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">small_chunk_size</span><span class="p">)</span>
    <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Should complete in reasonable time</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">processing_time</span> <span class="o">&lt;</span> <span class="mi">60</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Processing took </span><span class="si">{</span><span class="n">processing_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s, should be &lt; 60s&quot;</span>

    <span class="c1"># Should have expected number of chunks</span>
    <span class="n">expected_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">+</span> <span class="n">small_chunk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">small_chunk_size</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num_chunks</span> <span class="o">-</span> <span class="n">expected_chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="testing.testers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>testers</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="testing.testers.test_primary_analyzer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">test_primary_analyzer</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Runs the primary analyzer test.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_primary_analyzer(interface)" class="doc doc-heading doc-heading-parameter">                  <code>interface</code>
</h5>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;AnalyzerInterface&lt;/code&gt; (&lt;code&gt;analyzer_interface.AnalyzerInterface&lt;/code&gt;)" href="../analyzer_interface/#analyzer_interface.interface.AnalyzerInterface">AnalyzerInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interface of the analyzer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_primary_analyzer(main)" class="doc doc-heading doc-heading-parameter">                  <code>main</code>
</h5>            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;PrimaryAnalyzerContext&lt;/code&gt; (&lt;code&gt;analyzer_interface.context.PrimaryAnalyzerContext&lt;/code&gt;)" href="../analyzer_interface/#analyzer_interface.context.PrimaryAnalyzerContext">PrimaryAnalyzerContext</a>], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main function of the analyzer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_primary_analyzer(input)" class="doc doc-heading doc-heading-parameter">                  <code>input</code>
</h5>            </td>
            <td>
                  <code><span title="testing.testdata.TestData">TestData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_primary_analyzer(params)" class="doc doc-heading doc-heading-parameter">                  <code>params</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="analyzer_interface.ParamValue">ParamValue</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(Optional) The analysis parameters.</p>
              </div>
            </td>
            <td>
                  <code><span title="dict">dict</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_primary_analyzer(outputs)" class="doc doc-heading doc-heading-parameter">                  <code>outputs</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="testing.testdata.TestData">TestData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output data, keyed by output ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>testing/testers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_primary_analyzer</span><span class="p">(</span>
    <span class="n">interface</span><span class="p">:</span> <span class="n">AnalyzerInterface</span><span class="p">,</span>
    <span class="n">main</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">PrimaryAnalyzerContext</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">TestData</span><span class="p">,</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TestData</span><span class="p">],</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ParamValue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the primary analyzer test.</span>

<span class="sd">    Args:</span>
<span class="sd">        interface (AnalyzerInterface): The interface of the analyzer.</span>
<span class="sd">        main (Callable[[PrimaryAnalyzerContext], None]): The main function of the analyzer.</span>
<span class="sd">        input (TestData): The input data.</span>
<span class="sd">        params (dict[str, ParamValue]): (Optional) The analysis parameters.</span>
<span class="sd">        outputs (dict[str, TestData]): The output data, keyed by output ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">exit_stack</span><span class="p">:</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">actual_output_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">actual_input_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">actual_input_dir</span><span class="p">,</span> <span class="s2">&quot;input.parquet&quot;</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">convert_to_parquet</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>

        <span class="c1"># Create input_columns mapping from interface and test data semantics</span>
        <span class="kn">from</span> <span class="nn">testing.context</span> <span class="kn">import</span> <span class="n">TestInputColumnProvider</span>

        <span class="n">input_columns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">column_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">analyzer_column_name</span> <span class="o">=</span> <span class="n">column_spec</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># For testing, we assume the user column name matches the analyzer column name</span>
            <span class="n">user_column_name</span> <span class="o">=</span> <span class="n">analyzer_column_name</span>
            <span class="n">semantic</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">semantics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">analyzer_column_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">semantic</span><span class="p">:</span>
                <span class="n">input_columns</span><span class="p">[</span><span class="n">analyzer_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestInputColumnProvider</span><span class="p">(</span>
                    <span class="n">user_column_name</span><span class="o">=</span><span class="n">user_column_name</span><span class="p">,</span> <span class="n">semantic</span><span class="o">=</span><span class="n">semantic</span>
                <span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">TestPrimaryAnalyzerContext</span><span class="p">(</span>
            <span class="n">temp_dir</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">,</span>
            <span class="n">input_parquet_path</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span>
            <span class="n">param_values</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">output_parquet_root_path</span><span class="o">=</span><span class="n">actual_output_dir</span><span class="p">,</span>
            <span class="n">input_columns</span><span class="o">=</span><span class="n">input_columns</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">main</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

        <span class="n">specified_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>
        <span class="n">unused_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">output_id</span>
            <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specified_outputs</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">unused_outputs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The test case provided outputs that are not specified in the interface: </span><span class="si">{</span><span class="n">unused_outputs</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">has_compared_output</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_compared_output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The test case did not compare any outputs.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="n">expected_output_data</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">expected_output_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">actual_output_path</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">output_path</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">expected_output</span> <span class="o">=</span> <span class="n">expected_output_data</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">actual_output</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">actual_output_path</span><span class="p">)</span>
            <span class="n">compare_dfs</span><span class="p">(</span><span class="n">actual_output</span><span class="p">,</span> <span class="n">expected_output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="testing.testers.test_secondary_analyzer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">test_secondary_analyzer</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">primary_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">primary_outputs</span><span class="p">,</span> <span class="n">dependency_outputs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">expected_outputs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Runs the secondary analyzer test.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(interface)" class="doc doc-heading doc-heading-parameter">                  <code>interface</code>
</h5>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;AnalyzerInterface&lt;/code&gt; (&lt;code&gt;analyzer_interface.AnalyzerInterface&lt;/code&gt;)" href="../analyzer_interface/#analyzer_interface.interface.AnalyzerInterface">AnalyzerInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interface of the analyzer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(main)" class="doc doc-heading doc-heading-parameter">                  <code>main</code>
</h5>            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="SecondaryAnalyzerInterface">SecondaryAnalyzerInterface</span>], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main function of the analyzer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(primary_params)" class="doc doc-heading doc-heading-parameter">                  <code>primary_params</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="analyzer_interface.ParamValue">ParamValue</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(Optional) The primary analysis parameters.</p>
              </div>
            </td>
            <td>
                  <code><span title="dict">dict</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(primary_outputs)" class="doc doc-heading doc-heading-parameter">                  <code>primary_outputs</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="testing.testdata.TestData">TestData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The primary output data, keyed by output ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(dependency_outputs)" class="doc doc-heading doc-heading-parameter">                  <code>dependency_outputs</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="testing.testdata.TestData">TestData</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dependency output data, keyed by dependency ID and then by output ID.</p>
              </div>
            </td>
            <td>
                  <code><span title="dict">dict</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="testing.testers.test_secondary_analyzer(expected_outputs)" class="doc doc-heading doc-heading-parameter">                  <code>expected_outputs</code>
</h5>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="testing.testdata.TestData">TestData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The expected output data, keyed by output ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>testing/testers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_secondary_analyzer</span><span class="p">(</span>
    <span class="n">interface</span><span class="p">:</span> <span class="n">AnalyzerInterface</span><span class="p">,</span>
    <span class="n">main</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">SecondaryAnalyzerContext</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">primary_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ParamValue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="n">primary_outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TestData</span><span class="p">],</span>
    <span class="n">dependency_outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TestData</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="n">expected_outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TestData</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the secondary analyzer test.</span>

<span class="sd">    Args:</span>
<span class="sd">        interface (AnalyzerInterface): The interface of the analyzer.</span>
<span class="sd">        main (Callable[[SecondaryAnalyzerInterface], None]): The main function of the analyzer.</span>
<span class="sd">        primary_params (dict[str, ParamValue]): (Optional) The primary analysis parameters.</span>
<span class="sd">        primary_outputs (dict[str, TestData]): The primary output data, keyed by output ID.</span>
<span class="sd">        dependency_outputs (dict[str, dict[str, TestData]]): The dependency output data, keyed by dependency ID and then by output ID.</span>
<span class="sd">        expected_outputs (dict[str, TestData]): The expected output data, keyed by output ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">exit_stack</span><span class="p">:</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">actual_output_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">actual_base_output_dir</span> <span class="o">=</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span>
            <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">actual_dependency_output_dirs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dependency_id</span><span class="p">:</span> <span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">dependency_id</span> <span class="ow">in</span> <span class="n">dependency_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">output_id</span><span class="p">,</span> <span class="n">output_data</span> <span class="ow">in</span> <span class="n">primary_outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">convert_to_parquet</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">actual_base_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_id</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">dependency_id</span><span class="p">,</span> <span class="n">dependency_output</span> <span class="ow">in</span> <span class="n">dependency_outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">output_id</span><span class="p">,</span> <span class="n">output_data</span> <span class="ow">in</span> <span class="n">dependency_output</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">output_data</span><span class="o">.</span><span class="n">convert_to_parquet</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">actual_dependency_output_dirs</span><span class="p">[</span><span class="n">dependency_id</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_id</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">TestSecondaryAnalyzerContext</span><span class="p">(</span>
            <span class="n">temp_dir</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">,</span>
            <span class="n">primary_param_values</span><span class="o">=</span><span class="n">primary_params</span><span class="p">,</span>
            <span class="n">primary_output_parquet_paths</span><span class="o">=</span><span class="p">{</span>
                <span class="n">output_id</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">actual_base_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_id</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">primary_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="n">dependency_output_parquet_paths</span><span class="o">=</span><span class="p">{</span>
                <span class="n">dependency_id</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">output_id</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">actual_dependency_output_dirs</span><span class="p">[</span><span class="n">dependency_id</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_id</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">dependency_output</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">dependency_id</span><span class="p">,</span> <span class="n">dependency_output</span> <span class="ow">in</span> <span class="n">dependency_outputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="n">output_parquet_root_path</span><span class="o">=</span><span class="n">actual_output_dir</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">main</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

        <span class="n">specified_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>
        <span class="n">unused_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">output_id</span>
            <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">expected_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specified_outputs</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">unused_outputs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The test case provided outputs that are not specified in the interface: </span><span class="si">{</span><span class="n">unused_outputs</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">has_compared_output</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">expected_outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_compared_output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The test case did not compare any outputs.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">output_spec</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="n">expected_output_data</span> <span class="o">=</span> <span class="n">expected_outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">expected_output_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">actual_output_path</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">output_path</span><span class="p">(</span><span class="n">output_spec</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">expected_output</span> <span class="o">=</span> <span class="n">expected_output_data</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">actual_output</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">actual_output_path</span><span class="p">)</span>
            <span class="n">compare_dfs</span><span class="p">(</span><span class="n">actual_output</span><span class="p">,</span> <span class="n">expected_output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 CIB Mango Tree
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.path", "navigation.sections", "navigation.top", "navigation.tabs", "content.code.copy", "content.tooltips", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>
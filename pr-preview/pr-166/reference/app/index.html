
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An interactive python terminal UI wrapper for Mango Tree analyzers.">
      
      
        <meta name="author" content="CIB Mango Tree">
      
      
        <link rel="canonical" href="https://cibmangotree.org/reference/app/">
      
      
        <link rel="prev" href="../components/">
      
      
        <link rel="next" href="../preprocessing/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>App - CIB Mango Tree</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#app" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CIB Mango Tree" class="md-header__button md-logo" aria-label="CIB Mango Tree" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CIB Mango Tree
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              App
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/civictechdc/mango-tango-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/get-started/overview/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../analyzer_interface/" class="md-tabs__link">
          
  
  
  Reference (CLI)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CIB Mango Tree" class="md-nav__button md-logo" aria-label="CIB Mango Tree" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    CIB Mango Tree
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/civictechdc/mango-tango-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/get-started/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/get-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributor Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/analyzers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementing Analyzers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dashboards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Dashboards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/dashboards/shiny/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shiny
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/dashboards/react/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React (WIP)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Design Philosophy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Design Philosophy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/core-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/edge-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Edge Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/design-philosophy/content-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content Domain
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference (CLI)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference (CLI)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzer_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analyzer Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    App
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    App
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;app
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.ContextEnrichmentFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ContextEnrichmentFilter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.get_logger(name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;setup_logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" setup_logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(log_file_path)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;log_file_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(level)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(app_version)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;app_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestContextEnrichment
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestContextEnrichment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_cli_level_controls_file_handler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_cli_level_controls_file_handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_context_filter_adds_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_context_filter_adds_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_global_exception_handler_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_global_exception_handler_setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_third_party_logger_levels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_third_party_logger_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestGetLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestGetLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_returns_logger_instance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_returns_logger_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_with_different_names" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_with_different_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_with_same_name_returns_same_instance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_with_same_name_returns_same_instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestIntegration.test_full_logging_workflow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_full_logging_workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSetupLogging
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestSetupLogging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_console_handler_only_shows_errors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_console_handler_only_shows_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_file_handler_logs_info_and_above" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_file_handler_logs_info_and_above
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_log_format_is_json" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_log_format_is_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_configures_handlers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_configures_handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_configures_root_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_configures_root_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_creates_log_directory" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_creates_log_directory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_memory_aware_progress
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_memory_aware_progress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRichProgressManagerMemoryFeatures
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestRichProgressManagerMemoryFeatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_display_memory_summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_warning_content" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_display_memory_warning_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_garbage_collection_reporting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_garbage_collection_reporting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_with_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_initialization_with_memory_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_without_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_initialization_without_memory_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_warning_throttling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_warning_throttling_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_no_gc_reporting_for_small_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_no_gc_reporting_for_small_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_critical_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_critical_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_high_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_high_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_low_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_low_pressure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRichProgressManagerMemoryIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestRichProgressManagerMemoryIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration.test_full_analysis_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_full_analysis_simulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_memory_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_memory_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestMemoryManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_adaptive_chunk_sizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_sizing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_enhanced_gc_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_enhanced_gc_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_gc_trigger_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_gc_trigger_threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_get_current_memory_usage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_current_memory_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_history_size_limit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_history_size_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_manager_initialization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_pressure_levels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_pressure_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_trend_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_trend_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_minimum_chunk_size_enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_minimum_chunk_size_enforcement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_operation_specific_chunk_sizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_operation_specific_chunk_sizing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryManagerIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestMemoryManagerIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration.test_adaptive_chunk_sizing_realistic_scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_sizing_realistic_scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration.test_memory_manager_with_real_operations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_with_real_operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIsSpaceSeparated
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestIsSpaceSeparated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_arabic_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_arabic_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_chinese_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_cyrillic_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_cyrillic_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_empty_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_japanese_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_japanese_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_latin_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_latin_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_chinese" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_scripts_majority_chinese
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_latin" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_scripts_majority_latin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_no_script_characters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_no_script_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_polars_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_polars_expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_thai_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_thai_script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestTokenizationIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestTokenizationIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration.test_empty_message_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_message_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration.test_tokenization_with_ngram_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_tokenization_with_ngram_pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestTokenizeText
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestTokenizeText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_case_preservation_for_urls" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_case_preservation_for_urls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_chinese_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_chinese_text_with_spaces" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_text_with_spaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_complex_urls_with_punctuation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_complex_urls_with_punctuation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_comprehensive_punctuation_categories" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_comprehensive_punctuation_categories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_empty_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_invalid_input_types" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_invalid_input_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_mixed_script_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_script_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_multiple_messages" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_multiple_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_ngram_punctuation_regression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_punctuation_regression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_nonexistent_column" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_nonexistent_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_performance_with_large_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_with_large_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_edge_cases_preserved" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_edge_cases_preserved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_with_multilingual_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_with_multilingual_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_pure_punctuation_filtering" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_pure_punctuation_filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_real_world_social_media_example" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_real_world_social_media_example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_simple_english_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_simple_english_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_social_media_entities" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_social_media_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_social_media_entity_variations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_social_media_entity_variations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_special_characters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_special_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_symbol_filtering_specificity" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_symbol_filtering_specificity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_url_with_cjk_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_url_with_cjk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_whitespace_normalization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_whitespace_normalization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemoryManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MemoryManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.calculate_adaptive_chunk_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_adaptive_chunk_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.enhanced_gc_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;enhanced_gc_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_current_memory_usage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_current_memory_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_memory_pressure_level" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_memory_pressure_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_memory_trend" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_memory_trend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.should_trigger_gc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;should_trigger_gc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.is_space_separated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;is_space_separated
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" is_space_separated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.is_space_separated(text)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.parquet_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parquet_row_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;tokenize_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" tokenize_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(ldf)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ldf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(text_column)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;text_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(progress_manager)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;progress_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(memory_manager)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;memory_manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terminal_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminal Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Importing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;app
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.ContextEnrichmentFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ContextEnrichmentFilter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.get_logger(name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;setup_logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" setup_logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(log_file_path)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;log_file_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(level)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.logger.setup_logging(app_version)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;app_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestContextEnrichment
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestContextEnrichment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_cli_level_controls_file_handler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_cli_level_controls_file_handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_context_filter_adds_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_context_filter_adds_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_global_exception_handler_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_global_exception_handler_setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestContextEnrichment.test_third_party_logger_levels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_third_party_logger_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestGetLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestGetLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_returns_logger_instance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_returns_logger_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_with_different_names" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_with_different_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestGetLogger.test_get_logger_with_same_name_returns_same_instance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_logger_with_same_name_returns_same_instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestIntegration.test_full_logging_workflow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_full_logging_workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestSetupLogging
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestSetupLogging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_console_handler_only_shows_errors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_console_handler_only_shows_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_file_handler_logs_info_and_above" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_file_handler_logs_info_and_above
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_log_format_is_json" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_log_format_is_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_configures_handlers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_configures_handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_configures_root_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_configures_root_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_logger.TestSetupLogging.test_setup_logging_creates_log_directory" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_setup_logging_creates_log_directory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_memory_aware_progress
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_memory_aware_progress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRichProgressManagerMemoryFeatures
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestRichProgressManagerMemoryFeatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_display_memory_summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_warning_content" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_display_memory_warning_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_garbage_collection_reporting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_garbage_collection_reporting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_with_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_initialization_with_memory_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_without_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_initialization_without_memory_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_warning_throttling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_warning_throttling_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_no_gc_reporting_for_small_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_no_gc_reporting_for_small_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_critical_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_critical_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_high_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_high_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_low_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_update_step_with_memory_low_pressure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestRichProgressManagerMemoryIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestRichProgressManagerMemoryIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration.test_full_analysis_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_full_analysis_simulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_memory_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_memory_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestMemoryManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_adaptive_chunk_sizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_sizing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_enhanced_gc_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_enhanced_gc_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_gc_trigger_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_gc_trigger_threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_get_current_memory_usage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_get_current_memory_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_history_size_limit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_history_size_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_manager_initialization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_pressure_levels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_pressure_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_memory_trend_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_trend_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_minimum_chunk_size_enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_minimum_chunk_size_enforcement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManager.test_operation_specific_chunk_sizing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_operation_specific_chunk_sizing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestMemoryManagerIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestMemoryManagerIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration.test_adaptive_chunk_sizing_realistic_scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_adaptive_chunk_sizing_realistic_scenarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_memory_manager.TestMemoryManagerIntegration.test_memory_manager_with_real_operations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_memory_manager_with_real_operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;test_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" test_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestIsSpaceSeparated
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestIsSpaceSeparated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_arabic_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_arabic_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_chinese_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_cyrillic_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_cyrillic_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_empty_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_japanese_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_japanese_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_latin_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_latin_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_chinese" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_scripts_majority_chinese
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_latin" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_scripts_majority_latin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_no_script_characters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_no_script_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_polars_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_polars_expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestIsSpaceSeparated.test_thai_script" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_thai_script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestTokenizationIntegration
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestTokenizationIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration.test_empty_message_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_message_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizationIntegration.test_tokenization_with_ngram_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_tokenization_with_ngram_pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestTokenizeText
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestTokenizeText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_case_preservation_for_urls" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_case_preservation_for_urls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_chinese_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_chinese_text_with_spaces" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_chinese_text_with_spaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_complex_urls_with_punctuation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_complex_urls_with_punctuation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_comprehensive_punctuation_categories" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_comprehensive_punctuation_categories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_empty_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_empty_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_invalid_input_types" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_invalid_input_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_mixed_script_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_mixed_script_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_multiple_messages" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_multiple_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_ngram_punctuation_regression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_ngram_punctuation_regression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_nonexistent_column" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_nonexistent_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_performance_with_large_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_performance_with_large_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_edge_cases_preserved" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_edge_cases_preserved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_handling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_punctuation_with_multilingual_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_punctuation_with_multilingual_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_pure_punctuation_filtering" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_pure_punctuation_filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_real_world_social_media_example" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_real_world_social_media_example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_simple_english_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_simple_english_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_social_media_entities" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_social_media_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_social_media_entity_variations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_social_media_entity_variations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_special_characters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_special_characters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_symbol_filtering_specificity" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_symbol_filtering_specificity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_url_with_cjk_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_url_with_cjk_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.test_utils.TestTokenizeText.test_whitespace_normalization" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test_whitespace_normalization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemoryManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MemoryManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.calculate_adaptive_chunk_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_adaptive_chunk_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.enhanced_gc_cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;enhanced_gc_cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_current_memory_usage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_current_memory_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_memory_pressure_level" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_memory_pressure_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.get_memory_trend" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_memory_trend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.MemoryManager.should_trigger_gc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;should_trigger_gc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.is_space_separated" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;is_space_separated
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" is_space_separated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.is_space_separated(text)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.parquet_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parquet_row_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;tokenize_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" tokenize_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(ldf)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ldf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(text_column)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;text_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(progress_manager)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;progress_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.tokenize_text(memory_manager)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;memory_manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>App</h1>

<div class="doc doc-object doc-module">



<h2 id="app" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>app</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="app.logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>logger</code>


</h3>

    <div class="doc doc-contents ">

        <p>Application-wide logging system for Mango Tango CLI.</p>
<p>Provides structured JSON logging with:
- Console output (ERROR and CRITICAL levels only) to stderr
- File output (INFO and above) with automatic rotation
- Configurable log levels via CLI flag</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.logger.ContextEnrichmentFilter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>ContextEnrichmentFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>


        <p>Filter that enriches log records with contextual information.</p>
<p>Adds:
- process_id: Current process ID
- thread_id: Current thread ID
- app_version: Application version (if available)</p>







              <details class="quote">
                <summary>Source code in <code>app/logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ContextEnrichmentFilter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter that enriches log records with contextual information.</span>

<span class="sd">    Adds:</span>
<span class="sd">    - process_id: Current process ID</span>
<span class="sd">    - thread_id: Current thread ID</span>
<span class="sd">    - app_version: Application version (if available)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_version</span> <span class="o">=</span> <span class="n">app_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">LogRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># Add contextual information to the log record</span>
        <span class="n">record</span><span class="o">.</span><span class="n">process_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_id</span>
        <span class="n">record</span><span class="o">.</span><span class="n">thread_id</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span>
        <span class="n">record</span><span class="o">.</span><span class="n">app_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_version</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="app.logger.get_logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get a logger instance for the specified module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="app.logger.get_logger(name)" class="doc doc-heading doc-heading-parameter">                  <code>name</code>
</h5>            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger name (typically <strong>name</strong>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured logger instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>app/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a logger instance for the specified module.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Logger name (typically __name__)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured logger instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.logger.setup_logging" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">app_version</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Configure application-wide logging with structured JSON output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="app.logger.setup_logging(log_file_path)" class="doc doc-heading doc-heading-parameter">                  <code>log_file_path</code>
</h5>            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="app.logger.setup_logging(level)" class="doc doc-heading doc-heading-parameter">                  <code>level</code>
</h5>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum logging level (default: logging.INFO)</p>
              </div>
            </td>
            <td>
                  <code><span title="logging.INFO">INFO</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="app.logger.setup_logging(app_version)" class="doc doc-heading doc-heading-parameter">                  <code>app_version</code>
</h5>            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Application version to include in logs</p>
              </div>
            </td>
            <td>
                  <code>&#39;unknown&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>app/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span>
    <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">app_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure application-wide logging with structured JSON output.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_file_path: Path to the log file</span>
<span class="sd">        level: Minimum logging level (default: logging.INFO)</span>
<span class="sd">        app_version: Application version to include in logs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the log directory exists</span>
    <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Logging configuration dictionary</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;disable_existing_loggers&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;formatters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="s2">&quot;pythonjsonlogger.json.JsonFormatter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2"> </span><span class="si">%(process_id)s</span><span class="s2"> </span><span class="si">%(thread_id)s</span><span class="s2"> </span><span class="si">%(app_version)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rename_fields&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;levelname&quot;</span><span class="p">:</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;asctime&quot;</span><span class="p">:</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">},</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;context_enrichment&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="n">ContextEnrichmentFilter</span><span class="p">,</span>
                <span class="s2">&quot;app_version&quot;</span><span class="p">:</span> <span class="n">app_version</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
                <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;context_enrichment&quot;</span><span class="p">],</span>
                <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.handlers.RotatingFileHandler&quot;</span><span class="p">,</span>
                <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
                <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;context_enrichment&quot;</span><span class="p">],</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">),</span>
                <span class="s2">&quot;maxBytes&quot;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>  <span class="c1"># 10MB</span>
                <span class="s2">&quot;backupCount&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">]},</span>
        <span class="s2">&quot;loggers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Third-party library loggers - keep them quieter by default</span>
            <span class="s2">&quot;urllib3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;requests&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;dash&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;plotly&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;shiny&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;uvicorn&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;starlette&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="c1"># Application loggers - inherit from root level</span>
            <span class="s2">&quot;mangotango&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;analyzers&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;storage&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;importing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Apply the configuration</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="c1"># Set up global exception handler</span>
    <span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle uncaught exceptions by logging them.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
            <span class="c1"># Let KeyboardInterrupt be handled normally</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;uncaught_exception&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;Uncaught exception&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">),</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;exception_type&quot;</span><span class="p">:</span> <span class="n">exc_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;exception_message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_value</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Install the global exception handler</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">handle_exception</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="app.test_logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_logger</code>


</h3>

    <div class="doc doc-contents ">

        <p>Unit tests for the logging configuration module.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.test_logger.TestContextEnrichment" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestContextEnrichment</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test cases for context enrichment features.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestContextEnrichment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for context enrichment features.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_context_filter_adds_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that context filter adds process_id, thread_id, and app_version.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;context_test_version&quot;</span><span class="p">)</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;context_test&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test context enrichment&quot;</span><span class="p">)</span>

            <span class="c1"># Force flush</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Read and verify log contains enriched context</span>
            <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">log_content</span><span class="p">:</span>
                    <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">log_content</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="s2">&quot;process_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                    <span class="k">assert</span> <span class="s2">&quot;thread_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                    <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;app_version&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;context_test_version&quot;</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;process_id&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;thread_id&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_third_party_logger_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that third-party loggers are set to WARNING level.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;hierarchy_test&quot;</span><span class="p">)</span>

            <span class="c1"># Test third-party loggers</span>
            <span class="n">urllib3_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;urllib3&quot;</span><span class="p">)</span>
            <span class="n">requests_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;requests&quot;</span><span class="p">)</span>
            <span class="n">dash_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">)</span>

            <span class="c1"># They should be set to WARNING level</span>
            <span class="k">assert</span> <span class="n">urllib3_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
            <span class="k">assert</span> <span class="n">requests_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
            <span class="k">assert</span> <span class="n">dash_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>

            <span class="c1"># Application loggers should inherit root level (DEBUG)</span>
            <span class="n">app_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">app_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>

    <span class="k">def</span> <span class="nf">test_cli_level_controls_file_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that CLI log level properly controls file handler level.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="c1"># Set up with DEBUG level</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;cli_test&quot;</span><span class="p">)</span>

            <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
            <span class="n">file_handler</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Find the file handler</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s2">&quot;baseFilename&quot;</span><span class="p">):</span>
                    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">handler</span>
                    <span class="k">break</span>

            <span class="k">assert</span> <span class="n">file_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="c1"># File handler level should match the CLI level</span>
            <span class="k">assert</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>

    <span class="k">def</span> <span class="nf">test_global_exception_handler_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that global exception handler is installed.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="c1"># Store original exception handler</span>
            <span class="n">original_excepthook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;exception_test&quot;</span><span class="p">)</span>

                <span class="c1"># Exception handler should be modified</span>
                <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">!=</span> <span class="n">original_excepthook</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Restore original handler</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">original_excepthook</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestContextEnrichment.test_cli_level_controls_file_handler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_cli_level_controls_file_handler</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that CLI log level properly controls file handler level.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_cli_level_controls_file_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that CLI log level properly controls file handler level.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="c1"># Set up with DEBUG level</span>
        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;cli_test&quot;</span><span class="p">)</span>

        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
        <span class="n">file_handler</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Find the file handler</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s2">&quot;baseFilename&quot;</span><span class="p">):</span>
                <span class="n">file_handler</span> <span class="o">=</span> <span class="n">handler</span>
                <span class="k">break</span>

        <span class="k">assert</span> <span class="n">file_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># File handler level should match the CLI level</span>
        <span class="k">assert</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestContextEnrichment.test_context_filter_adds_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_context_filter_adds_metadata</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that context filter adds process_id, thread_id, and app_version.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_context_filter_adds_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that context filter adds process_id, thread_id, and app_version.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;context_test_version&quot;</span><span class="p">)</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;context_test&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test context enrichment&quot;</span><span class="p">)</span>

        <span class="c1"># Force flush</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Read and verify log contains enriched context</span>
        <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">log_content</span><span class="p">:</span>
                <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">log_content</span><span class="p">)</span>
                <span class="k">assert</span> <span class="s2">&quot;process_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                <span class="k">assert</span> <span class="s2">&quot;thread_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;app_version&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;context_test_version&quot;</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;process_id&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;thread_id&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestContextEnrichment.test_global_exception_handler_setup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_global_exception_handler_setup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that global exception handler is installed.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_global_exception_handler_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that global exception handler is installed.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="c1"># Store original exception handler</span>
        <span class="n">original_excepthook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;exception_test&quot;</span><span class="p">)</span>

            <span class="c1"># Exception handler should be modified</span>
            <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">!=</span> <span class="n">original_excepthook</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original handler</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">original_excepthook</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestContextEnrichment.test_third_party_logger_levels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_third_party_logger_levels</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that third-party loggers are set to WARNING level.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_third_party_logger_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that third-party loggers are set to WARNING level.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;hierarchy_test&quot;</span><span class="p">)</span>

        <span class="c1"># Test third-party loggers</span>
        <span class="n">urllib3_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;urllib3&quot;</span><span class="p">)</span>
        <span class="n">requests_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;requests&quot;</span><span class="p">)</span>
        <span class="n">dash_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">)</span>

        <span class="c1"># They should be set to WARNING level</span>
        <span class="k">assert</span> <span class="n">urllib3_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="k">assert</span> <span class="n">requests_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="k">assert</span> <span class="n">dash_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>

        <span class="c1"># Application loggers should inherit root level (DEBUG)</span>
        <span class="n">app_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">app_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_logger.TestGetLogger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestGetLogger</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test cases for the get_logger function.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestGetLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for the get_logger function.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_get_logger_returns_logger_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns a logging.Logger instance.&quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_logger_with_different_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns different loggers for different names.&quot;&quot;&quot;</span>
        <span class="n">logger1</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test1&quot;</span><span class="p">)</span>
        <span class="n">logger2</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test2&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">logger1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;test1&quot;</span>
        <span class="k">assert</span> <span class="n">logger2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;test2&quot;</span>
        <span class="k">assert</span> <span class="n">logger1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">logger2</span>

    <span class="k">def</span> <span class="nf">test_get_logger_with_same_name_returns_same_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns the same instance for the same name.&quot;&quot;&quot;</span>
        <span class="n">logger1</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">logger2</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">logger1</span> <span class="ow">is</span> <span class="n">logger2</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestGetLogger.test_get_logger_returns_logger_instance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_get_logger_returns_logger_instance</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that get_logger returns a logging.Logger instance.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_get_logger_returns_logger_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns a logging.Logger instance.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestGetLogger.test_get_logger_with_different_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_get_logger_with_different_names</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that get_logger returns different loggers for different names.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_get_logger_with_different_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns different loggers for different names.&quot;&quot;&quot;</span>
    <span class="n">logger1</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test1&quot;</span><span class="p">)</span>
    <span class="n">logger2</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test2&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">logger1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;test1&quot;</span>
    <span class="k">assert</span> <span class="n">logger2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;test2&quot;</span>
    <span class="k">assert</span> <span class="n">logger1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">logger2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestGetLogger.test_get_logger_with_same_name_returns_same_instance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_get_logger_with_same_name_returns_same_instance</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that get_logger returns the same instance for the same name.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_get_logger_with_same_name_returns_same_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that get_logger returns the same instance for the same name.&quot;&quot;&quot;</span>
    <span class="n">logger1</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="n">logger2</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">logger1</span> <span class="ow">is</span> <span class="n">logger2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_logger.TestIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestIntegration</code>


</h4>


    <div class="doc doc-contents ">


        <p>Integration tests for the logging system.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests for the logging system.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_full_logging_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the complete logging workflow.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;integration_test.log&quot;</span>

            <span class="c1"># Setup logging</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;integration_test_version&quot;</span><span class="p">)</span>

            <span class="c1"># Get logger and log messages</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;integration_test&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integration test started&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This is a warning&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This is an error&quot;</span><span class="p">)</span>

            <span class="c1"># Force flush</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Verify log file exists and contains expected content</span>
            <span class="k">assert</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
            <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
            <span class="k">assert</span> <span class="s2">&quot;Integration test started&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;This is a warning&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;This is an error&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>

            <span class="c1"># Verify JSON format</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;integration_test&quot;</span>
                    <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
                    <span class="p">]</span>  <span class="c1"># renamed field</span>
                    <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;app_version&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;integration_test_version&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestIntegration.test_full_logging_workflow" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_full_logging_workflow</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test the complete logging workflow.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_full_logging_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the complete logging workflow.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;integration_test.log&quot;</span>

        <span class="c1"># Setup logging</span>
        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;integration_test_version&quot;</span><span class="p">)</span>

        <span class="c1"># Get logger and log messages</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;integration_test&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integration test started&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This is a warning&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This is an error&quot;</span><span class="p">)</span>

        <span class="c1"># Force flush</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Verify log file exists and contains expected content</span>
        <span class="k">assert</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;Integration test started&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
        <span class="k">assert</span> <span class="s2">&quot;This is a warning&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
        <span class="k">assert</span> <span class="s2">&quot;This is an error&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>

        <span class="c1"># Verify JSON format</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;integration_test&quot;</span>
                <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
                <span class="p">]</span>  <span class="c1"># renamed field</span>
                <span class="k">assert</span> <span class="n">log_entry</span><span class="p">[</span><span class="s2">&quot;app_version&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;integration_test_version&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_logger.TestSetupLogging" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestSetupLogging</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test cases for the setup_logging function.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestSetupLogging</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for the setup_logging function.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_setup_logging_creates_log_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that setup_logging creates the log directory if it doesn&#39;t exist.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;logs&quot;</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="c1"># Directory shouldn&#39;t exist initially</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">)</span>

            <span class="c1"># Directory should be created</span>
            <span class="k">assert</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_setup_logging_configures_root_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that setup_logging configures the root logger with correct level.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

            <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>

    <span class="k">def</span> <span class="nf">test_setup_logging_configures_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that setup_logging configures both console and file handlers.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

            <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

            <span class="c1"># Should have 2 handlers (console and file)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>

            <span class="c1"># Find console and file handlers</span>
            <span class="n">console_handler</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_handler</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">handler</span><span class="o">.</span><span class="n">stream</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
                <span class="p">):</span>
                    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">handler</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s2">&quot;baseFilename&quot;</span><span class="p">):</span>
                    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">handler</span>

            <span class="c1"># Console handler should exist and be set to ERROR level</span>
            <span class="k">assert</span> <span class="n">console_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">console_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span>

            <span class="c1"># File handler should exist and be set to INFO level</span>
            <span class="k">assert</span> <span class="n">file_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>

    <span class="k">def</span> <span class="nf">test_console_handler_only_shows_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that console handler only shows ERROR and CRITICAL messages.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="c1"># Use StringIO to capture stderr output</span>
            <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

            <span class="n">captured_stderr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

            <span class="c1"># Temporarily replace sys.stderr before setting up logging</span>
            <span class="n">original_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">captured_stderr</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

                <span class="c1"># Log messages at different levels</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Debug message&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Info message&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning message&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error message&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Critical message&quot;</span><span class="p">)</span>

                <span class="c1"># Force handlers to flush</span>
                <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                    <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="c1"># Get captured output</span>
                <span class="n">stderr_output</span> <span class="o">=</span> <span class="n">captured_stderr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

                <span class="c1"># Only ERROR and CRITICAL should appear on console</span>
                <span class="k">assert</span> <span class="s2">&quot;Error message&quot;</span> <span class="ow">in</span> <span class="n">stderr_output</span>
                <span class="k">assert</span> <span class="s2">&quot;Critical message&quot;</span> <span class="ow">in</span> <span class="n">stderr_output</span>
                <span class="k">assert</span> <span class="s2">&quot;Debug message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>
                <span class="k">assert</span> <span class="s2">&quot;Info message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>
                <span class="k">assert</span> <span class="s2">&quot;Warning message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Restore original stderr</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">original_stderr</span>

    <span class="k">def</span> <span class="nf">test_file_handler_logs_info_and_above</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that file handler logs INFO and above messages when set to INFO level.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="c1"># Set logging to INFO level (not DEBUG) to test INFO+ filtering</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

            <span class="c1"># Log messages at different levels</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Debug message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Info message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Critical message&quot;</span><span class="p">)</span>

            <span class="c1"># Force handlers to flush</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Read log file content</span>
            <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>

                <span class="c1"># Should contain INFO, WARNING, ERROR, CRITICAL but not DEBUG</span>
                <span class="k">assert</span> <span class="s2">&quot;Info message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
                <span class="k">assert</span> <span class="s2">&quot;Warning message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
                <span class="k">assert</span> <span class="s2">&quot;Error message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
                <span class="k">assert</span> <span class="s2">&quot;Critical message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
                <span class="k">assert</span> <span class="s2">&quot;Debug message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">log_content</span>

    <span class="k">def</span> <span class="nf">test_log_format_is_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that log messages are formatted as JSON.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test JSON format&quot;</span><span class="p">)</span>

            <span class="c1"># Force handlers to flush</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Read log file and verify JSON format</span>
            <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">log_content</span><span class="p">:</span>
                    <span class="c1"># Each line should be valid JSON</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                <span class="k">assert</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>  <span class="c1"># renamed from asctime</span>
                                <span class="k">assert</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                                <span class="k">assert</span> <span class="s2">&quot;level&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>  <span class="c1"># renamed from levelname</span>
                                <span class="k">assert</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                                <span class="k">assert</span> <span class="s2">&quot;process_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                                <span class="k">assert</span> <span class="s2">&quot;thread_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                                <span class="k">assert</span> <span class="s2">&quot;app_version&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                                <span class="n">pytest</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log line is not valid JSON: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_console_handler_only_shows_errors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_console_handler_only_shows_errors</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that console handler only shows ERROR and CRITICAL messages.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_console_handler_only_shows_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that console handler only shows ERROR and CRITICAL messages.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="c1"># Use StringIO to capture stderr output</span>
        <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

        <span class="n">captured_stderr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

        <span class="c1"># Temporarily replace sys.stderr before setting up logging</span>
        <span class="n">original_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">captured_stderr</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

            <span class="c1"># Log messages at different levels</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Debug message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Info message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error message&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Critical message&quot;</span><span class="p">)</span>

            <span class="c1"># Force handlers to flush</span>
            <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Get captured output</span>
            <span class="n">stderr_output</span> <span class="o">=</span> <span class="n">captured_stderr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

            <span class="c1"># Only ERROR and CRITICAL should appear on console</span>
            <span class="k">assert</span> <span class="s2">&quot;Error message&quot;</span> <span class="ow">in</span> <span class="n">stderr_output</span>
            <span class="k">assert</span> <span class="s2">&quot;Critical message&quot;</span> <span class="ow">in</span> <span class="n">stderr_output</span>
            <span class="k">assert</span> <span class="s2">&quot;Debug message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>
            <span class="k">assert</span> <span class="s2">&quot;Info message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>
            <span class="k">assert</span> <span class="s2">&quot;Warning message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stderr_output</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original stderr</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">original_stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_file_handler_logs_info_and_above" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_file_handler_logs_info_and_above</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that file handler logs INFO and above messages when set to INFO level.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_file_handler_logs_info_and_above</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that file handler logs INFO and above messages when set to INFO level.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="c1"># Set logging to INFO level (not DEBUG) to test INFO+ filtering</span>
        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

        <span class="c1"># Log messages at different levels</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Debug message&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Info message&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning message&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error message&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Critical message&quot;</span><span class="p">)</span>

        <span class="c1"># Force handlers to flush</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Read log file content</span>
        <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>

            <span class="c1"># Should contain INFO, WARNING, ERROR, CRITICAL but not DEBUG</span>
            <span class="k">assert</span> <span class="s2">&quot;Info message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;Warning message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;Error message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;Critical message&quot;</span> <span class="ow">in</span> <span class="n">log_content</span>
            <span class="k">assert</span> <span class="s2">&quot;Debug message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">log_content</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_log_format_is_json" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_log_format_is_json</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that log messages are formatted as JSON.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_log_format_is_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that log messages are formatted as JSON.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test JSON format&quot;</span><span class="p">)</span>

        <span class="c1"># Force handlers to flush</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Read log file and verify JSON format</span>
        <span class="k">if</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">log_content</span> <span class="o">=</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">log_content</span><span class="p">:</span>
                <span class="c1"># Each line should be valid JSON</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">log_entry</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">assert</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>  <span class="c1"># renamed from asctime</span>
                            <span class="k">assert</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                            <span class="k">assert</span> <span class="s2">&quot;level&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>  <span class="c1"># renamed from levelname</span>
                            <span class="k">assert</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                            <span class="k">assert</span> <span class="s2">&quot;process_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                            <span class="k">assert</span> <span class="s2">&quot;thread_id&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                            <span class="k">assert</span> <span class="s2">&quot;app_version&quot;</span> <span class="ow">in</span> <span class="n">log_entry</span>
                        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                            <span class="n">pytest</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log line is not valid JSON: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_setup_logging_configures_handlers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_setup_logging_configures_handlers</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that setup_logging configures both console and file handlers.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_setup_logging_configures_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that setup_logging configures both console and file handlers.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

        <span class="c1"># Should have 2 handlers (console and file)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>

        <span class="c1"># Find console and file handlers</span>
        <span class="n">console_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">file_handler</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">handler</span><span class="o">.</span><span class="n">stream</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">):</span>
                <span class="n">console_handler</span> <span class="o">=</span> <span class="n">handler</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s2">&quot;baseFilename&quot;</span><span class="p">):</span>
                <span class="n">file_handler</span> <span class="o">=</span> <span class="n">handler</span>

        <span class="c1"># Console handler should exist and be set to ERROR level</span>
        <span class="k">assert</span> <span class="n">console_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">console_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span>

        <span class="c1"># File handler should exist and be set to INFO level</span>
        <span class="k">assert</span> <span class="n">file_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_setup_logging_configures_root_logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_setup_logging_configures_root_logger</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that setup_logging configures the root logger with correct level.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_setup_logging_configures_root_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that setup_logging configures the root logger with correct level.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s2">&quot;test_version&quot;</span><span class="p">)</span>

        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_logger.TestSetupLogging.test_setup_logging_creates_log_directory" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_setup_logging_creates_log_directory</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that setup_logging creates the log directory if it doesn't exist.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_setup_logging_creates_log_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that setup_logging creates the log directory if it doesn&#39;t exist.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;logs&quot;</span> <span class="o">/</span> <span class="s2">&quot;test.log&quot;</span>

        <span class="c1"># Directory shouldn&#39;t exist initially</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

        <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">)</span>

        <span class="c1"># Directory should be created</span>
        <span class="k">assert</span> <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="app.test_memory_aware_progress" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_memory_aware_progress</code>


</h3>

    <div class="doc doc-contents ">

        <p>Tests for the enhanced RichProgressManager with memory monitoring features.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestRichProgressManagerMemoryFeatures</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test enhanced RichProgressManager memory monitoring functionality.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestRichProgressManagerMemoryFeatures</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test enhanced RichProgressManager memory monitoring functionality.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_initialization_with_memory_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RichProgressManager initializes correctly with memory manager.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span>
            <span class="s2">&quot;Test Analysis&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">==</span> <span class="n">memory_manager</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>  <span class="c1"># Initialized to 0 when memory_manager provided</span>
        <span class="k">assert</span> <span class="s2">&quot;Test Analysis&quot;</span> <span class="ow">in</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">title</span>

    <span class="k">def</span> <span class="nf">test_initialization_without_memory_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RichProgressManager initializes correctly without memory manager.&quot;&quot;&quot;</span>
        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test Analysis&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">memory_manager</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="s2">&quot;Test Analysis&quot;</span> <span class="ow">in</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">title</span>

    <span class="k">def</span> <span class="nf">test_update_step_with_memory_low_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with low memory pressure.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">12.5</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Should update normally without warnings</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">)</span>

        <span class="c1"># Verify memory stats were retrieved</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

        <span class="c1"># No GC should be triggered for low pressure</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_update_step_with_memory_high_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with high memory pressure.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Mock console printing to avoid actual output during tests</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">):</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span>
                <span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="s2">&quot;high pressure test&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Verify GC was triggered</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_update_step_with_memory_critical_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with critical memory pressure.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3500.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">87.5</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Mock _display_memory_warning to capture calls</span>
        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">progress_manager</span><span class="p">,</span> <span class="s2">&quot;_display_memory_warning&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_warning</span><span class="p">:</span>

            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;critical test&quot;</span><span class="p">)</span>

            <span class="c1"># Should display warning for critical pressure</span>
            <span class="n">mock_warning</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

            <span class="c1"># Verify it was called with critical pressure level</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_warning</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>

    <span class="k">def</span> <span class="nf">test_memory_warning_throttling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory warnings are throttled to avoid spam.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Mock console to capture calls</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="c1"># First call should display warning</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
                <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
                <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">first_call_count</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_count</span>

            <span class="c1"># Immediate second call should be throttled (no additional warning)</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
                <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
                <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">second_call_count</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_count</span>

            <span class="c1"># Should be the same (no new warning)</span>
            <span class="k">assert</span> <span class="n">second_call_count</span> <span class="o">==</span> <span class="n">first_call_count</span>

    <span class="k">def</span> <span class="nf">test_memory_warning_throttling_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that memory warnings can be displayed again after timeout.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

        <span class="c1"># Set last warning time to 31 seconds ago (past the 30-second threshold)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">31</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
                <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
                <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Should display warning since enough time has passed</span>
            <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_display_memory_warning_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the content and formatting of memory warnings.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="c1"># Test HIGH pressure warning</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
                <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
                <span class="s2">&quot;n-gram generation&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Should have called print with a Panel</span>
            <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Panel should have appropriate border style and content</span>
            <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span>
            <span class="k">assert</span> <span class="s2">&quot;Current usage: 3000.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;n-gram generation&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;Memory Pressure: HIGH&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>

            <span class="c1"># Reset mock for next test</span>
            <span class="n">mock_console_print</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
            <span class="c1"># Reset the throttling timestamp to allow second warning</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Test CRITICAL pressure warning</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
                <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">87.5</span><span class="p">},</span>
                <span class="s2">&quot;unique extraction&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span>
            <span class="k">assert</span> <span class="s2">&quot;Memory Pressure: CRITICAL&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;unique extraction&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_display_memory_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory summary display.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2500.0</span><span class="p">,</span>
            <span class="s2">&quot;peak_rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
            <span class="s2">&quot;available_mb&quot;</span><span class="p">:</span> <span class="mf">1500.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">display_memory_summary</span><span class="p">()</span>

            <span class="c1"># Should display summary panel</span>
            <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
            <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span>
            <span class="k">assert</span> <span class="s2">&quot;Peak memory usage: 3000.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;Final memory usage: 2500.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;Available memory: 1500.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="s2">&quot;Final pressure level: medium&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_garbage_collection_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test garbage collection effectiveness reporting.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">}</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">150.0</span>  <span class="c1"># Significant cleanup</span>
        <span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;gc test&quot;</span><span class="p">)</span>

            <span class="c1"># Should report significant memory cleanup</span>
            <span class="n">print_calls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">call</span><span class="p">)</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;Freed 150.0MB memory&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">print_calls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_no_gc_reporting_for_small_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that small GC cleanups are not reported to avoid noise.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">}</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">10.0</span>  <span class="c1"># Small cleanup</span>
        <span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;small gc test&quot;</span><span class="p">)</span>

            <span class="c1"># Should not report small cleanup</span>
            <span class="n">print_calls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">call</span><span class="p">)</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="s2">&quot;Freed&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="ow">and</span> <span class="s2">&quot;MB memory&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">print_calls</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_summary" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_display_memory_summary</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory summary display.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_display_memory_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory summary display.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2500.0</span><span class="p">,</span>
        <span class="s2">&quot;peak_rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
        <span class="s2">&quot;available_mb&quot;</span><span class="p">:</span> <span class="mf">1500.0</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">display_memory_summary</span><span class="p">()</span>

        <span class="c1"># Should display summary panel</span>
        <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;Peak memory usage: 3000.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Final memory usage: 2500.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Available memory: 1500.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Final pressure level: medium&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_display_memory_warning_content" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_display_memory_warning_content</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test the content and formatting of memory warnings.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_display_memory_warning_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the content and formatting of memory warnings.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="c1"># Test HIGH pressure warning</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
            <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
            <span class="s2">&quot;n-gram generation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Should have called print with a Panel</span>
        <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Panel should have appropriate border style and content</span>
        <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;Current usage: 3000.0MB&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;n-gram generation&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Memory Pressure: HIGH&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>

        <span class="c1"># Reset mock for next test</span>
        <span class="n">mock_console_print</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="c1"># Reset the throttling timestamp to allow second warning</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Test CRITICAL pressure warning</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
            <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">87.5</span><span class="p">},</span>
            <span class="s2">&quot;unique extraction&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">call_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;mock_console.print was not called with arguments&quot;</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">panel</span><span class="o">.</span><span class="n">border_style</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;Memory Pressure: CRITICAL&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;unique extraction&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">renderable</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_garbage_collection_reporting" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_garbage_collection_reporting</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test garbage collection effectiveness reporting.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_garbage_collection_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test garbage collection effectiveness reporting.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">}</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">150.0</span>  <span class="c1"># Significant cleanup</span>
    <span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;gc test&quot;</span><span class="p">)</span>

        <span class="c1"># Should report significant memory cleanup</span>
        <span class="n">print_calls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">call</span><span class="p">)</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;Freed 150.0MB memory&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">print_calls</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_with_memory_manager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_initialization_with_memory_manager</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test RichProgressManager initializes correctly with memory manager.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_initialization_with_memory_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test RichProgressManager initializes correctly with memory manager.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span>
        <span class="s2">&quot;Test Analysis&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">==</span> <span class="n">memory_manager</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">)</span>  <span class="c1"># Initialized to 0 when memory_manager provided</span>
    <span class="k">assert</span> <span class="s2">&quot;Test Analysis&quot;</span> <span class="ow">in</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">title</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_initialization_without_memory_manager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_initialization_without_memory_manager</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test RichProgressManager initializes correctly without memory manager.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_initialization_without_memory_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test RichProgressManager initializes correctly without memory manager.&quot;&quot;&quot;</span>
    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test Analysis&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">memory_manager</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="s2">&quot;Test Analysis&quot;</span> <span class="ow">in</span> <span class="n">progress_manager</span><span class="o">.</span><span class="n">title</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_warning_throttling</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that memory warnings are throttled to avoid spam.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_warning_throttling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory warnings are throttled to avoid spam.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Mock console to capture calls</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="c1"># First call should display warning</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
            <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
            <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">first_call_count</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_count</span>

        <span class="c1"># Immediate second call should be throttled (no additional warning)</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
            <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
            <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">second_call_count</span> <span class="o">=</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_count</span>

        <span class="c1"># Should be the same (no new warning)</span>
        <span class="k">assert</span> <span class="n">second_call_count</span> <span class="o">==</span> <span class="n">first_call_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_memory_warning_throttling_timeout" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_warning_throttling_timeout</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that memory warnings can be displayed again after timeout.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_warning_throttling_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that memory warnings can be displayed again after timeout.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>

    <span class="c1"># Set last warning time to 31 seconds ago (past the 30-second threshold)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">last_memory_warning</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">31</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">_display_memory_warning</span><span class="p">(</span>
            <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">},</span>
            <span class="s2">&quot;test context&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Should display warning since enough time has passed</span>
        <span class="n">mock_console_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_no_gc_reporting_for_small_cleanup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_no_gc_reporting_for_small_cleanup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that small GC cleanups are not reported to avoid noise.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_no_gc_reporting_for_small_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that small GC cleanups are not reported to avoid noise.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">}</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">10.0</span>  <span class="c1"># Small cleanup</span>
    <span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_console_print</span><span class="p">:</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;small gc test&quot;</span><span class="p">)</span>

        <span class="c1"># Should not report small cleanup</span>
        <span class="n">print_calls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">call</span><span class="p">)</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">mock_console_print</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="s2">&quot;Freed&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="ow">and</span> <span class="s2">&quot;MB memory&quot;</span> <span class="ow">in</span> <span class="n">call</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">print_calls</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_critical_pressure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_update_step_with_memory_critical_pressure</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory-aware step updates with critical memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_update_step_with_memory_critical_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with critical memory pressure.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3500.0</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">87.5</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Mock _display_memory_warning to capture calls</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">progress_manager</span><span class="p">,</span> <span class="s2">&quot;_display_memory_warning&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_warning</span><span class="p">:</span>

        <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;critical test&quot;</span><span class="p">)</span>

        <span class="c1"># Should display warning for critical pressure</span>
        <span class="n">mock_warning</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

        <span class="c1"># Verify it was called with critical pressure level</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="n">mock_warning</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_high_pressure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_update_step_with_memory_high_pressure</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory-aware step updates with high memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_update_step_with_memory_high_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with high memory pressure.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Mock console printing to avoid actual output during tests</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">):</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span>
            <span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="s2">&quot;high pressure test&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Verify GC was triggered</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryFeatures.test_update_step_with_memory_low_pressure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_update_step_with_memory_low_pressure</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory-aware step updates with low memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_update_step_with_memory_low_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory-aware step updates with low memory pressure.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">12.5</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">)</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Should update normally without warnings</span>
    <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="s2">&quot;test_step&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">)</span>

    <span class="c1"># Verify memory stats were retrieved</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

    <span class="c1"># No GC should be triggered for low pressure</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestRichProgressManagerMemoryIntegration</code>


</h4>


    <div class="doc doc-contents ">


        <p>Integration tests for RichProgressManager memory features.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestRichProgressManagerMemoryIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests for RichProgressManager memory features.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_full_analysis_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate a full analysis workflow with memory monitoring.&quot;&quot;&quot;</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>

        <span class="c1"># Simulate increasing memory pressure during analysis</span>
        <span class="n">memory_states</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">12.5</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">1500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">37.5</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2500.0</span><span class="p">,</span>
                <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">62.5</span><span class="p">,</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3200.0</span><span class="p">,</span>
                <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">80.0</span><span class="p">,</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2800.0</span><span class="p">,</span>
                <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
            <span class="p">},</span>  <span class="c1"># After cleanup</span>
        <span class="p">]</span>

        <span class="c1"># Add one more state for the final summary call</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">memory_states</span> <span class="o">+</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2800.0</span><span class="p">,</span>
                <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
            <span class="p">}</span>  <span class="c1"># Final state for summary</span>
        <span class="p">]</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">400.0</span><span class="p">}</span>

        <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span>
            <span class="s2">&quot;Simulated Analysis&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span>
        <span class="p">)</span>

        <span class="c1"># Add analysis steps</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;preprocess&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;ngrams&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_unique&quot;</span><span class="p">,</span> <span class="s2">&quot;write_output&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">):</span>
            <span class="c1"># Simulate step execution with memory monitoring</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">start_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2"> processing&quot;</span><span class="p">)</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">complete_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

            <span class="c1"># Display final summary</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">display_memory_summary</span><span class="p">()</span>

        <span class="c1"># Verify all memory monitoring calls were made</span>
        <span class="c1"># 5 calls for steps + 1 call for final summary = 6 total calls</span>
        <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Only when triggered</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_memory_aware_progress.TestRichProgressManagerMemoryIntegration.test_full_analysis_simulation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_full_analysis_simulation</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Simulate a full analysis workflow with memory monitoring.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_aware_progress.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_full_analysis_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate a full analysis workflow with memory monitoring.&quot;&quot;&quot;</span>
    <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">MemoryManager</span><span class="p">)</span>

    <span class="c1"># Simulate increasing memory pressure during analysis</span>
    <span class="n">memory_states</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">12.5</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">1500.0</span><span class="p">,</span> <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">37.5</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2500.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">62.5</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">3200.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">80.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2800.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="p">},</span>  <span class="c1"># After cleanup</span>
    <span class="p">]</span>

    <span class="c1"># Add one more state for the final summary call</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">memory_states</span> <span class="o">+</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mf">2800.0</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="p">}</span>  <span class="c1"># Final state for summary</span>
    <span class="p">]</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="mf">400.0</span><span class="p">}</span>

    <span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span>
        <span class="s2">&quot;Simulated Analysis&quot;</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span>
    <span class="p">)</span>

    <span class="c1"># Add analysis steps</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;preprocess&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;ngrams&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_unique&quot;</span><span class="p">,</span> <span class="s2">&quot;write_output&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;rich.console.Console.print&quot;</span><span class="p">):</span>
        <span class="c1"># Simulate step execution with memory monitoring</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">start_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_step_with_memory</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2"> processing&quot;</span><span class="p">)</span>
            <span class="n">progress_manager</span><span class="o">.</span><span class="n">complete_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

        <span class="c1"># Display final summary</span>
        <span class="n">progress_manager</span><span class="o">.</span><span class="n">display_memory_summary</span><span class="p">()</span>

    <span class="c1"># Verify all memory monitoring calls were made</span>
    <span class="c1"># 5 calls for steps + 1 call for final summary = 6 total calls</span>
    <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Only when triggered</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="app.test_memory_manager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_memory_manager</code>


</h3>

    <div class="doc doc-contents ">

        <p>Comprehensive tests for the MemoryManager class and memory-aware processing.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.test_memory_manager.TestMemoryManager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestMemoryManager</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test core MemoryManager functionality.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_memory_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestMemoryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test core MemoryManager functionality.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_manager_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test MemoryManager initializes correctly.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">process_name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">==</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">process_name</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span> <span class="o">==</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">test_get_current_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory usage statistics collection.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Check all required fields are present</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;rss_bytes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vms_bytes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vms_mb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rss_gb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;system_available_gb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;system_used_percent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">stats</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>

        <span class="c1"># Check memory history is updated</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;rss_bytes&quot;</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_memory_pressure_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory pressure level detection.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Small limit for testing</span>

        <span class="c1"># Mock different memory usage levels</span>
        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
            <span class="c1"># Test LOW pressure (40% usage)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

            <span class="c1"># Test MEDIUM pressure (75% usage - safely above 70% threshold)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>

            <span class="c1"># Test HIGH pressure (85% usage - safely above 80% threshold)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">85</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>

            <span class="c1"># Test CRITICAL pressure (95% usage - safely above 90% threshold)</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">95</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>

    <span class="k">def</span> <span class="nf">test_adaptive_chunk_sizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test adaptive chunk size calculation based on memory pressure.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">base_size</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
            <span class="c1"># Test LOW pressure - no reduction</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="n">base_size</span>

            <span class="c1"># Test MEDIUM pressure - 30% reduction</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>

            <span class="c1"># Test HIGH pressure - 60% reduction</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>

            <span class="c1"># Test CRITICAL pressure - 80% reduction</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_operation_specific_chunk_sizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test operation-specific chunk size adjustments.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">base_size</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

            <span class="c1"># Test different operation types</span>
            <span class="n">tokenization_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
            <span class="p">)</span>
            <span class="n">ngram_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
            <span class="p">)</span>
            <span class="n">unique_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span>
            <span class="p">)</span>

            <span class="c1"># N-gram generation should be smaller (more memory intensive)</span>
            <span class="k">assert</span> <span class="n">ngram_size</span> <span class="o">&lt;</span> <span class="n">tokenization_size</span>
            <span class="c1"># Unique extraction should be larger (less memory intensive)</span>
            <span class="k">assert</span> <span class="n">unique_size</span> <span class="o">&gt;</span> <span class="n">tokenization_size</span>

    <span class="k">def</span> <span class="nf">test_minimum_chunk_size_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that minimum chunk size is enforced.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">small_base</span> <span class="o">=</span> <span class="mi">5000</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
            <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>

            <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">small_base</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">)</span>

            <span class="c1"># Should not go below minimum (max of 1000 or base_size // 10)</span>
            <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">small_base</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>

    <span class="k">def</span> <span class="nf">test_gc_trigger_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test garbage collection trigger logic.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
            <span class="c1"># Below threshold - should not trigger</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="p">()</span>

            <span class="c1"># Above threshold - should trigger</span>
            <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_enhanced_gc_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test enhanced garbage collection functionality.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;app.utils.MemoryManager.get_current_memory_usage&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_usage</span><span class="p">:</span>
            <span class="c1"># Mock memory before and after cleanup</span>
            <span class="n">mock_usage</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">},</span>  <span class="c1"># Before</span>
                <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">},</span>  <span class="c1"># After</span>
            <span class="p">]</span>

            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;gc.collect&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_gc</span><span class="p">:</span>
                <span class="n">mock_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Some objects collected</span>

                <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>

                <span class="k">assert</span> <span class="s2">&quot;memory_freed_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
                <span class="k">assert</span> <span class="s2">&quot;memory_before_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
                <span class="k">assert</span> <span class="s2">&quot;memory_after_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
                <span class="k">assert</span> <span class="s2">&quot;pressure_before&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
                <span class="k">assert</span> <span class="s2">&quot;pressure_after&quot;</span> <span class="ow">in</span> <span class="n">stats</span>

                <span class="k">assert</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span>  <span class="c1"># 1000 - 800</span>
                <span class="k">assert</span> <span class="n">mock_gc</span><span class="o">.</span><span class="n">call_count</span> <span class="o">&gt;=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">test_memory_trend_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory usage trend analysis.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

        <span class="c1"># Not enough data</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;insufficient_data&quot;</span>

        <span class="c1"># Add some increasing memory usage data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                    <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Increasing</span>
                    <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;increasing&quot;</span>

        <span class="c1"># Add decreasing data</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                    <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1500</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Decreasing</span>
                    <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;decreasing&quot;</span>

        <span class="c1"># Add stable data</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                    <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">50</span><span class="p">),</span>  <span class="c1"># Fluctuating</span>
                    <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;stable&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_history_size_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory history size is properly limited.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">max_history_size</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Small limit for testing</span>

        <span class="c1"># Add more entries than the limit</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Should not exceed the limit</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_history_size</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_adaptive_chunk_sizing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_adaptive_chunk_sizing</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test adaptive chunk size calculation based on memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_adaptive_chunk_sizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test adaptive chunk size calculation based on memory pressure.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">base_size</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
        <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
        <span class="c1"># Test LOW pressure - no reduction</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="n">base_size</span>

        <span class="c1"># Test MEDIUM pressure - 30% reduction</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>

        <span class="c1"># Test HIGH pressure - 60% reduction</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>

        <span class="c1"># Test CRITICAL pressure - 80% reduction</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_size</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_enhanced_gc_cleanup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_enhanced_gc_cleanup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test enhanced garbage collection functionality.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_enhanced_gc_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test enhanced garbage collection functionality.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;app.utils.MemoryManager.get_current_memory_usage&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_usage</span><span class="p">:</span>
        <span class="c1"># Mock memory before and after cleanup</span>
        <span class="n">mock_usage</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">},</span>  <span class="c1"># Before</span>
            <span class="p">{</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">},</span>  <span class="c1"># After</span>
        <span class="p">]</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;gc.collect&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_gc</span><span class="p">:</span>
            <span class="n">mock_gc</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Some objects collected</span>

            <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>

            <span class="k">assert</span> <span class="s2">&quot;memory_freed_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
            <span class="k">assert</span> <span class="s2">&quot;memory_before_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
            <span class="k">assert</span> <span class="s2">&quot;memory_after_mb&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
            <span class="k">assert</span> <span class="s2">&quot;pressure_before&quot;</span> <span class="ow">in</span> <span class="n">stats</span>
            <span class="k">assert</span> <span class="s2">&quot;pressure_after&quot;</span> <span class="ow">in</span> <span class="n">stats</span>

            <span class="k">assert</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span>  <span class="c1"># 1000 - 800</span>
            <span class="k">assert</span> <span class="n">mock_gc</span><span class="o">.</span><span class="n">call_count</span> <span class="o">&gt;=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_gc_trigger_threshold" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_gc_trigger_threshold</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test garbage collection trigger logic.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_gc_trigger_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test garbage collection trigger logic.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
        <span class="c1"># Below threshold - should not trigger</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="p">()</span>

        <span class="c1"># Above threshold - should trigger</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">should_trigger_gc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_get_current_memory_usage" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_get_current_memory_usage</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory usage statistics collection.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_get_current_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory usage statistics collection.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

    <span class="c1"># Check all required fields are present</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;rss_bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vms_bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vms_mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rss_gb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_available_gb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_used_percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">stats</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>

    <span class="c1"># Check memory history is updated</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;rss_bytes&quot;</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_memory_history_size_limit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_history_size_limit</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory history size is properly limited.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_history_size_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory history size is properly limited.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">max_history_size</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Small limit for testing</span>

    <span class="c1"># Add more entries than the limit</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

    <span class="c1"># Should not exceed the limit</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_history_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_memory_manager_initialization" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_manager_initialization</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test MemoryManager initializes correctly.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_manager_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test MemoryManager initializes correctly.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">process_name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">==</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">process_name</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span> <span class="o">==</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_memory_pressure_levels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_pressure_levels</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory pressure level detection.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_pressure_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory pressure level detection.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Small limit for testing</span>

    <span class="c1"># Mock different memory usage levels</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;memory_info&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_memory</span><span class="p">:</span>
        <span class="c1"># Test LOW pressure (40% usage)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

        <span class="c1"># Test MEDIUM pressure (75% usage - safely above 70% threshold)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>

        <span class="c1"># Test HIGH pressure (85% usage - safely above 80% threshold)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">85</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>

        <span class="c1"># Test CRITICAL pressure (95% usage - safely above 90% threshold)</span>
        <span class="n">mock_memory</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">*</span> <span class="mi">95</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_memory_trend_analysis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_trend_analysis</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test memory usage trend analysis.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_trend_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test memory usage trend analysis.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>

    <span class="c1"># Not enough data</span>
    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;insufficient_data&quot;</span>

    <span class="c1"># Add some increasing memory usage data</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Increasing</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;increasing&quot;</span>

    <span class="c1"># Add decreasing data</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1500</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Decreasing</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;decreasing&quot;</span>

    <span class="c1"># Add stable data</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">50</span><span class="p">),</span>  <span class="c1"># Fluctuating</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;stable&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_minimum_chunk_size_enforcement" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_minimum_chunk_size_enforcement</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that minimum chunk size is enforced.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_minimum_chunk_size_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that minimum chunk size is enforced.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">small_base</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
        <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">small_base</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span><span class="p">)</span>

        <span class="c1"># Should not go below minimum (max of 1000 or base_size // 10)</span>
        <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">small_base</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManager.test_operation_specific_chunk_sizing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_operation_specific_chunk_sizing</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test operation-specific chunk size adjustments.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_operation_specific_chunk_sizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test operation-specific chunk size adjustments.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">()</span>
    <span class="n">base_size</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span>
        <span class="s2">&quot;app.utils.MemoryManager.get_memory_pressure_level&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">mock_pressure</span><span class="p">:</span>
        <span class="n">mock_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

        <span class="c1"># Test different operation types</span>
        <span class="n">tokenization_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
        <span class="p">)</span>
        <span class="n">ngram_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;ngram_generation&quot;</span>
        <span class="p">)</span>
        <span class="n">unique_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
            <span class="n">base_size</span><span class="p">,</span> <span class="s2">&quot;unique_extraction&quot;</span>
        <span class="p">)</span>

        <span class="c1"># N-gram generation should be smaller (more memory intensive)</span>
        <span class="k">assert</span> <span class="n">ngram_size</span> <span class="o">&lt;</span> <span class="n">tokenization_size</span>
        <span class="c1"># Unique extraction should be larger (less memory intensive)</span>
        <span class="k">assert</span> <span class="n">unique_size</span> <span class="o">&gt;</span> <span class="n">tokenization_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_memory_manager.TestMemoryManagerIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestMemoryManagerIntegration</code>


</h4>


    <div class="doc doc-contents ">


        <p>Integration tests for MemoryManager with other components.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_memory_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestMemoryManagerIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests for MemoryManager with other components.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_memory_manager_with_real_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test MemoryManager with actual memory operations.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>  <span class="c1"># Reasonable limit</span>

        <span class="c1"># Get baseline</span>
        <span class="n">initial_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">initial_stats</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]</span>

        <span class="c1"># Perform some memory-intensive operations</span>
        <span class="n">large_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>

        <span class="c1"># Check memory increased</span>
        <span class="n">after_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">after_stats</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">initial_stats</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span>

        <span class="c1"># Cleanup and verify GC works</span>
        <span class="k">del</span> <span class="n">large_data</span>
        <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>

        <span class="c1"># Should have freed some memory</span>
        <span class="k">assert</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>

        <span class="c1"># Verify trend analysis works with real data</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">trend</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;insufficient_data&quot;</span><span class="p">,</span> <span class="s2">&quot;increasing&quot;</span><span class="p">,</span> <span class="s2">&quot;decreasing&quot;</span><span class="p">,</span> <span class="s2">&quot;stable&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_adaptive_chunk_sizing_realistic_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test adaptive chunk sizing with realistic scenarios.&quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>

        <span class="c1"># Test various operation types with different base sizes</span>
        <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;tokenization&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unique_extraction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;join_operations&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">base_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">base_size</span> <span class="ow">in</span> <span class="n">base_sizes</span><span class="p">:</span>
                <span class="n">adaptive_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                    <span class="n">base_size</span><span class="p">,</span> <span class="n">operation</span>
                <span class="p">)</span>

                <span class="c1"># Should never be zero or negative</span>
                <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;</span> <span class="mi">0</span>

                <span class="c1"># Should respect minimum size</span>
                <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>

                <span class="c1"># Should not exceed original size (except for unique_extraction which can be larger)</span>
                <span class="k">if</span> <span class="n">operation</span> <span class="o">!=</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&lt;=</span> <span class="n">base_size</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManagerIntegration.test_adaptive_chunk_sizing_realistic_scenarios" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_adaptive_chunk_sizing_realistic_scenarios</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test adaptive chunk sizing with realistic scenarios.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_adaptive_chunk_sizing_realistic_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test adaptive chunk sizing with realistic scenarios.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>

    <span class="c1"># Test various operation types with different base sizes</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;tokenization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ngram_generation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;unique_extraction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;join_operations&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">base_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">base_size</span> <span class="ow">in</span> <span class="n">base_sizes</span><span class="p">:</span>
            <span class="n">adaptive_size</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                <span class="n">base_size</span><span class="p">,</span> <span class="n">operation</span>
            <span class="p">)</span>

            <span class="c1"># Should never be zero or negative</span>
            <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;</span> <span class="mi">0</span>

            <span class="c1"># Should respect minimum size</span>
            <span class="n">expected_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&gt;=</span> <span class="n">expected_min</span>

            <span class="c1"># Should not exceed original size (except for unique_extraction which can be larger)</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="o">!=</span> <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">adaptive_size</span> <span class="o">&lt;=</span> <span class="n">base_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_memory_manager.TestMemoryManagerIntegration.test_memory_manager_with_real_operations" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_memory_manager_with_real_operations</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test MemoryManager with actual memory operations.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_memory_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_memory_manager_with_real_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test MemoryManager with actual memory operations.&quot;&quot;&quot;</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>  <span class="c1"># Reasonable limit</span>

    <span class="c1"># Get baseline</span>
    <span class="n">initial_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">initial_stats</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]</span>

    <span class="c1"># Perform some memory-intensive operations</span>
    <span class="n">large_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>

    <span class="c1"># Check memory increased</span>
    <span class="n">after_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">after_stats</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">initial_stats</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span>

    <span class="c1"># Cleanup and verify GC works</span>
    <span class="k">del</span> <span class="n">large_data</span>
    <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>

    <span class="c1"># Should have freed some memory</span>
    <span class="k">assert</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="c1"># Verify trend analysis works with real data</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_memory_trend</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">trend</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;insufficient_data&quot;</span><span class="p">,</span> <span class="s2">&quot;increasing&quot;</span><span class="p">,</span> <span class="s2">&quot;decreasing&quot;</span><span class="p">,</span> <span class="s2">&quot;stable&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="app.test_utils" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>test_utils</code>


</h3>

    <div class="doc doc-contents ">

        <p>Tests for app/utils.py tokenization engine.</p>
<p>This test suite validates:
- Space-separated vs non-space-separated text detection
- Social media entity preservation
- Mixed script handling
- Edge cases and error conditions
- Performance with various text types</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.test_utils.TestIsSpaceSeparated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestIsSpaceSeparated</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test the is_space_separated function for various script types.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestIsSpaceSeparated</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the is_space_separated function for various script types.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_latin_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Latin script text is detected as space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello world this is English text&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_cyrillic_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Cyrillic script text is detected as space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Привет мир это русский текст&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_arabic_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Arabic script text is detected as space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;مرحبا بالعالم هذا نص عربي&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_chinese_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Chinese script text is detected as non-space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;你好世界这是中文文本&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">test_japanese_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Japanese script text is detected as non-space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;こんにちは世界これは日本語のテキストです&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">test_thai_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Thai script text is detected as non-space-separated.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;สวัสดีโลกนี่คือข้อความไทย&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">test_mixed_scripts_majority_latin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test mixed scripts with majority Latin characters.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello 你好 world this is mostly English&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_mixed_scripts_majority_chinese</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test mixed scripts with majority Chinese characters.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;iPhone用户可以使用这个应用程序在手机上&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">test_empty_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test empty text defaults to space-separated.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_no_script_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test text with no specific script characters.&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;123 456 !@# $%^&quot;</span>
        <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">test_polars_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test is_space_separated works with polars expressions.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="s2">&quot;你好世界&quot;</span><span class="p">,</span> <span class="s2">&quot;Привет мир&quot;</span><span class="p">,</span> <span class="s2">&quot;こんにちは&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
            <span class="p">[</span><span class="n">is_space_separated</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;is_space_sep&quot;</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;is_space_sep&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_arabic_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_arabic_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Arabic script text is detected as space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_arabic_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Arabic script text is detected as space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;مرحبا بالعالم هذا نص عربي&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_chinese_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chinese_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Chinese script text is detected as non-space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chinese_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Chinese script text is detected as non-space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;你好世界这是中文文本&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_cyrillic_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_cyrillic_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Cyrillic script text is detected as space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_cyrillic_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Cyrillic script text is detected as space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Привет мир это русский текст&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_empty_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_empty_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test empty text defaults to space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_empty_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test empty text defaults to space-separated.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_japanese_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_japanese_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Japanese script text is detected as non-space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_japanese_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Japanese script text is detected as non-space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;こんにちは世界これは日本語のテキストです&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_latin_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_latin_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Latin script text is detected as space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_latin_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Latin script text is detected as space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello world this is English text&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_chinese" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_mixed_scripts_majority_chinese</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test mixed scripts with majority Chinese characters.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_mixed_scripts_majority_chinese</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test mixed scripts with majority Chinese characters.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;iPhone用户可以使用这个应用程序在手机上&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_mixed_scripts_majority_latin" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_mixed_scripts_majority_latin</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test mixed scripts with majority Latin characters.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_mixed_scripts_majority_latin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test mixed scripts with majority Latin characters.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello 你好 world this is mostly English&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_no_script_characters" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_no_script_characters</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test text with no specific script characters.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_no_script_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test text with no specific script characters.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;123 456 !@# $%^&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_polars_expression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_polars_expression</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test is_space_separated works with polars expressions.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_polars_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test is_space_separated works with polars expressions.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="s2">&quot;你好世界&quot;</span><span class="p">,</span> <span class="s2">&quot;Привет мир&quot;</span><span class="p">,</span> <span class="s2">&quot;こんにちは&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]}</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="p">[</span><span class="n">is_space_separated</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;is_space_sep&quot;</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;is_space_sep&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestIsSpaceSeparated.test_thai_script" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_thai_script</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Thai script text is detected as non-space-separated.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_thai_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Thai script text is detected as non-space-separated.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;สวัสดีโลกนี่คือข้อความไทย&quot;</span>
    <span class="k">assert</span> <span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_utils.TestTokenizationIntegration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestTokenizationIntegration</code>


</h4>


    <div class="doc doc-contents ">


        <p>Integration tests for tokenization engine with n-gram analysis.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestTokenizationIntegration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration tests for tokenization engine with n-gram analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_tokenization_with_ngram_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that tokenization works well with n-gram generation.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;This is a test message&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Check out @user and https://example.com&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Mixed text with 中文 content&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="c1"># Apply tokenization</span>
        <span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Verify all messages were tokenized</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>

        <span class="c1"># Verify social media entities are preserved</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;@user&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;https://example.com&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_empty_message_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of datasets with empty messages.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Valid message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="s2">&quot;Another valid message&quot;</span><span class="p">],</span>
                <span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Should handle empty messages gracefully</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Valid message</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Empty message</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Whitespace-only message</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Valid message</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizationIntegration.test_empty_message_handling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_empty_message_handling</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test handling of datasets with empty messages.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_empty_message_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test handling of datasets with empty messages.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Valid message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="s2">&quot;Another valid message&quot;</span><span class="p">],</span>
            <span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Should handle empty messages gracefully</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Valid message</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Empty message</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Whitespace-only message</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Valid message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizationIntegration.test_tokenization_with_ngram_pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_tokenization_with_ngram_pipeline</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that tokenization works well with n-gram generation.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_tokenization_with_ngram_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that tokenization works well with n-gram generation.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;message_text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;This is a test message&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Check out @user and https://example.com&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Mixed text with 中文 content&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;message_surrogate_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="c1"># Apply tokenization</span>
    <span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;message_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Verify all messages were tokenized</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>

    <span class="c1"># Verify social media entities are preserved</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">tokenized</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;@user&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;https://example.com&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="app.test_utils.TestTokenizeText" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TestTokenizeText</code>


</h4>


    <div class="doc doc-contents ">


        <p>Test the tokenize_text function for various text types and edge cases.</p>







              <details class="quote">
                <summary>Source code in <code>app/test_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TestTokenizeText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the tokenize_text function for various text types and edge cases.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_simple_english_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test basic English text tokenization.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello world this is a test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_social_media_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test preservation of social media entities.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Check out https://example.com and @username #hashtag&quot;</span><span class="p">]}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># URLs, mentions, and hashtags should be preserved as-is</span>
        <span class="k">assert</span> <span class="s2">&quot;https://example.com&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;@username&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;#hashtag&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;and&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_chinese_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Chinese text character-level tokenization.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;这是中文测试&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Chinese text should be split into individual characters</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;这&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;中&quot;</span><span class="p">,</span> <span class="s2">&quot;文&quot;</span><span class="p">,</span> <span class="s2">&quot;测&quot;</span><span class="p">,</span> <span class="s2">&quot;试&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_chinese_text_with_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Chinese text with spaces (should still split into characters).&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;你好 世界 这是 中文&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Should split into individual characters, not space-separated words</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;你&quot;</span><span class="p">,</span> <span class="s2">&quot;好&quot;</span><span class="p">,</span> <span class="s2">&quot;世&quot;</span><span class="p">,</span> <span class="s2">&quot;界&quot;</span><span class="p">,</span> <span class="s2">&quot;这&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;中&quot;</span><span class="p">,</span> <span class="s2">&quot;文&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_url_with_cjk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test URL preservation with surrounding CJK characters.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;访问https://example.com网站&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># URL should be preserved, CJK characters should be split individually</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;访&quot;</span><span class="p">,</span> <span class="s2">&quot;问&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;网&quot;</span><span class="p">,</span> <span class="s2">&quot;站&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_mixed_script_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test mixed script text handling.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;iPhone用户 can use this app&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Should contain both the mixed token and separate words</span>
        <span class="k">assert</span> <span class="s2">&quot;iphone用户&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>  <span class="c1"># Mixed script token (lowercased)</span>
        <span class="k">assert</span> <span class="s2">&quot;can&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;use&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;this&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;app&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_whitespace_normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that multiple whitespace is normalized.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello    world</span><span class="se">\t\t</span><span class="s2">test</span><span class="se">\n\n</span><span class="s2">more   spaces&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;more&quot;</span><span class="p">,</span> <span class="s2">&quot;spaces&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_empty_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of empty text.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\n</span><span class="s2">&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># All should result in empty token lists</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">test_punctuation_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of punctuation.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello, world! How are you?&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Punctuation should be included with words (except for social media entities)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello,&quot;</span><span class="p">,</span> <span class="s2">&quot;world!&quot;</span><span class="p">,</span> <span class="s2">&quot;how&quot;</span><span class="p">,</span> <span class="s2">&quot;are&quot;</span><span class="p">,</span> <span class="s2">&quot;you?&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_case_preservation_for_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that URLs preserve their case.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Visit HTTPS://Example.COM/Path today&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">assert</span> <span class="s2">&quot;HTTPS://Example.COM/Path&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;visit&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;today&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_multiple_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test tokenization of multiple messages.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;First message here&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Second message with @mention&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Third message 你好世界&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;here&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;@mention&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="c1"># CJK characters should be split individually for consistency</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;你&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
        <span class="k">assert</span> <span class="s2">&quot;好&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
        <span class="k">assert</span> <span class="s2">&quot;世&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
        <span class="k">assert</span> <span class="s2">&quot;界&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>

    <span class="k">def</span> <span class="nf">test_invalid_input_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test error handling for invalid input types.&quot;&quot;&quot;</span>
        <span class="c1"># Non-LazyFrame input</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Expected polars LazyFrame&quot;</span><span class="p">):</span>
            <span class="n">tokenize_text</span><span class="p">(</span><span class="s2">&quot;not a dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>

        <span class="c1"># Non-string column name</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;text_column must be a string&quot;</span><span class="p">):</span>
            <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_nonexistent_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test error handling for nonexistent column.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;other_col&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="c1"># This should raise an error when the lazy frame is executed</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>  <span class="c1"># Will be a polars error about missing column</span>
            <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;nonexistent_column&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_special_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of various special characters.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Text with émojis 😀 and àccénts café naïve&quot;</span><span class="p">]}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Should handle accented characters properly</span>
        <span class="k">assert</span> <span class="s2">&quot;émojis&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;😀&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;àccénts&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;café&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;naïve&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_performance_with_large_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test tokenization performance with larger text.&quot;&quot;&quot;</span>
        <span class="n">large_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;word&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">large_text</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1000</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">token</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_social_media_entity_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test various social media entity formats.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Check http://short.ly and https://secure.example.com/path?query=123 plus @user_name and #CamelCaseTag&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># All URL formats should be preserved</span>
        <span class="k">assert</span> <span class="s2">&quot;http://short.ly&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;https://secure.example.com/path?query=123&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;@user_name&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;#CamelCaseTag&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_pure_punctuation_filtering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that pure punctuation tokens are filtered out.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;!!! ... ,,, ??? ::: ;;;&quot;</span><span class="p">,</span>  <span class="c1"># Pure punctuation only</span>
                    <span class="s2">&quot;Hello!!! World... Test,,,&quot;</span><span class="p">,</span>  <span class="c1"># Mixed content</span>
                    <span class="s2">&quot;。。。 ！！！ ？？？&quot;</span><span class="p">,</span>  <span class="c1"># CJK punctuation</span>
                    <span class="s2">&quot;((())) [[[]]] {{</span><span class="si">{}</span><span class="s2">}}&quot;</span><span class="p">,</span>  <span class="c1"># Brackets and braces</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># First row: pure punctuation should be filtered to empty list</span>
        <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">tokens_0</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected empty tokens for pure punctuation, got: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Second row: mixed content should preserve words but filter pure punctuation</span>
        <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="c1"># Should contain words but not pure punctuation sequences</span>
        <span class="n">word_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected words to be preserved, got: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Third row: CJK punctuation should also be filtered</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">tokens_2</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected CJK punctuation to be filtered, got: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Fourth row: brackets and braces should be filtered</span>
        <span class="n">tokens_3</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">tokens_3</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected brackets/braces to be filtered, got: </span><span class="si">{</span><span class="n">tokens_3</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_punctuation_edge_cases_preserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that legitimate tokens with punctuation are preserved.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Visit https://example.com/path?query=test&amp;param=1 today&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Contact @user123 and check #hashtag!&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Words like don&#39;t, can&#39;t, won&#39;t should work&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Email test@example.com or visit sub.domain.com&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># URLs with punctuation should be preserved</span>
        <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;https://example.com/path?query=test&amp;param=1&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>

        <span class="c1"># Social media entities should be preserved</span>
        <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;@user123&quot;</span> <span class="ow">in</span> <span class="n">tokens_1</span>
        <span class="k">assert</span> <span class="s2">&quot;#hashtag&quot;</span> <span class="ow">in</span> <span class="n">tokens_1</span>

        <span class="c1"># Contractions should be preserved</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">contraction_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">contraction_found</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected contractions to be preserved, got: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Email-like patterns should work (even if not in URL pattern)</span>
        <span class="n">tokens_3</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">email_or_domain_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_3</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">email_or_domain_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected domain/email patterns, got: </span><span class="si">{</span><span class="n">tokens_3</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_punctuation_with_multilingual_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test punctuation filtering with various languages.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;English... 中文。。。 한국어!!! русский???&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Mixed iPhone用户!!! can use this.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;URL https://例え.com/パス works fine.&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Should preserve language text but filter pure punctuation</span>
        <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">has_text</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">has_text</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected multilingual text to be preserved, got: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Mixed script tokens should be preserved</span>
        <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
            <span class="s2">&quot;iphone&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Mixed script not found: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># International domain names: protocol should be preserved, but non-ASCII parts will be tokenized separately</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">https_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;https:&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
        <span class="n">japanese_chars_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">https_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;HTTPS protocol not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">japanese_chars_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Japanese characters not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_ngram_punctuation_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that n-gram analysis won&#39;t generate pure punctuation n-grams.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Normal text with... excessive punctuation!!! And more???&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;!!! ... ,,, !!! ... ,,,&quot;</span><span class="p">,</span>  <span class="c1"># Pattern that previously generated bad n-grams</span>
                    <span class="s2">&quot;Good content. Bad punctuation!!!&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Collect all tokens and ensure no pure punctuation tokens exist</span>
        <span class="n">all_tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token_list</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
            <span class="n">all_tokens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">token_list</span><span class="p">)</span>

        <span class="c1"># No token should be pure punctuation</span>
        <span class="n">pure_punctuation_tokens</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">token</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">all_tokens</span>
            <span class="k">if</span> <span class="n">token</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">))</span>  <span class="c1"># Exclude legitimate patterns</span>
        <span class="p">]</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">pure_punctuation_tokens</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Found pure punctuation tokens: </span><span class="si">{</span><span class="n">pure_punctuation_tokens</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Should still have legitimate content</span>
        <span class="n">content_tokens</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">all_tokens</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">content_tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">),</span> <span class="s2">&quot;No content tokens found - over-filtering occurred&quot;</span>

    <span class="k">def</span> <span class="nf">test_complex_urls_with_punctuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test complex URLs with various punctuation marks are preserved.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Check https://example.com/path?query=1&amp;param=test#anchor and http://sub.domain.co.uk/&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Complex URLs should be preserved exactly</span>
        <span class="k">assert</span> <span class="s2">&quot;https://example.com/path?query=1&amp;param=test#anchor&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;http://sub.domain.co.uk/&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;and&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">test_symbol_filtering_specificity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that only problematic symbols are filtered, not meaningful ones.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Math symbols === +++ --- should be filtered&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;But emojis 😀😎🎉 should be preserved&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Currency symbols $100 €50 should be filtered&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Math symbols should be filtered</span>
        <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">math_symbols_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">token</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;===&quot;</span><span class="p">,</span> <span class="s2">&quot;+++&quot;</span><span class="p">,</span> <span class="s2">&quot;---&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">math_symbols_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Math symbols not filtered: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;math&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>
        <span class="k">assert</span> <span class="s2">&quot;symbols&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>

        <span class="c1"># Emojis should be preserved</span>
        <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">emoji_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">emoji_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Emojis not preserved: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Currency symbols should be filtered, numbers preserved as individual digits</span>
        <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">currency_symbols_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">token</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;€&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">currency_symbols_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Currency symbols not filtered: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Numbers may be tokenized as individual digits or groups</span>
        <span class="n">has_numbers</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">has_numbers</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Numbers not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_real_world_social_media_example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test realistic social media content with mixed punctuation.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;OMG!!! Check this out: https://tinyurl.com/demo @everyone #viral #trending... So cool!!!&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Should preserve content but filter pure punctuation</span>
        <span class="k">assert</span> <span class="s2">&quot;https://tinyurl.com/demo&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;@everyone&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;#viral&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="s2">&quot;#trending&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;omg&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;cool&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_comprehensive_punctuation_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test various Unicode punctuation categories are properly filtered.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Brackets: ()[]</span><span class="si">{}</span><span class="s2">  Quotes: </span><span class="se">\&quot;</span><span class="s2">&#39;`  Dashes: -–—  Math: +=*÷&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;CJK punct: 。！？，：；  Symbols: @#$%^&amp;*  Mixed: word!!! ...word&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># First row: various punctuation types</span>
        <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">content_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
        <span class="c1"># Words may include attached punctuation (like &quot;brackets:&quot;)</span>
        <span class="n">word_stems</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">content_words</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;brackets&quot;</span> <span class="ow">in</span> <span class="n">word_stems</span>
        <span class="k">assert</span> <span class="s2">&quot;quotes&quot;</span> <span class="ow">in</span> <span class="n">word_stems</span>

        <span class="c1"># Second row: mixed content</span>
        <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="c1"># Should preserve mixed punctuation with letters but filter pure punctuation</span>
        <span class="n">mixed_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixed_tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected mixed alpha tokens: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_case_preservation_for_urls" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_case_preservation_for_urls</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that URLs preserve their case.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_case_preservation_for_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that URLs preserve their case.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Visit HTTPS://Example.COM/Path today&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">assert</span> <span class="s2">&quot;HTTPS://Example.COM/Path&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;visit&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;today&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_chinese_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chinese_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Chinese text character-level tokenization.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chinese_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Chinese text character-level tokenization.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;这是中文测试&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Chinese text should be split into individual characters</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;这&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;中&quot;</span><span class="p">,</span> <span class="s2">&quot;文&quot;</span><span class="p">,</span> <span class="s2">&quot;测&quot;</span><span class="p">,</span> <span class="s2">&quot;试&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_chinese_text_with_spaces" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_chinese_text_with_spaces</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test Chinese text with spaces (should still split into characters).</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_chinese_text_with_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Chinese text with spaces (should still split into characters).&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;你好 世界 这是 中文&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Should split into individual characters, not space-separated words</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;你&quot;</span><span class="p">,</span> <span class="s2">&quot;好&quot;</span><span class="p">,</span> <span class="s2">&quot;世&quot;</span><span class="p">,</span> <span class="s2">&quot;界&quot;</span><span class="p">,</span> <span class="s2">&quot;这&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;中&quot;</span><span class="p">,</span> <span class="s2">&quot;文&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_complex_urls_with_punctuation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_complex_urls_with_punctuation</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test complex URLs with various punctuation marks are preserved.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_complex_urls_with_punctuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test complex URLs with various punctuation marks are preserved.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Check https://example.com/path?query=1&amp;param=test#anchor and http://sub.domain.co.uk/&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Complex URLs should be preserved exactly</span>
    <span class="k">assert</span> <span class="s2">&quot;https://example.com/path?query=1&amp;param=test#anchor&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;http://sub.domain.co.uk/&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;and&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_comprehensive_punctuation_categories" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_comprehensive_punctuation_categories</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test various Unicode punctuation categories are properly filtered.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_comprehensive_punctuation_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test various Unicode punctuation categories are properly filtered.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Brackets: ()[]</span><span class="si">{}</span><span class="s2">  Quotes: </span><span class="se">\&quot;</span><span class="s2">&#39;`  Dashes: -–—  Math: +=*÷&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CJK punct: 。！？，：；  Symbols: @#$%^&amp;*  Mixed: word!!! ...word&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># First row: various punctuation types</span>
    <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">content_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
    <span class="c1"># Words may include attached punctuation (like &quot;brackets:&quot;)</span>
    <span class="n">word_stems</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">content_words</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;brackets&quot;</span> <span class="ow">in</span> <span class="n">word_stems</span>
    <span class="k">assert</span> <span class="s2">&quot;quotes&quot;</span> <span class="ow">in</span> <span class="n">word_stems</span>

    <span class="c1"># Second row: mixed content</span>
    <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="c1"># Should preserve mixed punctuation with letters but filter pure punctuation</span>
    <span class="n">mixed_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixed_tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected mixed alpha tokens: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_empty_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_empty_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test handling of empty text.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_empty_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test handling of empty text.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\n</span><span class="s2">&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># All should result in empty token lists</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_invalid_input_types" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_invalid_input_types</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test error handling for invalid input types.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_invalid_input_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test error handling for invalid input types.&quot;&quot;&quot;</span>
    <span class="c1"># Non-LazyFrame input</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Expected polars LazyFrame&quot;</span><span class="p">):</span>
        <span class="n">tokenize_text</span><span class="p">(</span><span class="s2">&quot;not a dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>

    <span class="c1"># Non-string column name</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;text_column must be a string&quot;</span><span class="p">):</span>
        <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_mixed_script_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_mixed_script_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test mixed script text handling.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_mixed_script_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test mixed script text handling.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;iPhone用户 can use this app&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Should contain both the mixed token and separate words</span>
    <span class="k">assert</span> <span class="s2">&quot;iphone用户&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>  <span class="c1"># Mixed script token (lowercased)</span>
    <span class="k">assert</span> <span class="s2">&quot;can&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;use&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;this&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;app&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_multiple_messages" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_multiple_messages</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test tokenization of multiple messages.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_multiple_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test tokenization of multiple messages.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;First message here&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Second message with @mention&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Third message 你好世界&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;here&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;@mention&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="c1"># CJK characters should be split individually for consistency</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;你&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
    <span class="k">assert</span> <span class="s2">&quot;好&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
    <span class="k">assert</span> <span class="s2">&quot;世&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
    <span class="k">assert</span> <span class="s2">&quot;界&quot;</span> <span class="ow">in</span> <span class="n">tokens_2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_ngram_punctuation_regression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_ngram_punctuation_regression</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that n-gram analysis won't generate pure punctuation n-grams.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_ngram_punctuation_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that n-gram analysis won&#39;t generate pure punctuation n-grams.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Normal text with... excessive punctuation!!! And more???&quot;</span><span class="p">,</span>
                <span class="s2">&quot;!!! ... ,,, !!! ... ,,,&quot;</span><span class="p">,</span>  <span class="c1"># Pattern that previously generated bad n-grams</span>
                <span class="s2">&quot;Good content. Bad punctuation!!!&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Collect all tokens and ensure no pure punctuation tokens exist</span>
    <span class="n">all_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">token_list</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
        <span class="n">all_tokens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">token_list</span><span class="p">)</span>

    <span class="c1"># No token should be pure punctuation</span>
    <span class="n">pure_punctuation_tokens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">token</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">all_tokens</span>
        <span class="k">if</span> <span class="n">token</span>
        <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">))</span>  <span class="c1"># Exclude legitimate patterns</span>
    <span class="p">]</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">pure_punctuation_tokens</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Found pure punctuation tokens: </span><span class="si">{</span><span class="n">pure_punctuation_tokens</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Should still have legitimate content</span>
    <span class="n">content_tokens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">all_tokens</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">content_tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">),</span> <span class="s2">&quot;No content tokens found - over-filtering occurred&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_nonexistent_column" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_nonexistent_column</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test error handling for nonexistent column.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_nonexistent_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test error handling for nonexistent column.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;other_col&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="c1"># This should raise an error when the lazy frame is executed</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>  <span class="c1"># Will be a polars error about missing column</span>
        <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;nonexistent_column&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_performance_with_large_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_performance_with_large_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test tokenization performance with larger text.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_performance_with_large_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test tokenization performance with larger text.&quot;&quot;&quot;</span>
    <span class="n">large_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;word&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">large_text</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1000</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">token</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_punctuation_edge_cases_preserved" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_punctuation_edge_cases_preserved</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that legitimate tokens with punctuation are preserved.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_punctuation_edge_cases_preserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that legitimate tokens with punctuation are preserved.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Visit https://example.com/path?query=test&amp;param=1 today&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Contact @user123 and check #hashtag!&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Words like don&#39;t, can&#39;t, won&#39;t should work&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Email test@example.com or visit sub.domain.com&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># URLs with punctuation should be preserved</span>
    <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;https://example.com/path?query=test&amp;param=1&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>

    <span class="c1"># Social media entities should be preserved</span>
    <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;@user123&quot;</span> <span class="ow">in</span> <span class="n">tokens_1</span>
    <span class="k">assert</span> <span class="s2">&quot;#hashtag&quot;</span> <span class="ow">in</span> <span class="n">tokens_1</span>

    <span class="c1"># Contractions should be preserved</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">contraction_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">contraction_found</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected contractions to be preserved, got: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Email-like patterns should work (even if not in URL pattern)</span>
    <span class="n">tokens_3</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">email_or_domain_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_3</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">email_or_domain_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected domain/email patterns, got: </span><span class="si">{</span><span class="n">tokens_3</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_punctuation_handling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_punctuation_handling</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test handling of punctuation.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_punctuation_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test handling of punctuation.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello, world! How are you?&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Punctuation should be included with words (except for social media entities)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello,&quot;</span><span class="p">,</span> <span class="s2">&quot;world!&quot;</span><span class="p">,</span> <span class="s2">&quot;how&quot;</span><span class="p">,</span> <span class="s2">&quot;are&quot;</span><span class="p">,</span> <span class="s2">&quot;you?&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_punctuation_with_multilingual_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_punctuation_with_multilingual_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test punctuation filtering with various languages.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_punctuation_with_multilingual_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test punctuation filtering with various languages.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;English... 中文。。。 한국어!!! русский???&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Mixed iPhone用户!!! can use this.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;URL https://例え.com/パス works fine.&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Should preserve language text but filter pure punctuation</span>
    <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">has_text</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">has_text</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected multilingual text to be preserved, got: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Mixed script tokens should be preserved</span>
    <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
        <span class="s2">&quot;iphone&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Mixed script not found: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># International domain names: protocol should be preserved, but non-ASCII parts will be tokenized separately</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">https_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;https:&quot;</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
    <span class="n">japanese_chars_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">https_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;HTTPS protocol not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">japanese_chars_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Japanese characters not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_pure_punctuation_filtering" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_pure_punctuation_filtering</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that pure punctuation tokens are filtered out.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_pure_punctuation_filtering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that pure punctuation tokens are filtered out.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;!!! ... ,,, ??? ::: ;;;&quot;</span><span class="p">,</span>  <span class="c1"># Pure punctuation only</span>
                <span class="s2">&quot;Hello!!! World... Test,,,&quot;</span><span class="p">,</span>  <span class="c1"># Mixed content</span>
                <span class="s2">&quot;。。。 ！！！ ？？？&quot;</span><span class="p">,</span>  <span class="c1"># CJK punctuation</span>
                <span class="s2">&quot;((())) [[[]]] {{</span><span class="si">{}</span><span class="s2">}}&quot;</span><span class="p">,</span>  <span class="c1"># Brackets and braces</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># First row: pure punctuation should be filtered to empty list</span>
    <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">tokens_0</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected empty tokens for pure punctuation, got: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Second row: mixed content should preserve words but filter pure punctuation</span>
    <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="c1"># Should contain words but not pure punctuation sequences</span>
    <span class="n">word_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected words to be preserved, got: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Third row: CJK punctuation should also be filtered</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">tokens_2</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected CJK punctuation to be filtered, got: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Fourth row: brackets and braces should be filtered</span>
    <span class="n">tokens_3</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">tokens_3</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected brackets/braces to be filtered, got: </span><span class="si">{</span><span class="n">tokens_3</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_real_world_social_media_example" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_real_world_social_media_example</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test realistic social media content with mixed punctuation.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_real_world_social_media_example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test realistic social media content with mixed punctuation.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;OMG!!! Check this out: https://tinyurl.com/demo @everyone #viral #trending... So cool!!!&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Should preserve content but filter pure punctuation</span>
    <span class="k">assert</span> <span class="s2">&quot;https://tinyurl.com/demo&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;@everyone&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;#viral&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;#trending&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;omg&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;cool&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_simple_english_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_simple_english_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test basic English text tokenization.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_simple_english_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test basic English text tokenization.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello world this is a test&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_social_media_entities" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_social_media_entities</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test preservation of social media entities.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_social_media_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test preservation of social media entities.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Check out https://example.com and @username #hashtag&quot;</span><span class="p">]}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># URLs, mentions, and hashtags should be preserved as-is</span>
    <span class="k">assert</span> <span class="s2">&quot;https://example.com&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;@username&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;#hashtag&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;and&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_social_media_entity_variations" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_social_media_entity_variations</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test various social media entity formats.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_social_media_entity_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test various social media entity formats.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Check http://short.ly and https://secure.example.com/path?query=123 plus @user_name and #CamelCaseTag&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># All URL formats should be preserved</span>
    <span class="k">assert</span> <span class="s2">&quot;http://short.ly&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;https://secure.example.com/path?query=123&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;@user_name&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;#CamelCaseTag&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_special_characters" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_special_characters</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test handling of various special characters.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_special_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test handling of various special characters.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Text with émojis 😀 and àccénts café naïve&quot;</span><span class="p">]}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Should handle accented characters properly</span>
    <span class="k">assert</span> <span class="s2">&quot;émojis&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;😀&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;àccénts&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;café&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
    <span class="k">assert</span> <span class="s2">&quot;naïve&quot;</span> <span class="ow">in</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_symbol_filtering_specificity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_symbol_filtering_specificity</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that only problematic symbols are filtered, not meaningful ones.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_symbol_filtering_specificity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that only problematic symbols are filtered, not meaningful ones.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Math symbols === +++ --- should be filtered&quot;</span><span class="p">,</span>
                <span class="s2">&quot;But emojis 😀😎🎉 should be preserved&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Currency symbols $100 €50 should be filtered&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="c1"># Math symbols should be filtered</span>
    <span class="n">tokens_0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">math_symbols_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">token</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;===&quot;</span><span class="p">,</span> <span class="s2">&quot;+++&quot;</span><span class="p">,</span> <span class="s2">&quot;---&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">math_symbols_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Math symbols not filtered: </span><span class="si">{</span><span class="n">tokens_0</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;math&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>
    <span class="k">assert</span> <span class="s2">&quot;symbols&quot;</span> <span class="ow">in</span> <span class="n">tokens_0</span>

    <span class="c1"># Emojis should be preserved</span>
    <span class="n">tokens_1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">emoji_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">emoji_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Emojis not preserved: </span><span class="si">{</span><span class="n">tokens_1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Currency symbols should be filtered, numbers preserved as individual digits</span>
    <span class="n">tokens_2</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">currency_symbols_found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">token</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;€&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">currency_symbols_found</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Currency symbols not filtered: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Numbers may be tokenized as individual digits or groups</span>
    <span class="n">has_numbers</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">has_numbers</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Numbers not preserved: </span><span class="si">{</span><span class="n">tokens_2</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_url_with_cjk_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_url_with_cjk_text</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test URL preservation with surrounding CJK characters.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_url_with_cjk_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test URL preservation with surrounding CJK characters.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;访问https://example.com网站&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># URL should be preserved, CJK characters should be split individually</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;访&quot;</span><span class="p">,</span> <span class="s2">&quot;问&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;网&quot;</span><span class="p">,</span> <span class="s2">&quot;站&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.test_utils.TestTokenizeText.test_whitespace_normalization" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">test_whitespace_normalization</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Test that multiple whitespace is normalized.</p>


            <details class="quote">
              <summary>Source code in <code>app/test_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_whitespace_normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that multiple whitespace is normalized.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello    world</span><span class="se">\t\t</span><span class="s2">test</span><span class="se">\n\n</span><span class="s2">more   spaces&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;more&quot;</span><span class="p">,</span> <span class="s2">&quot;spaces&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="app.utils" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>utils</code>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="app.utils.MemoryManager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>MemoryManager</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Real-time memory monitoring and adaptive processing control.</p>
<p>Provides memory usage tracking, adaptive chunk sizing, early warning system,
and automatic garbage collection triggering for memory pressure scenarios.</p>







              <details class="quote">
                <summary>Source code in <code>app/utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MemoryManager</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Real-time memory monitoring and adaptive processing control.</span>

<span class="sd">    Provides memory usage tracking, adaptive chunk sizing, early warning system,</span>
<span class="sd">    and automatic garbage collection triggering for memory pressure scenarios.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">max_memory_gb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span>
    <span class="n">process_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;memory_manager&quot;</span>
    <span class="n">max_memory_bytes</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># More lenient thresholds for higher-memory systems</span>
    <span class="n">thresholds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">:</span> <span class="mf">0.70</span><span class="p">,</span>  <span class="c1"># Increased from 0.60</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span>  <span class="c1"># Increased from 0.75</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>  <span class="c1"># Increased from 0.85</span>
    <span class="p">}</span>
    <span class="c1"># Less aggressive chunk size reduction</span>
    <span class="n">chunk_size_factors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Increased from 0.7</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># Increased from 0.4</span>
        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="c1"># Increased from 0.2</span>
    <span class="p">}</span>
    <span class="n">memory_history</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_history_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_memory_gb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">):</span>
        <span class="c1"># Auto-detect memory limit if not provided</span>
        <span class="n">was_auto_detected</span> <span class="o">=</span> <span class="n">max_memory_gb</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">max_memory_gb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_memory_gb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_detect_memory_limit</span><span class="p">()</span>

        <span class="c1"># Update data with detected/provided memory limit</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;max_memory_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_memory_gb</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">process_name</span><span class="si">}</span><span class="s2">_memory&quot;</span><span class="p">)</span>

        <span class="c1"># Log detected configuration for transparency</span>
        <span class="n">system_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Memory manager initialized with intelligent detection&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;system_total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_gb</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;detected_limit_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_memory_gb</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;allocation_percent&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_memory_gb</span> <span class="o">/</span> <span class="n">total_gb</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;detection_method&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span> <span class="k">if</span> <span class="n">was_auto_detected</span> <span class="k">else</span> <span class="s2">&quot;manual_override&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_auto_detect_memory_limit</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-detect appropriate memory limit based on system RAM.</span>

<span class="sd">        Uses tiered allocation strategy:</span>
<span class="sd">        - ≥32GB systems: 40% of total RAM (12-16GB)</span>
<span class="sd">        - ≥16GB systems: 30% of total RAM (5-8GB)</span>
<span class="sd">        - ≥8GB systems: 25% of total RAM (2-4GB)</span>
<span class="sd">        - &lt;8GB systems: 20% of total RAM (conservative)</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Recommended memory limit in GB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="n">total_gb</span> <span class="o">=</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

        <span class="k">if</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>  <span class="c1"># High-memory system</span>
            <span class="k">return</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mf">0.4</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>  <span class="c1"># Standard system</span>
            <span class="k">return</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mf">0.3</span>
        <span class="k">elif</span> <span class="n">total_gb</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Lower-memory system</span>
            <span class="k">return</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mf">0.25</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Very constrained</span>
            <span class="k">return</span> <span class="n">total_gb</span> <span class="o">*</span> <span class="mf">0.2</span>

    <span class="k">def</span> <span class="nf">get_current_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive current memory statistics.&quot;&quot;&quot;</span>
        <span class="n">memory_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span>
        <span class="n">system_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>

        <span class="n">current_rss</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">current_vms</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">vms</span>

        <span class="n">usage_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="n">current_rss</span><span class="p">,</span>
            <span class="s2">&quot;vms_bytes&quot;</span><span class="p">:</span> <span class="n">current_vms</span><span class="p">,</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="n">current_rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;vms_mb&quot;</span><span class="p">:</span> <span class="n">current_vms</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;rss_gb&quot;</span><span class="p">:</span> <span class="n">current_rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;system_available_gb&quot;</span><span class="p">:</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;system_used_percent&quot;</span><span class="p">:</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
            <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">current_rss</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Add to history for trend analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="n">current_rss</span><span class="p">,</span>
                <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="n">usage_stats</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Maintain history size</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_history_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">usage_stats</span>

    <span class="k">def</span> <span class="nf">get_memory_pressure_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryPressureLevel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine current memory pressure level.&quot;&quot;&quot;</span>
        <span class="n">current_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">current_usage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span>

        <span class="k">if</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
        <span class="k">elif</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>
        <span class="k">elif</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>

    <span class="k">def</span> <span class="nf">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">base_chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate optimal chunk size based on current memory pressure.&quot;&quot;&quot;</span>
        <span class="n">pressure_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
        <span class="n">adjustment_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">pressure_level</span><span class="p">]</span>

        <span class="c1"># Operation-specific base adjustments</span>
        <span class="n">operation_factors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tokenization&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;ngram_generation&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># More memory intensive</span>
            <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
            <span class="s2">&quot;join_operations&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">operation_factor</span> <span class="o">=</span> <span class="n">operation_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation_type</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">adjusted_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_chunk_size</span> <span class="o">*</span> <span class="n">adjustment_factor</span> <span class="o">*</span> <span class="n">operation_factor</span><span class="p">)</span>

        <span class="c1"># Ensure minimum viable chunk size</span>
        <span class="n">min_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_chunk_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">adjusted_size</span><span class="p">,</span> <span class="n">min_chunk_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">should_trigger_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if garbage collection should be triggered.&quot;&quot;&quot;</span>
        <span class="n">current_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">current_usage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span>

        <span class="k">return</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="n">force_threshold</span>

    <span class="k">def</span> <span class="nf">enhanced_gc_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform comprehensive garbage collection with metrics.&quot;&quot;&quot;</span>
        <span class="n">memory_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Multiple GC passes for thorough cleanup</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">collected</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">collected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">memory_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;memory_before_mb&quot;</span><span class="p">:</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
            <span class="s2">&quot;memory_after_mb&quot;</span><span class="p">:</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pressure_before&quot;</span><span class="p">:</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pressure_after&quot;</span><span class="p">:</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Memory cleanup completed&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">],</span>
                <span class="s2">&quot;memory_before_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_before_mb&quot;</span><span class="p">],</span>
                <span class="s2">&quot;memory_after_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_after_mb&quot;</span><span class="p">],</span>
                <span class="s2">&quot;pressure_before&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;pressure_before&quot;</span><span class="p">],</span>
                <span class="s2">&quot;pressure_after&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;pressure_after&quot;</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cleanup_stats</span>

    <span class="k">def</span> <span class="nf">get_memory_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze recent memory usage trend.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;insufficient_data&quot;</span>

        <span class="n">recent_usage</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;rss_bytes&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]]</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recent_usage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;increasing&quot;</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recent_usage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;decreasing&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;stable&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.calculate_adaptive_chunk_size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span><span class="n">base_chunk_size</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Calculate optimal chunk size based on current memory pressure.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_adaptive_chunk_size</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">base_chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate optimal chunk size based on current memory pressure.&quot;&quot;&quot;</span>
    <span class="n">pressure_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>
    <span class="n">adjustment_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size_factors</span><span class="p">[</span><span class="n">pressure_level</span><span class="p">]</span>

    <span class="c1"># Operation-specific base adjustments</span>
    <span class="n">operation_factors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tokenization&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;ngram_generation&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># More memory intensive</span>
        <span class="s2">&quot;unique_extraction&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
        <span class="s2">&quot;join_operations&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">operation_factor</span> <span class="o">=</span> <span class="n">operation_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation_type</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">adjusted_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_chunk_size</span> <span class="o">*</span> <span class="n">adjustment_factor</span> <span class="o">*</span> <span class="n">operation_factor</span><span class="p">)</span>

    <span class="c1"># Ensure minimum viable chunk size</span>
    <span class="n">min_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">base_chunk_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">adjusted_size</span><span class="p">,</span> <span class="n">min_chunk_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.enhanced_gc_cleanup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">enhanced_gc_cleanup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Perform comprehensive garbage collection with metrics.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enhanced_gc_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform comprehensive garbage collection with metrics.&quot;&quot;&quot;</span>
    <span class="n">memory_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

    <span class="c1"># Multiple GC passes for thorough cleanup</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">collected</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">collected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">memory_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

    <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;memory_before_mb&quot;</span><span class="p">:</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
        <span class="s2">&quot;memory_after_mb&quot;</span><span class="p">:</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
        <span class="s2">&quot;pressure_before&quot;</span><span class="p">:</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
        <span class="s2">&quot;pressure_after&quot;</span><span class="p">:</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Memory cleanup completed&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">],</span>
            <span class="s2">&quot;memory_before_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_before_mb&quot;</span><span class="p">],</span>
            <span class="s2">&quot;memory_after_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_after_mb&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pressure_before&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;pressure_before&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pressure_after&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;pressure_after&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">cleanup_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.get_current_memory_usage" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_current_memory_usage</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get comprehensive current memory statistics.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_current_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get comprehensive current memory statistics.&quot;&quot;&quot;</span>
    <span class="n">memory_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span>
    <span class="n">system_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>

    <span class="n">current_rss</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">current_vms</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">vms</span>

    <span class="n">usage_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="n">current_rss</span><span class="p">,</span>
        <span class="s2">&quot;vms_bytes&quot;</span><span class="p">:</span> <span class="n">current_vms</span><span class="p">,</span>
        <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="n">current_rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;vms_mb&quot;</span><span class="p">:</span> <span class="n">current_vms</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;rss_gb&quot;</span><span class="p">:</span> <span class="n">current_rss</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;system_available_gb&quot;</span><span class="p">:</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;system_used_percent&quot;</span><span class="p">:</span> <span class="n">system_memory</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
        <span class="s2">&quot;process_memory_percent&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">current_rss</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Add to history for trend analysis</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s2">&quot;rss_bytes&quot;</span><span class="p">:</span> <span class="n">current_rss</span><span class="p">,</span>
            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="n">usage_stats</span><span class="p">[</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Maintain history size</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_history_size</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">usage_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.get_memory_pressure_level" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_memory_pressure_level</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Determine current memory pressure level.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_memory_pressure_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryPressureLevel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine current memory pressure level.&quot;&quot;&quot;</span>
    <span class="n">current_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">current_usage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span>

    <span class="k">if</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span>
    <span class="k">elif</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span>
    <span class="k">elif</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">MEDIUM</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">LOW</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.get_memory_trend" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_memory_trend</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Analyze recent memory usage trend.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_memory_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze recent memory usage trend.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;insufficient_data&quot;</span>

    <span class="n">recent_usage</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;rss_bytes&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]]</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recent_usage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;increasing&quot;</span>
    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">recent_usage</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recent_usage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;decreasing&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;stable&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="app.utils.MemoryManager.should_trigger_gc" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">should_trigger_gc</span><span class="p">(</span><span class="n">force_threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Determine if garbage collection should be triggered.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">should_trigger_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if garbage collection should be triggered.&quot;&quot;&quot;</span>
    <span class="n">current_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">current_usage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory_bytes</span>

    <span class="k">return</span> <span class="n">usage_ratio</span> <span class="o">&gt;=</span> <span class="n">force_threshold</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="app.utils.is_space_separated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Determine if text uses space-separated tokenization or character-based tokenization.</p>
<p>Uses Unicode script detection to identify if text primarily contains scripts
that use spaces for word separation (Latin, Cyrillic, Arabic, etc.) vs.
scripts that don't use spaces (Chinese, Japanese, Thai, etc.).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="app.utils.is_space_separated(text)" class="doc doc-heading doc-heading-parameter">                  <code>text</code>
</h5>            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="polars.Expr">Expr</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text string or polars expression</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="polars.Expr">Expr</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean or polars expression indicating if text is space-separated</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_space_separated</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if text uses space-separated tokenization or character-based tokenization.</span>

<span class="sd">    Uses Unicode script detection to identify if text primarily contains scripts</span>
<span class="sd">    that use spaces for word separation (Latin, Cyrillic, Arabic, etc.) vs.</span>
<span class="sd">    scripts that don&#39;t use spaces (Chinese, Japanese, Thai, etc.).</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Input text string or polars expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean or polars expression indicating if text is space-separated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># For direct string input, use Python regex</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Empty text defaults to space-separated</span>

        <span class="k">if</span> <span class="n">UNICODE_SUPPORT</span><span class="p">:</span>
            <span class="c1"># Use regex module with Unicode property support</span>
            <span class="n">space_separated_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;[\p</span><span class="si">{Latin}</span><span class="s2">\p</span><span class="si">{Cyrillic}</span><span class="s2">\p</span><span class="si">{Arabic}</span><span class="s2">\p</span><span class="si">{Armenian}</span><span class="s2">\p</span><span class="si">{Georgian}</span><span class="s2">\p</span><span class="si">{Greek}</span><span class="s2">\p</span><span class="si">{Hebrew}</span><span class="s2">\p</span><span class="si">{Hangul}</span><span class="s2">]&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">non_space_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;[\p</span><span class="si">{Han}</span><span class="s2">\p</span><span class="si">{Hiragana}</span><span class="s2">\p</span><span class="si">{Katakana}</span><span class="s2">\p</span><span class="si">{Thai}</span><span class="s2">\p</span><span class="si">{Lao}</span><span class="s2">\p</span><span class="si">{Myanmar}</span><span class="s2">\p</span><span class="si">{Khmer}</span><span class="s2">]&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback to Unicode ranges</span>
            <span class="c1"># Latin: U+0000-U+024F, U+1E00-U+1EFF</span>
            <span class="c1"># Cyrillic: U+0400-U+04FF, U+0500-U+052F</span>
            <span class="c1"># Arabic: U+0600-U+06FF, U+0750-U+077F</span>
            <span class="c1"># Greek: U+0370-U+03FF</span>
            <span class="c1"># Hebrew: U+0590-U+05FF</span>
            <span class="n">space_separated_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\u0000-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0500-\u052F\u0600-\u06FF\u0750-\u077F\u0370-\u03FF\u0590-\u05FF\uAC00-\uD7AF]&quot;</span>

            <span class="c1"># CJK: U+4E00-U+9FFF (Han), U+3040-U+309F (Hiragana), U+30A0-U+30FF (Katakana)</span>
            <span class="c1"># Thai: U+0E00-U+0E7F</span>
            <span class="c1"># Myanmar: U+1000-U+109F</span>
            <span class="n">non_space_pattern</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\u0E00-\u0E7F\u1000-\u109F]&quot;</span>
            <span class="p">)</span>

            <span class="n">space_separated_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">space_separated_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
            <span class="n">non_space_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">non_space_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>

        <span class="c1"># If we have any characters, determine majority script type</span>
        <span class="n">total_script_chars</span> <span class="o">=</span> <span class="n">space_separated_chars</span> <span class="o">+</span> <span class="n">non_space_chars</span>
        <span class="k">if</span> <span class="n">total_script_chars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># No script-specific characters, default to space-separated</span>

        <span class="c1"># Space-separated if majority of script characters are from space-separated scripts</span>
        <span class="k">return</span> <span class="n">space_separated_chars</span> <span class="o">&gt;=</span> <span class="n">non_space_chars</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For polars expressions, use Unicode ranges (more compatible)</span>
        <span class="c1"># Space-separated scripts pattern</span>
        <span class="n">space_separated_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\u0000-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0500-\u052F\u0600-\u06FF\u0750-\u077F\u0370-\u03FF\u0590-\u05FF\uAC00-\uD7AF]&quot;</span>
        <span class="c1"># Non-space scripts pattern</span>
        <span class="n">non_space_pattern</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\u0E00-\u0E7F\u1000-\u109F]&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">count_matches</span><span class="p">(</span>
            <span class="n">space_separated_pattern</span>
        <span class="p">)</span> <span class="o">&gt;=</span> <span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">count_matches</span><span class="p">(</span><span class="n">non_space_pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.parquet_row_count" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">parquet_row_count</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get the number of rows in a parquet file efficiently.</p>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parquet_row_count</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the number of rows in a parquet file efficiently.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">pf</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">num_rows</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.tokenize_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">tokenize_text</span><span class="p">(</span><span class="n">ldf</span><span class="p">,</span> <span class="n">text_column</span><span class="p">,</span> <span class="n">progress_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">memory_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Memory-efficient tokenization engine with adaptive memory management.</p>
<p>Enhanced features:
- Real-time memory monitoring during processing
- Dynamic chunk size adjustment based on memory pressure
- Mid-process memory monitoring and adaptation
- Graceful fallback to smaller chunks when memory pressure increases
- Progress reporting with memory statistics</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h5 id="app.utils.tokenize_text(ldf)" class="doc doc-heading doc-heading-parameter">                  <code>ldf</code>
</h5>            </td>
            <td>
                  <code><span title="polars.LazyFrame">LazyFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input LazyFrame containing text data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="app.utils.tokenize_text(text_column)" class="doc doc-heading doc-heading-parameter">                  <code>text_column</code>
</h5>            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing text to tokenize</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="app.utils.tokenize_text(progress_manager)" class="doc doc-heading doc-heading-parameter">                  <code>progress_manager</code>
</h5>            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;ProgressManager&lt;/code&gt; (&lt;code&gt;terminal_tools.progress.ProgressManager&lt;/code&gt;)" href="../terminal_tools/#terminal_tools.progress.ProgressManager">ProgressManager</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional progress manager for detailed tokenization progress reporting</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h5 id="app.utils.tokenize_text(memory_manager)" class="doc doc-heading doc-heading-parameter">                  <code>memory_manager</code>
</h5>            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;MemoryManager&lt;/code&gt; (&lt;code&gt;app.utils.MemoryManager&lt;/code&gt;)" href="#app.utils.MemoryManager">MemoryManager</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional MemoryManager for adaptive processing</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.LazyFrame">LazyFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LazyFrame with additional 'tokens' column containing list of tokens</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If text_column does not exist in the LazyFrame</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If input is not a polars LazyFrame</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="MemoryError">MemoryError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If processing fails even with minimum chunk sizes</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>app/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tokenize_text</span><span class="p">(</span>
    <span class="n">ldf</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">,</span>
    <span class="n">text_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">progress_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ProgressManager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">memory_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MemoryManager</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Memory-efficient tokenization engine with adaptive memory management.</span>

<span class="sd">    Enhanced features:</span>
<span class="sd">    - Real-time memory monitoring during processing</span>
<span class="sd">    - Dynamic chunk size adjustment based on memory pressure</span>
<span class="sd">    - Mid-process memory monitoring and adaptation</span>
<span class="sd">    - Graceful fallback to smaller chunks when memory pressure increases</span>
<span class="sd">    - Progress reporting with memory statistics</span>

<span class="sd">    Args:</span>
<span class="sd">        ldf: Input LazyFrame containing text data</span>
<span class="sd">        text_column: Name of the column containing text to tokenize</span>
<span class="sd">        progress_manager: Optional progress manager for detailed tokenization progress reporting</span>
<span class="sd">        memory_manager: Optional MemoryManager for adaptive processing</span>

<span class="sd">    Returns:</span>
<span class="sd">        LazyFrame with additional &#39;tokens&#39; column containing list of tokens</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If text_column does not exist in the LazyFrame</span>
<span class="sd">        TypeError: If input is not a polars LazyFrame</span>
<span class="sd">        MemoryError: If processing fails even with minimum chunk sizes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ldf</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected polars LazyFrame, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ldf</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text_column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;text_column must be a string, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">text_column</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># No validation needed for progress_manager - it&#39;s expected to be a progress manager instance or None</span>

    <span class="c1"># Create memory manager if not provided</span>
    <span class="k">if</span> <span class="n">memory_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">max_memory_gb</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">process_name</span><span class="o">=</span><span class="s2">&quot;tokenizer&quot;</span><span class="p">)</span>

    <span class="c1"># Log tokenization start</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Starting text tokenization&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text_column&quot;</span><span class="p">:</span> <span class="n">text_column</span><span class="p">,</span>
            <span class="s2">&quot;has_progress_manager&quot;</span><span class="p">:</span> <span class="n">progress_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;memory_manager_provided&quot;</span><span class="p">:</span> <span class="n">memory_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Check if column exists by trying to reference it</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># This will validate that the column exists when the lazy frame is executed</span>
        <span class="n">test_col</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">text_column</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid column name &#39;</span><span class="si">{</span><span class="n">text_column</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Define the comprehensive tokenization regex pattern</span>
    <span class="c1"># Order is critical for proper matching precedence</span>
    <span class="n">token_pattern</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;[Hh][Tt][Tt][Pp][Ss]?://[a-zA-Z0-9._~:/?#@!$&amp;&#39;()*+,;=\-]+&quot;</span><span class="p">,</span>  <span class="c1"># URLs (case insensitive HTTP/HTTPS)</span>
            <span class="sa">r</span><span class="s2">&quot;@\w+&quot;</span><span class="p">,</span>  <span class="c1"># @mentions</span>
            <span class="sa">r</span><span class="s2">&quot;#\w+&quot;</span><span class="p">,</span>  <span class="c1"># #hashtags</span>
            <span class="sa">r</span><span class="s2">&quot;[a-zA-Z\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]{2,}[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]+&quot;</span><span class="p">,</span>  <span class="c1"># Mixed Latin+CJK (Latin part 2+ chars)</span>
            <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]+[a-zA-Z\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]+[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]+&quot;</span><span class="p">,</span>  <span class="c1"># CJK-Latin-CJK (requires Latin chars)</span>
            <span class="sa">r</span><span class="s2">&quot;[\uAC00-\uD7AF]+&quot;</span><span class="p">,</span>  <span class="c1"># Korean words (Hangul)</span>
            <span class="sa">r</span><span class="s2">&quot;[\u0400-\u04FF\u0500-\u052F]+&quot;</span><span class="p">,</span>  <span class="c1"># Cyrillic words</span>
            <span class="sa">r</span><span class="s2">&quot;[a-zA-Z\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF][a-zA-Z0-9\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF.!?,;:()&#39;</span><span class="se">\&quot;\\</span><span class="s2">-]*&quot;</span><span class="p">,</span>  <span class="c1"># Latin words with accented chars and punctuation</span>
            <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]&quot;</span><span class="p">,</span>  <span class="c1"># Individual CJK characters</span>
            <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;[^\s\p</span><span class="si">{P}</span><span class="s2">\p</span><span class="si">{Sm}</span><span class="s2">\p</span><span class="si">{Sc}</span><span class="s2">]&quot;</span>
                <span class="k">if</span> <span class="n">UNICODE_SUPPORT</span>
                <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;[a-zA-Z0-9\u00C0-\u9FFF\uAC00-\uD7AF\u0400-\u052F]&quot;</span>
            <span class="p">),</span>  <span class="c1"># Any other non-whitespace excluding punctuation and math/currency symbols</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tokenize_chunk</span><span class="p">(</span><span class="n">chunk_ldf</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply tokenization to a chunk of data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">chunk_ldf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># Step 1: Normalize whitespace and handle empty strings</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">text_column</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip_chars</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace_all</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span>
                    <span class="p">)</span>  <span class="c1"># Normalize multiple whitespace to single space</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;_normalized_text&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># Step 2: Conditional tokenization based on language type</span>
                    <span class="c1"># For space-separated languages, split by spaces first then handle special patterns</span>
                    <span class="c1"># For non-space languages (CJK), use character-level splitting with entity preservation</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">is_space_separated</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;_normalized_text&quot;</span><span class="p">)))</span>
                    <span class="o">.</span><span class="n">then</span><span class="p">(</span>
                        <span class="c1"># Space-separated language processing</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;_normalized_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract_all</span><span class="p">(</span><span class="n">token_pattern</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                        <span class="c1"># Non-space language processing: preserve entities, split characters</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;_normalized_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract_all</span><span class="p">(</span>
                            <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="sa">r</span><span class="s2">&quot;[Hh][Tt][Tt][Pp][Ss]?://[a-zA-Z0-9._~:/?#@!$&amp;&#39;()*+,;=\-]+&quot;</span><span class="p">,</span>  <span class="c1"># URLs</span>
                                    <span class="sa">r</span><span class="s2">&quot;@\w+&quot;</span><span class="p">,</span>  <span class="c1"># @mentions</span>
                                    <span class="sa">r</span><span class="s2">&quot;#\w+&quot;</span><span class="p">,</span>  <span class="c1"># #hashtags</span>
                                    <span class="sa">r</span><span class="s2">&quot;[a-zA-Z\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]+&quot;</span><span class="p">,</span>  <span class="c1"># Pure Latin sequences with accented chars</span>
                                    <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]&quot;</span><span class="p">,</span>  <span class="c1"># Individual CJK characters</span>
                                    <span class="p">(</span>
                                        <span class="sa">r</span><span class="s2">&quot;[^\s\p</span><span class="si">{P}</span><span class="s2">\p</span><span class="si">{Sm}</span><span class="s2">\p</span><span class="si">{Sc}</span><span class="s2">]&quot;</span>
                                        <span class="k">if</span> <span class="n">UNICODE_SUPPORT</span>
                                        <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;[a-zA-Z0-9\u00C0-\u9FFF\uAC00-\uD7AF\u0400-\u052F]&quot;</span>
                                    <span class="p">),</span>  <span class="c1"># Any other non-whitespace excluding punctuation and math/currency symbols</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;_raw_tokens&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># Step 3: Process tokens (normalize case, handle social media entities)</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;_raw_tokens&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                            <span class="c1"># Social media entities: keep as-is (case preserved for URLs)</span>
                            <span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
                                <span class="sa">r</span><span class="s2">&quot;^([Hh][Tt][Tt][Pp][Ss]?://|@|#)&quot;</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                            <span class="c1"># Mixed scripts (e.g., &quot;iPhone用户&quot;): keep as single token but lowercase</span>
                            <span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]&quot;</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
                                <span class="sa">r</span><span class="s2">&quot;[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]&quot;</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">to_lowercase</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">to_lowercase</span><span class="p">())</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># Step 4: Filter out empty tokens and whitespace-only tokens</span>
                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len_chars</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip_chars</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;_normalized_text&quot;</span><span class="p">,</span> <span class="s2">&quot;_raw_tokens&quot;</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="c1"># Memory-efficient row counting with minimal footprint</span>
    <span class="k">def</span> <span class="nf">_get_dataset_size</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset size with minimal memory usage, return None if not possible.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Primary method: Use count aggregation - most memory efficient</span>
            <span class="k">return</span> <span class="n">ldf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">len</span><span class="p">())</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Secondary method: Try with height property if available</span>
                <span class="c1"># Some lazy frames might support this more efficiently</span>
                <span class="k">return</span> <span class="n">ldf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Tertiary method: Use sample-based estimation for problematic cases</span>
                    <span class="c1"># This is a fallback for very problematic data sources</span>
                    <span class="n">initial_chunk_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
                        <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
                    <span class="p">)</span>
                    <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">initial_chunk_size</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="n">sample_df</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">sample_size</span><span class="p">:</span>
                        <span class="c1"># We got less than requested, likely end of data</span>
                        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Cannot determine size efficiently - will use streaming</span>
                        <span class="k">return</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># Complete fallback - cannot determine size</span>
                    <span class="k">return</span> <span class="kc">None</span>

    <span class="n">total_rows</span> <span class="o">=</span> <span class="n">_get_dataset_size</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Dataset size determined&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;total_rows&quot;</span><span class="p">:</span> <span class="n">total_rows</span><span class="p">,</span>
            <span class="s2">&quot;size_determination_method&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;count_aggregation&quot;</span> <span class="k">if</span> <span class="n">total_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Handle empty dataset efficiently</span>
    <span class="k">if</span> <span class="n">total_rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Empty dataset detected, returning empty tokens&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total_rows&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ldf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">([])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)])</span>

    <span class="c1"># Calculate initial adaptive chunk size based on memory pressure</span>
    <span class="n">initial_chunk_size</span> <span class="o">=</span> <span class="mi">50000</span>
    <span class="n">adaptive_chunk_size</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">calculate_adaptive_chunk_size</span><span class="p">(</span>
        <span class="n">initial_chunk_size</span><span class="p">,</span> <span class="s2">&quot;tokenization&quot;</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Adaptive chunk size calculated&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;initial_chunk_size&quot;</span><span class="p">:</span> <span class="n">initial_chunk_size</span><span class="p">,</span>
            <span class="s2">&quot;adaptive_chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk_size</span><span class="p">,</span>
            <span class="s2">&quot;memory_pressure&quot;</span><span class="p">:</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># If dataset is small, check if we should process without chunking</span>
    <span class="k">if</span> <span class="n">total_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">total_rows</span> <span class="o">&lt;=</span> <span class="n">adaptive_chunk_size</span><span class="p">:</span>
        <span class="c1"># Small dataset - process normally with memory monitoring</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Processing small dataset without chunking&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;total_rows&quot;</span><span class="p">:</span> <span class="n">total_rows</span><span class="p">,</span>
                <span class="s2">&quot;adaptive_chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk_size</span><span class="p">,</span>
                <span class="s2">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;single_chunk&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="n">memory_before</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_tokenize_chunk</span><span class="p">(</span><span class="n">ldf</span><span class="p">)</span>
        <span class="n">memory_after</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_current_memory_usage</span><span class="p">()</span>

        <span class="c1"># Log memory usage for small datasets</span>
        <span class="n">memory_used</span> <span class="o">=</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Small dataset tokenization completed&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;total_rows&quot;</span><span class="p">:</span> <span class="n">total_rows</span><span class="p">,</span>
                <span class="s2">&quot;memory_used_mb&quot;</span><span class="p">:</span> <span class="n">memory_used</span><span class="p">,</span>
                <span class="s2">&quot;memory_before_mb&quot;</span><span class="p">:</span> <span class="n">memory_before</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
                <span class="s2">&quot;memory_after_mb&quot;</span><span class="p">:</span> <span class="n">memory_after</span><span class="p">[</span><span class="s2">&quot;rss_mb&quot;</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># For large datasets or unknown sizes, use memory-adaptive chunked processing</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">total_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Known size approach - adaptive chunking with memory monitoring</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Starting chunked tokenization for large dataset&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;total_rows&quot;</span><span class="p">:</span> <span class="n">total_rows</span><span class="p">,</span>
                    <span class="s2">&quot;initial_chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;known_size_chunking&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">chunk_lazyframes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="n">adaptive_chunk_size</span>
            <span class="n">processed_rows</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Set up progress manager with estimated total chunks</span>
            <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                <span class="n">estimated_total_chunks</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">total_rows</span> <span class="o">+</span> <span class="n">adaptive_chunk_size</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">)</span> <span class="o">//</span> <span class="n">adaptive_chunk_size</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_substep</span><span class="p">(</span>
                    <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tokenize_chunks&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Processing tokenization chunks&quot;</span><span class="p">,</span>
                    <span class="n">estimated_total_chunks</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">start_substep</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize_chunks&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">processed_rows</span> <span class="o">&lt;</span> <span class="n">total_rows</span><span class="p">:</span>
                <span class="c1"># Check memory pressure and adjust chunk size if needed</span>
                <span class="n">pressure_level</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">pressure_level</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span>
                    <span class="c1"># Reduce chunk size dramatically for critical pressure</span>
                    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="n">current_chunk_size</span>
                    <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Critical memory pressure - reducing chunk size dramatically&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;old_chunk_size&quot;</span><span class="p">:</span> <span class="n">old_chunk_size</span><span class="p">,</span>
                            <span class="s2">&quot;new_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                            <span class="s2">&quot;processed_rows&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">pressure_level</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span>
                    <span class="c1"># Reduce chunk size moderately for high pressure</span>
                    <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="n">current_chunk_size</span>
                    <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;High memory pressure - reducing chunk size&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;old_chunk_size&quot;</span><span class="p">:</span> <span class="n">old_chunk_size</span><span class="p">,</span>
                            <span class="s2">&quot;new_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                            <span class="s2">&quot;processed_rows&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>

                <span class="c1"># Calculate actual chunk size for this iteration</span>
                <span class="n">remaining_rows</span> <span class="o">=</span> <span class="n">total_rows</span> <span class="o">-</span> <span class="n">processed_rows</span>
                <span class="n">actual_chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_chunk_size</span><span class="p">,</span> <span class="n">remaining_rows</span><span class="p">)</span>

                <span class="c1"># Process chunk with memory monitoring</span>
                <span class="n">chunk_ldf</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">processed_rows</span><span class="p">,</span> <span class="n">actual_chunk_size</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">processed_chunk_ldf</span> <span class="o">=</span> <span class="n">_tokenize_chunk</span><span class="p">(</span><span class="n">chunk_ldf</span><span class="p">)</span>
                    <span class="n">chunk_lazyframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_chunk_ldf</span><span class="p">)</span>

                    <span class="n">processed_rows</span> <span class="o">+=</span> <span class="n">actual_chunk_size</span>

                    <span class="c1"># Report progress with current chunk number</span>
                    <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                        <span class="n">chunk_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_substep</span><span class="p">(</span>
                                <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize_chunks&quot;</span><span class="p">,</span> <span class="n">chunk_num</span>
                            <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Progress update failed during tokenization&quot;</span><span class="p">,</span>
                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;chunk_num&quot;</span><span class="p">:</span> <span class="n">chunk_num</span><span class="p">,</span>
                                    <span class="s2">&quot;processed_rows&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                    <span class="c1"># Force garbage collection after each chunk in high memory pressure</span>
                    <span class="k">if</span> <span class="n">pressure_level</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;Significant memory freed after tokenization chunk&quot;</span><span class="p">,</span>
                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">],</span>
                                    <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="n">pressure_level</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                    <span class="s2">&quot;chunk_number&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">),</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Emergency fallback - reduce chunk size dramatically and retry</span>
                    <span class="k">if</span> <span class="n">current_chunk_size</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="n">current_chunk_size</span>
                        <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Memory error in tokenization - emergency chunk size reduction&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;old_chunk_size&quot;</span><span class="p">:</span> <span class="n">old_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;new_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;processed_rows&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Even minimum chunk size failed - this is a critical error</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                            <span class="s2">&quot;Cannot process even minimal chunks during tokenization&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;processed_rows&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cannot process even minimal chunks during tokenization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="c1"># Return concatenated results</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk_lazyframes</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No chunks processed successfully in known-size tokenization&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Complete progress step even if no chunks processed</span>
                <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                    <span class="n">progress_manager</span><span class="o">.</span><span class="n">complete_substep</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize_chunks&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ldf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">([])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)])</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Chunked tokenization completed successfully&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;total_chunks_processed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">),</span>
                    <span class="s2">&quot;total_rows_processed&quot;</span><span class="p">:</span> <span class="n">processed_rows</span><span class="p">,</span>
                    <span class="s2">&quot;final_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># Complete progress step on success</span>
            <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">complete_substep</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;tokenize_chunks&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unknown size - streaming approach with memory-aware chunk sizing</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Starting streaming tokenization for unknown-size dataset&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;initial_chunk_size&quot;</span><span class="p">:</span> <span class="n">adaptive_chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;streaming_unknown_size&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">chunk_lazyframes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">estimated_chunks</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Start with conservative estimate</span>
            <span class="n">consecutive_empty_chunks</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_empty_chunks</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Stop after this many consecutive empty chunks</span>
            <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="n">adaptive_chunk_size</span>

            <span class="c1"># Set up progress manager for streaming with initial estimate</span>
            <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">add_substep</span><span class="p">(</span>
                    <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;stream_tokenize&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Streaming tokenization chunks&quot;</span><span class="p">,</span>
                    <span class="n">estimated_chunks</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">start_substep</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;stream_tokenize&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">consecutive_empty_chunks</span> <span class="o">&lt;</span> <span class="n">max_empty_chunks</span><span class="p">:</span>
                <span class="c1"># Check memory pressure and adjust chunk size</span>
                <span class="n">pressure_level</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">get_memory_pressure_level</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">pressure_level</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span>
                    <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pressure_level</span> <span class="o">==</span> <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span>
                    <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">start_idx</span> <span class="o">=</span> <span class="n">chunk_idx</span> <span class="o">*</span> <span class="n">current_chunk_size</span>
                <span class="n">chunk_ldf</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">current_chunk_size</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># More efficient emptiness check using lazy operations</span>
                    <span class="n">processed_chunk_ldf</span> <span class="o">=</span> <span class="n">_tokenize_chunk</span><span class="p">(</span><span class="n">chunk_ldf</span><span class="p">)</span>

                    <span class="c1"># Use lazy operations to check if chunk has data</span>
                    <span class="n">chunk_has_data_check</span> <span class="o">=</span> <span class="n">processed_chunk_ldf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">len</span><span class="p">())</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">chunk_len</span> <span class="o">=</span> <span class="n">chunk_has_data_check</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">chunk_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">consecutive_empty_chunks</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">consecutive_empty_chunks</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Reset counter</span>

                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># If we can&#39;t determine chunk size, assume it&#39;s empty</span>
                        <span class="n">consecutive_empty_chunks</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c1"># Add non-empty chunk to results</span>
                    <span class="n">chunk_lazyframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_chunk_ldf</span><span class="p">)</span>

                    <span class="c1"># Update progress estimate dynamically</span>
                    <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">chunk_idx</span> <span class="o">&gt;</span> <span class="n">estimated_chunks</span><span class="p">:</span>
                        <span class="n">estimated_chunks</span> <span class="o">=</span> <span class="n">chunk_idx</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># Increase estimate</span>
                        <span class="c1"># Update progress step total with new estimate</span>
                        <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># Note: ProgressManager might not support updating totals,</span>
                                <span class="c1"># but we can try or just update current progress</span>
                                <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_substep</span><span class="p">(</span>
                                    <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;stream_tokenize&quot;</span><span class="p">,</span> <span class="n">chunk_idx</span>
                                <span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                    <span class="s2">&quot;Progress total update failed&quot;</span><span class="p">,</span>
                                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)},</span>
                                <span class="p">)</span>

                    <span class="c1"># Report progress with current chunk</span>
                    <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">progress_manager</span><span class="o">.</span><span class="n">update_substep</span><span class="p">(</span>
                                <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;stream_tokenize&quot;</span><span class="p">,</span> <span class="n">chunk_idx</span>
                            <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Progress update failed during streaming tokenization&quot;</span><span class="p">,</span>
                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;chunk_idx&quot;</span><span class="p">:</span> <span class="n">chunk_idx</span><span class="p">,</span>
                                    <span class="s2">&quot;estimated_chunks&quot;</span><span class="p">:</span> <span class="n">estimated_chunks</span><span class="p">,</span>
                                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                    <span class="c1"># Force garbage collection in high memory pressure</span>
                    <span class="k">if</span> <span class="n">pressure_level</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                        <span class="n">MemoryPressureLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="n">cleanup_stats</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">enhanced_gc_cleanup</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;Significant memory freed after streaming tokenization chunk&quot;</span><span class="p">,</span>
                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">:</span> <span class="n">cleanup_stats</span><span class="p">[</span><span class="s2">&quot;memory_freed_mb&quot;</span><span class="p">],</span>
                                    <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="n">pressure_level</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                    <span class="s2">&quot;chunk_index&quot;</span><span class="p">:</span> <span class="n">chunk_idx</span><span class="p">,</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Emergency fallback - reduce chunk size dramatically and retry</span>
                    <span class="k">if</span> <span class="n">current_chunk_size</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                        <span class="n">old_chunk_size</span> <span class="o">=</span> <span class="n">current_chunk_size</span>
                        <span class="n">current_chunk_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">current_chunk_size</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Memory error in streaming tokenization - emergency chunk size reduction&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;old_chunk_size&quot;</span><span class="p">:</span> <span class="n">old_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;new_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;chunk_index&quot;</span><span class="p">:</span> <span class="n">chunk_idx</span><span class="p">,</span>
                                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Even minimum chunk size failed - critical error</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                            <span class="s2">&quot;Cannot process even minimal chunks during streaming tokenization&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                                <span class="s2">&quot;chunk_index&quot;</span><span class="p">:</span> <span class="n">chunk_idx</span><span class="p">,</span>
                                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cannot process even minimal chunks during streaming tokenization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># If chunk processing fails, likely no more data</span>
                    <span class="n">consecutive_empty_chunks</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">chunk_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Complete progress step for streaming</span>
            <span class="k">if</span> <span class="n">progress_manager</span><span class="p">:</span>
                <span class="n">progress_manager</span><span class="o">.</span><span class="n">complete_substep</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="s2">&quot;stream_tokenize&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk_lazyframes</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No chunks processed successfully in streaming tokenization&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Progress was already completed above</span>
                <span class="k">return</span> <span class="n">ldf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">([])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)])</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Streaming tokenization completed successfully&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;total_chunks_processed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">),</span>
                    <span class="s2">&quot;final_chunk_size&quot;</span><span class="p">:</span> <span class="n">current_chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;consecutive_empty_chunks&quot;</span><span class="p">:</span> <span class="n">consecutive_empty_chunks</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunk_lazyframes</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># If chunked processing fails completely, fall back to non-chunked processing</span>
        <span class="c1"># This maintains backward compatibility and ensures functionality</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Chunked tokenization failed, attempting fallback to single-chunk processing&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;fallback_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;single_chunk&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_tokenize_chunk</span><span class="p">(</span><span class="n">ldf</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Fallback tokenization completed successfully&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fallback_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;single_chunk&quot;</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">fallback_error</span><span class="p">:</span>
            <span class="c1"># If even fallback fails, provide informative error</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                <span class="s2">&quot;Tokenization failed in both chunked and fallback modes&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;chunked_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="s2">&quot;chunked_error_type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">&quot;fallback_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fallback_error</span><span class="p">),</span>
                    <span class="s2">&quot;fallback_error_type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fallback_error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tokenization failed in both chunked and fallback modes. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Chunked error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">. Fallback error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">fallback_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 CIB Mango Tree
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.path", "navigation.sections", "navigation.top", "navigation.tabs", "content.code.copy", "content.tooltips", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>